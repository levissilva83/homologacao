<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#08080a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-TileColor" content="#08080a">
    <title>JIU JITSU ACADEMY - Checkin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
    // Early notch detection
    (function(){
        var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        var h = screen.height, w = screen.width;
        var hasNotch = isIOS && (Math.max(h,w) >= 812);
        var isStandalone = navigator.standalone === true;
        if (hasNotch || isStandalone) {
            document.documentElement.style.setProperty('--notch-top', hasNotch ? '50px' : '24px');
        }
    })();
    </script>
    <style>

        * {
            margin: 0;
            padding: 0;
            border: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-deep: #08080a;
            --bg-card: #111114;
            --bg-elevated: #19191e;
            --bg-glass: rgba(17, 17, 20, 0.8);
            --accent: #D4A529;
            --accent-dim: rgba(212, 165, 41, 0.12);
            --accent-glow: rgba(212, 165, 41, 0.25);
            --gold-light: #F5D04E;
            --gold-deep: #B8860B;
            --coral: #E85D5D;
            --amber: #F0A030;
            --lavender: #9B8ACE;
            --text-1: #f0ede5;
            --text-2: #8a8678;
            --text-3: #55524a;
            --border: rgba(212, 165, 41, 0.08);
            --border-accent: rgba(212, 165, 41, 0.2);
            --radius-sm: 10px;
            --radius-md: 14px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --shadow-card: 0 2px 20px rgba(0,0,0,0.4);
            --shadow-glow: 0 0 30px rgba(212, 165, 41, 0.1);
            --safe-bottom: 0px;
            --notch-top: 0px;
        }

        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            :root { --safe-bottom: env(safe-area-inset-bottom, 0px); }
        }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-deep);
            color: var(--text-1);
            line-height: 1.5;
            touch-action: manipulation;
        }

        /* ===== AMBIENT OVERLAY ===== */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: 
                radial-gradient(ellipse at 20% 0%, rgba(212,165,41,0.03) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 100%, rgba(184,134,11,0.02) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        .app {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -ms-flex-direction: column;
            flex-direction: column;
            height: 100vh;
            height: -webkit-fill-available;
            width: 100%;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        @supports (height: 100dvh) {
            .app { height: 100dvh; }
        }

        /* ===== HEADER ===== */
        .hdr {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
            -ms-flex-pack: justify;
            justify-content: space-between;
            padding: 14px 20px;
            padding-top: calc(14px + var(--notch-top, 0px));
            background: #08080a;
            border-bottom: 1px solid var(--border);
            position: relative;
            z-index: 10;
            -webkit-flex-shrink: 0;
            -ms-flex-negative: 0;
            flex-shrink: 0;
        }

        /* iOS 11.0-11.1 */
        @supports (padding-top: constant(safe-area-inset-top)) {
            .hdr { padding-top: calc(14px + constant(safe-area-inset-top)); }
        }

        /* iOS 11.2+ / modern */
        @supports (padding-top: env(safe-area-inset-top)) {
            .hdr { padding-top: calc(14px + env(safe-area-inset-top)); }
        }

        @supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
            .hdr {
                background: rgba(8,8,10,0.92);
                -webkit-backdrop-filter: blur(20px);
                backdrop-filter: blur(20px);
            }
        }

        .hdr-brand {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
        }

        .hdr-brand > * + * {
            margin-left: 10px;
        }

        .hdr-title {
            font-family: 'Sora', sans-serif;
            font-weight: 800;
            font-size: 14px;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hdr-user {
            display: none;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            padding: 6px 14px 6px 8px;
            background: var(--accent-dim);
            border-radius: 50px;
            border: 1px solid var(--border-accent);
            cursor: pointer;
        }

        .hdr-user > * + * {
            margin-left: 10px;
        }

        .hdr-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
            color: var(--bg-deep);
        }

        .hdr-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent);
        }

        /* ===== MAIN CONTENT ===== */
        .main {
            -webkit-box-flex: 1;
            -webkit-flex: 1 1 0;
            -ms-flex: 1 1 0px;
            flex: 1 1 0;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-y: contain;
            -ms-scroll-chaining: none;
            padding: 20px 16px;
            padding-bottom: 90px;
            min-height: 0;
            position: relative;
            touch-action: pan-y;
        }

        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .main { padding-bottom: calc(90px + env(safe-area-inset-bottom, 0px)); }
        }

        .main::-webkit-scrollbar { width: 4px; }
        .main::-webkit-scrollbar-track { background: transparent; }
        .main::-webkit-scrollbar-thumb { background: var(--text-3); border-radius: 4px; }
        .main::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        /* ===== BOTTOM NAV ===== */
        .bnav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: none;
            background: #08080a;
            border-top: 1px solid var(--border);
            padding: 8px 16px 8px;
            z-index: 100;
        }

        @supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
            .bnav {
                background: rgba(8,8,10,0.94);
                -webkit-backdrop-filter: blur(24px);
                backdrop-filter: blur(24px);
            }
        }

        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .bnav { padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px)); }
        }

        .bnav-inner {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-justify-content: space-around;
            -ms-flex-pack: distribute;
            justify-content: space-around;
            max-width: 460px;
            margin: 0 auto;
        }

        .bnav-btn {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -ms-flex-direction: column;
            flex-direction: column;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            padding: 6px 10px;
            background: none;
            border: none;
            color: var(--text-3);
            cursor: pointer;
            -webkit-transition: all 0.25s ease;
            transition: all 0.25s ease;
            border-radius: var(--radius-sm);
            position: relative;
            font-family: inherit;
        }

        .bnav-btn .bnav-icon {
            font-size: 22px;
            margin-bottom: 4px;
            -webkit-transition: -webkit-transform 0.25s ease;
            transition: transform 0.25s ease;
        }

        .bnav-btn .bnav-label {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .bnav-btn.active {
            color: var(--accent);
        }

        .bnav-btn.active .bnav-icon {
            transform: scale(1.15);
        }

        .bnav-btn.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            border-radius: 0 0 4px 4px;
            background: var(--accent);
        }

        /* ===== FORM ELEMENTS ===== */
        input, select, textarea {
            width: 100%;
            font-family: inherit;
            font-size: 16px;
            -webkit-appearance: none;
            appearance: none;
            border: none;
            border-radius: var(--radius-md);
            padding: 14px 16px;
            background: var(--bg-elevated);
            color: var(--text-1);
            border: 1.5px solid var(--border);
            transition: all 0.3s ease;
            -webkit-user-select: text;
            user-select: text;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(212,165,41,0.05);
            box-shadow: 0 0 0 3px rgba(212,165,41,0.1);
        }

        input::placeholder { color: var(--text-3); }

        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23D4A529' stroke-width='2'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 18px;
            padding-right: 42px;
            cursor: pointer;
        }

        select option {
            background: var(--bg-card);
            color: var(--text-1);
        }

        button {
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            border: none;
            font-family: inherit;
        }

        button:active { transform: scale(0.97); }
        button:disabled { opacity: 0.4; cursor: not-allowed; }

        .btn {
            width: 100%;
            min-height: 50px;
            padding: 14px 24px;
            border-radius: var(--radius-md);
            font-weight: 700;
            font-size: 14px;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            color: var(--bg-deep);
            box-shadow: 0 4px 20px rgba(212,165,41,0.3);
        }

        .btn-primary:active {
            box-shadow: 0 2px 10px rgba(212,165,41,0.2);
        }

        .btn-outline {
            background: transparent;
            color: var(--accent);
            border: 2px solid var(--border-accent);
        }

        .btn-danger-outline {
            background: transparent;
            color: var(--coral);
            border: 2px solid rgba(255,107,107,0.3);
        }

        /* ===== CARD BASE ===== */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .card-glass {
            background: #111114;
        }

        @supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
            .card-glass {
                background: var(--bg-glass);
                -webkit-backdrop-filter: blur(12px);
                backdrop-filter: blur(12px);
            }
        }

        .card-glow {
            box-shadow: var(--shadow-glow);
            border-color: var(--border-accent);
        }

        /* ===== LOGIN SCREEN ===== */
        #loginScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 0;
            padding: 40px 0 20px;
            animation: fadeUp 0.6s ease-out;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-hero {
            text-align: center;
            margin-bottom: 36px;
        }

        .login-title {
            font-family: 'Sora', sans-serif;
            font-size: 28px;
            font-weight: 800;
            letter-spacing: 3px;
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
        }

        .login-sub {
            color: var(--text-2);
            font-size: 14px;
        }

        .login-box {
            width: 100%;
            max-width: 400px;
        }

        .form-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 28px 24px;
            margin-bottom: 14px;
        }

        .form-card-title {
            font-family: 'Sora', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 22px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        /* ===== PASSWORD INPUT ===== */
        .password-wrapper {
            position: relative;
        }
        .password-wrapper input {
            padding-right: 44px;
        }
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-3);
            cursor: pointer;
            padding: 4px;
            font-size: 18px;
            line-height: 1;
            transition: color 0.2s;
        }
        .password-toggle:hover {
            color: var(--gold);
        }
        .password-match-hint {
            font-size: 11px;
            margin-top: 4px;
            min-height: 16px;
        }
        .password-match-hint.match { color: #2ecc71; }
        .password-match-hint.no-match { color: #e74c3c; }

        /* ===== TAB CONTENT ===== */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== CHECK-IN TAB ===== */
        .checkin-profile {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: linear-gradient(135deg, var(--bg-card), var(--bg-elevated));
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
        }

        .checkin-avatar {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 800;
            color: var(--bg-deep);
            flex-shrink: 0;
        }

        .checkin-info { flex: 1; }

        .checkin-name {
            font-family: 'Sora', sans-serif;
            font-weight: 700;
            font-size: 16px;
            color: var(--text-1);
            margin-bottom: 2px;
        }

        .checkin-meta {
            font-size: 13px;
            color: var(--text-2);
        }

        .checkin-meta span {
            color: var(--accent);
            font-weight: 600;
        }

        .checkin-count {
            text-align: center;
            padding: 8px 14px;
            background: var(--accent-dim);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-accent);
        }

        .checkin-count-num {
            font-family: 'Sora', sans-serif;
            font-size: 22px;
            font-weight: 800;
            color: var(--accent);
        }

        .checkin-count-label {
            font-size: 9px;
            color: var(--text-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ct-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 14px;
        }

        .ct-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .ct-btn {
            padding: 14px 10px;
            background: var(--bg-elevated);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-2);
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
            text-align: center;
            font-family: inherit;
        }

        .ct-btn:hover { border-color: var(--accent); color: var(--text-1); }

        .ct-btn.selected {
            background: var(--accent-dim);
            color: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(212,165,41,0.15);
        }

        .selected-ct-bar {
            display: none;
            padding: 12px 16px;
            background: var(--accent-dim);
            border: 1px solid var(--border-accent);
            border-radius: var(--radius-sm);
            margin-top: 14px;
            font-size: 13px;
            color: var(--text-2);
        }

        .selected-ct-bar span {
            color: var(--accent);
            font-weight: 700;
        }

        .selected-ct-bar.active { display: flex; justify-content: space-between; }

        /* ===== MESSAGE ===== */
        .msg {
            padding: 14px 18px;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 600;
            margin: 14px 0;
            text-align: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .msg.success { background: rgba(212,165,41,0.12); color: var(--accent); border: 1px solid var(--border-accent); }
        .msg.danger { background: rgba(255,107,107,0.12); color: var(--coral); border: 1px solid rgba(255,107,107,0.2); }
        .msg.warning { background: rgba(255,179,71,0.12); color: var(--amber); border: 1px solid rgba(255,179,71,0.2); }
        .msg.info { background: rgba(184,134,11,0.12); color: var(--gold-light); border: 1px solid rgba(184,134,11,0.2); }

        /* ===== RANKING TAB ===== */
        .rank-period {
            display: flex;
            gap: 8px;
            background: var(--bg-card);
            border-radius: 50px;
            padding: 4px;
            border: 1px solid var(--border);
            margin-bottom: 16px;
        }

        .rank-period-btn {
            flex: 1;
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-radius: 50px;
            color: var(--text-3);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .rank-period-btn.active {
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            color: var(--bg-deep);
            box-shadow: 0 4px 15px rgba(212,165,41,0.3);
        }

        .rank-ct-scroll {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 4px;
            margin-bottom: 20px;
            -webkit-overflow-scrolling: touch;
        }

        .rank-ct-scroll::-webkit-scrollbar { height: 0; }

        .rank-ct-chip {
            padding: 8px 18px;
            background: var(--bg-elevated);
            border: 1.5px solid var(--border);
            border-radius: 50px;
            color: var(--text-2);
            font-weight: 600;
            font-size: 12px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .rank-ct-chip.active {
            background: var(--accent-dim);
            border-color: var(--accent);
            color: var(--accent);
        }

        .rank-ct-chip.geral.active {
            background: rgba(184,134,11,0.15);
            border-color: var(--gold-light);
            color: var(--gold-light);
        }

        /* User training summary */
        .user-stats-card {
            display: none;
            background: linear-gradient(135deg, var(--bg-card), rgba(212,165,41,0.05));
            border: 1px solid var(--border-accent);
            border-radius: var(--radius-lg);
            padding: 18px;
            margin-bottom: 20px;
        }

        .user-stats-row {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-stats-total {
            text-align: center;
            padding: 12px 18px;
            background: var(--accent-dim);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-accent);
            flex-shrink: 0;
        }

        .user-stats-num {
            font-family: 'Sora', sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: var(--accent);
        }

        .user-stats-lbl {
            font-size: 10px;
            color: var(--text-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .user-ct-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            flex: 1;
        }

        .user-ct-tag {
            padding: 8px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .user-ct-tag-name {
            font-size: 10px;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .user-ct-tag-count {
            font-family: 'Sora', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }

        /* Podium */
        .podium {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .podium-card {
            background: var(--bg-card);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 16px 10px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .podium-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .podium-card.gold::before { background: linear-gradient(90deg, #FFD700, #FFA500); }
        .podium-card.silver::before { background: linear-gradient(90deg, #C0C0C0, #A0A0A0); }
        .podium-card.bronze::before { background: linear-gradient(90deg, #CD7F32, #B8722D); }

        .podium-medal { font-size: 28px; margin-bottom: 8px; }

        .podium-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-1);
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .podium-faixa {
            font-size: 11px;
            color: var(--text-3);
            margin-bottom: 6px;
        }

        .podium-count {
            font-family: 'Sora', sans-serif;
            font-size: 22px;
            font-weight: 800;
            color: var(--accent);
        }

        .podium-ct {
            font-size: 10px;
            color: var(--text-3);
            margin-top: 4px;
        }

        /* User position */
        .user-pos-card {
            display: none;
            background: linear-gradient(135deg, var(--bg-card), rgba(212,165,41,0.05));
            border: 1.5px solid var(--border-accent);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 20px;
        }

        .user-pos-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-pos-rank {
            font-family: 'Sora', sans-serif;
            font-size: 20px;
            font-weight: 800;
            color: var(--accent);
        }

        .user-pos-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-1);
            margin-top: 2px;
        }

        .user-pos-meta {
            font-size: 12px;
            color: var(--text-2);
        }

        .user-pos-next-label {
            font-size: 10px;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: right;
        }

        .user-pos-diff {
            font-family: 'Sora', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: var(--coral);
            text-align: right;
        }

        /* Ranking list */
        .rank-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rank-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            transition: all 0.3s ease;
        }

        .rank-item.me {
            background: linear-gradient(135deg, var(--bg-card), rgba(212,165,41,0.08));
            border-color: var(--border-accent);
        }

        .rank-item-left {
            display: flex;
            align-items: center;
            gap: 14px;
            flex: 1;
            min-width: 0;
        }

        .rank-pos {
            font-family: 'Sora', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: var(--accent);
            min-width: 36px;
            text-align: center;
        }

        .rank-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 1px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rank-detail {
            font-size: 11px;
            color: var(--text-3);
        }

        .rank-num {
            font-family: 'Sora', sans-serif;
            font-size: 16px;
            font-weight: 800;
            color: var(--accent);
            flex-shrink: 0;
        }

        /* ===== EVOLUÇÃO TAB ===== */
        .evo-container {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        /* Motivation banner */
        .evo-motivation {
            background: linear-gradient(135deg, rgba(212,165,41,0.08), rgba(184,134,11,0.08));
            border: 1px solid var(--border-accent);
            border-radius: var(--radius-lg);
            padding: 18px 20px;
            text-align: center;
        }

        .evo-motivation-icon { font-size: 28px; margin-bottom: 6px; }

        .evo-motivation-text {
            font-family: 'Sora', sans-serif;
            font-size: 14px;
            font-weight: 600;
            font-style: italic;
            color: var(--text-1);
            margin-bottom: 4px;
        }

        .evo-motivation-sub {
            font-size: 12px;
            color: var(--text-2);
        }

        /* Hero card */
        .evo-hero {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 24px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
        }

        .evo-hero-belt {
            width: 64px;
            height: 64px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            flex-shrink: 0;
        }

        .evo-hero-belt.branca { background: linear-gradient(135deg, #f0f0f0, #d0d0d0); }
        .evo-hero-belt.azul { background: linear-gradient(135deg, #2196F3, #1565C0); }
        .evo-hero-belt.roxa { background: linear-gradient(135deg, #9C27B0, #6A1B9A); }
        .evo-hero-belt.marrom { background: linear-gradient(135deg, #8D6E63, #5D4037); }
        .evo-hero-belt.preta { background: linear-gradient(135deg, #424242, #1a1a1a); }

        .evo-hero-info { flex: 1; min-width: 140px; }

        .evo-hero-title {
            font-family: 'Sora', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-1);
        }

        .evo-hero-sub {
            font-size: 12px;
            color: var(--text-2);
            margin-top: 2px;
        }

        .evo-hero-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 700;
            margin-top: 6px;
        }

        .evo-hero-status.red { background: rgba(255,107,107,0.15); color: var(--coral); }
        .evo-hero-status.yellow { background: rgba(255,179,71,0.15); color: var(--amber); }
        .evo-hero-status.green { background: rgba(212,165,41,0.15); color: var(--accent); }

        .evo-hero-stats {
            display: flex;
            gap: 12px;
            width: 100%;
        }

        .evo-hero-stat {
            flex: 1;
            text-align: center;
            padding: 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
        }

        .evo-hero-stat-val {
            font-family: 'Sora', sans-serif;
            font-size: 22px;
            font-weight: 800;
            color: var(--accent);
        }

        .evo-hero-stat-lbl {
            font-size: 10px;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Seals */
        .evo-seals {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .evo-seals-title {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .evo-seals-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .evo-seal { text-align: center; }

        .evo-seal-circle {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            margin: 0 auto 8px;
            transition: all 0.5s ease;
        }

        .evo-seal-circle.locked {
            background: var(--bg-elevated);
            border: 2px dashed var(--text-3);
            opacity: 0.5;
        }

        .evo-seal-circle.current-target {
            background: var(--accent-dim);
            border: 2px solid var(--accent);
            animation: pulse-seal 2s ease-in-out infinite;
        }

        @keyframes pulse-seal {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212,165,41,0.2); }
            50% { box-shadow: 0 0 0 8px rgba(212,165,41,0); }
        }

        .evo-seal-circle.unlocked {
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            border: none;
            box-shadow: 0 4px 15px rgba(212,165,41,0.3);
        }

        .evo-seal-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-3);
        }

        .evo-seal-label.unlocked { color: var(--accent); }
        .evo-seal-label.current-target { color: var(--accent); }

        .evo-seal-progress {
            font-size: 10px;
            color: var(--text-3);
            margin-top: 2px;
        }

        /* Frequency bar */
        .evo-freq {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 18px 20px;
        }

        .evo-freq-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .evo-freq-left {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-2);
        }

        .evo-freq-pct {
            font-family: 'Sora', sans-serif;
            font-size: 18px;
            font-weight: 800;
        }

        .evo-freq-pct.red { color: var(--coral); }
        .evo-freq-pct.yellow { color: var(--amber); }
        .evo-freq-pct.green { color: var(--accent); }

        .evo-freq-bar-bg {
            width: 100%;
            height: 8px;
            background: var(--bg-elevated);
            border-radius: 4px;
            overflow: hidden;
        }

        .evo-freq-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        .evo-freq-bar-fill.red { background: linear-gradient(90deg, var(--coral), #FF8A80); }
        .evo-freq-bar-fill.yellow { background: linear-gradient(90deg, var(--amber), #FFD54F); }
        .evo-freq-bar-fill.green { background: linear-gradient(90deg, var(--accent), var(--gold-light)); }

        .evo-freq-sub {
            font-size: 11px;
            color: var(--text-3);
            margin-top: 8px;
            text-align: center;
        }

        /* Criteria */
        .evo-criteria-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .evo-criteria-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .evo-criteria-header-icon { font-size: 20px; }

        .evo-criteria-header-text {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-1);
            flex: 1;
        }

        .evo-criteria-header-sub {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: var(--accent);
        }

        .evo-criteria-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .evo-criteria-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: var(--radius-sm);
        }

        .evo-criteria-check {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .evo-criteria-check.pass { background: rgba(212,165,41,0.15); color: var(--accent); }
        .evo-criteria-check.fail { background: rgba(255,107,107,0.15); color: var(--coral); }
        .evo-criteria-check.pending { background: rgba(255,179,71,0.15); color: var(--amber); }

        .evo-criteria-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-1);
        }

        .evo-criteria-detail {
            font-size: 11px;
            color: var(--text-3);
        }

        /* Exam button */
        .evo-exam-btn {
            width: 100%;
            padding: 16px;
            border-radius: var(--radius-md);
            font-weight: 700;
            font-size: 14px;
            text-align: center;
            letter-spacing: 0.5px;
            font-family: inherit;
        }

        .evo-exam-btn.disabled {
            background: var(--bg-elevated);
            color: var(--text-3);
            cursor: not-allowed;
        }

        .evo-exam-btn.active {
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            color: var(--bg-deep);
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(212,165,41,0.3);
        }

        /* ===== IBJJF ROADMAP ===== */
        .ibjjf-roadmap {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px 16px;
        }

        .ibjjf-title {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .ibjjf-subtitle {
            font-size: 11px;
            color: var(--text-3);
            margin-bottom: 16px;
        }

        /* Legend row */
        .ibjjf-legend {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-flex-wrap: wrap;
            flex-wrap: wrap;
            margin-bottom: 16px;
            gap: 0;
        }

        .ibjjf-legend-item {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            font-size: 10px;
            color: var(--text-3);
            margin-right: 14px;
            margin-bottom: 4px;
        }

        .ibjjf-legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
            -webkit-flex-shrink: 0;
            flex-shrink: 0;
        }

        .ibjjf-legend-dot.past { background: var(--accent); opacity: 0.6; }
        .ibjjf-legend-dot.current { background: var(--accent); box-shadow: 0 0 6px rgba(212,165,41,0.5); }
        .ibjjf-legend-dot.next { border: 2px solid var(--accent); background: transparent; }
        .ibjjf-legend-dot.future { border: 1.5px dashed var(--text-3); background: transparent; opacity: 0.5; }

        /* Vertical track */
        .ibjjf-track {
            position: relative;
            padding-left: 32px;
        }

        .ibjjf-track::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--bg-elevated);
            border-radius: 2px;
        }

        .ibjjf-track-fill {
            position: absolute;
            left: 11px;
            top: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--accent), var(--gold-light));
            border-radius: 2px;
            -webkit-transition: height 1s ease;
            transition: height 1s ease;
        }

        /* Belt node */
        .ibjjf-node {
            position: relative;
            margin-bottom: 4px;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            -webkit-transition: all 0.3s ease;
            transition: all 0.3s ease;
        }

        .ibjjf-node:last-child { margin-bottom: 0; }

        /* Dot on left */
        .ibjjf-node::before {
            content: '';
            position: absolute;
            left: -27px;
            top: 50%;
            -webkit-transform: translateY(-50%);
            transform: translateY(-50%);
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: var(--bg-elevated);
            border: 2px solid var(--text-3);
            z-index: 2;
        }

        /* States */
        .ibjjf-node.completed::before {
            background: var(--accent);
            border-color: var(--accent);
            opacity: 0.7;
        }

        .ibjjf-node.completed {
            opacity: 0.55;
        }

        .ibjjf-node.current {
            background: rgba(212,165,41,0.08);
            border: 1.5px solid var(--border-accent);
        }

        .ibjjf-node.current::before {
            background: var(--accent);
            border-color: var(--gold-light);
            width: 15px;
            height: 15px;
            left: -28px;
            box-shadow: 0 0 12px rgba(212,165,41,0.5);
        }

        .ibjjf-node.next {
            background: rgba(212,165,41,0.04);
            border: 1px dashed var(--border-accent);
        }

        .ibjjf-node.next::before {
            border-color: var(--accent);
            border-style: dashed;
            background: transparent;
        }

        .ibjjf-node.future {
            opacity: 0.35;
        }

        .ibjjf-node.future::before {
            border-style: dashed;
            opacity: 0.5;
        }

        /* Node inner layout */
        .ibjjf-node-inner {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
        }

        /* Belt color band */
        .ibjjf-belt-band {
            width: 36px;
            height: 10px;
            border-radius: 3px;
            -webkit-flex-shrink: 0;
            flex-shrink: 0;
            margin-right: 10px;
            position: relative;
            overflow: hidden;
        }

        /* Belt stripe indicator */
        .ibjjf-belt-band .stripe {
            position: absolute;
            right: 2px;
            top: 0;
            height: 100%;
            width: 6px;
            background: #111;
        }

        .ibjjf-belt-band .stripe-inner {
            position: absolute;
            top: 1px;
            bottom: 1px;
            width: 2px;
        }

        /* Belt colors */
        .ibjjf-belt-band.branca { background: linear-gradient(90deg, #e8e8e8, #f5f5f5); }
        .ibjjf-belt-band.azul { background: linear-gradient(90deg, #1565C0, #2196F3); }
        .ibjjf-belt-band.roxa { background: linear-gradient(90deg, #6A1B9A, #9C27B0); }
        .ibjjf-belt-band.marrom { background: linear-gradient(90deg, #5D4037, #8D6E63); }
        .ibjjf-belt-band.preta { background: linear-gradient(90deg, #1a1a1a, #424242); }

        /* Belt info */
        .ibjjf-belt-info {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            min-width: 0;
        }

        .ibjjf-belt-name {
            font-family: 'Sora', sans-serif;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-1);
            line-height: 1.2;
        }

        .ibjjf-node.completed .ibjjf-belt-name { color: var(--text-2); }
        .ibjjf-node.current .ibjjf-belt-name { color: var(--accent); }
        .ibjjf-node.future .ibjjf-belt-name { color: var(--text-3); }

        .ibjjf-belt-meta {
            font-size: 10px;
            color: var(--text-3);
            margin-top: 1px;
        }

        .ibjjf-node.current .ibjjf-belt-meta { color: var(--text-2); }

        /* Right side badges */
        .ibjjf-belt-badges {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            -webkit-flex-shrink: 0;
            flex-shrink: 0;
            margin-left: 8px;
        }

        /* Grau dots */
        .ibjjf-grau-dots {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
        }

        .ibjjf-grau-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-left: 3px;
            background: var(--bg-elevated);
            border: 1px solid var(--text-3);
        }

        .ibjjf-grau-dot.filled {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* Status tag on right */
        .ibjjf-status-tag {
            font-family: 'Sora', sans-serif;
            font-size: 9px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 50px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .ibjjf-status-tag.here {
            background: rgba(212,165,41,0.15);
            color: var(--accent);
            border: 1px solid var(--border-accent);
        }

        .ibjjf-status-tag.goal {
            background: transparent;
            color: var(--text-2);
            border: 1px dashed var(--border-accent);
        }

        .ibjjf-status-tag.done {
            color: var(--text-3);
            font-size: 12px;
        }

        /* Progress summary below roadmap */
        .ibjjf-summary {
            margin-top: 16px;
            padding: 14px;
            background: var(--bg-elevated);
            border-radius: var(--radius-sm);
        }

        .ibjjf-summary-row {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: justify;
            -webkit-justify-content: space-between;
            justify-content: space-between;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            margin-bottom: 8px;
        }

        .ibjjf-summary-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-2);
        }

        .ibjjf-summary-val {
            font-family: 'Sora', sans-serif;
            font-size: 14px;
            font-weight: 800;
            color: var(--accent);
        }

        .ibjjf-summary-bar-bg {
            height: 6px;
            background: var(--bg-deep);
            border-radius: 3px;
            overflow: hidden;
        }

        .ibjjf-summary-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--gold-light));
            border-radius: 3px;
            -webkit-transition: width 1s ease;
            transition: width 1s ease;
        }

        /* ===== ADMIN SECTION ===== */
        .admin-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 18px;
            margin-top: 20px;
        }

        .admin-form {
            display: flex;
            gap: 8px;
        }

        .admin-form input {
            flex: 1;
            padding: 10px 14px;
            font-size: 13px;
        }

        .admin-form button {
            padding: 10px 18px;
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            color: var(--bg-deep);
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            font-family: inherit;
        }

        .cts-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .ct-item {
            padding: 8px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: var(--text-2);
        }

        .ct-item button {
            background: rgba(255,107,107,0.15);
            color: var(--coral);
            border: none;
            border-radius: 4px;
            padding: 3px 8px;
            font-size: 10px;
            font-weight: 700;
        }

        /* ===== PERFIL TAB ===== */
        .perfil-container { max-width: 480px; margin: 0 auto; }

        .perfil-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .perfil-avatar-big {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            display: -webkit-flex;
            display: flex;
            -webkit-align-items: center;
            align-items: center;
            -webkit-justify-content: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 800;
            color: var(--bg-deep);
            margin: 0 auto 12px;
            font-family: 'Sora', sans-serif;
        }

        .perfil-nome {
            font-family: 'Sora', sans-serif;
            font-size: 20px;
            font-weight: 800;
            color: var(--text-1);
        }

        .perfil-faixa-tag {
            display: inline-block;
            font-size: 11px;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 50px;
            background: var(--accent-dim);
            color: var(--accent);
            margin-top: 6px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .perfil-completeness {
            margin-top: 16px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
        }

        .perfil-completeness-row {
            display: -webkit-flex;
            display: flex;
            -webkit-justify-content: space-between;
            justify-content: space-between;
            -webkit-align-items: center;
            align-items: center;
            margin-bottom: 6px;
        }

        .perfil-completeness-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-2);
        }

        .perfil-completeness-pct {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 800;
            color: var(--accent);
        }

        .perfil-completeness-bar {
            height: 5px;
            background: var(--bg-elevated);
            border-radius: 3px;
            overflow: hidden;
        }

        .perfil-completeness-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--gold-light));
            border-radius: 3px;
            -webkit-transition: width 0.6s ease;
            transition: width 0.6s ease;
        }

        .perfil-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 18px;
            margin-bottom: 16px;
        }

        .perfil-section-title {
            font-family: 'Sora', sans-serif;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 14px;
            display: -webkit-flex;
            display: flex;
            -webkit-align-items: center;
            align-items: center;
        }

        .perfil-section-title span { margin-right: 8px; }

        .perfil-field {
            margin-bottom: 14px;
        }

        .perfil-field:last-child { margin-bottom: 0; }

        .perfil-field label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .perfil-field input,
        .perfil-field select,
        .perfil-field textarea {
            width: 100%;
            padding: 12px 14px;
            font-size: 15px;
            background: var(--bg-elevated);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-1);
            font-family: inherit;
            -webkit-appearance: none;
            appearance: none;
        }

        .perfil-field textarea {
            resize: vertical;
            min-height: 70px;
        }

        .perfil-field input:focus,
        .perfil-field select:focus,
        .perfil-field textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(212,165,41,0.05);
            box-shadow: 0 0 0 3px rgba(212,165,41,0.1);
        }

        .perfil-row {
            display: -webkit-flex;
            display: flex;
            gap: 12px;
        }

        .perfil-row > .perfil-field {
            -webkit-flex: 1;
            flex: 1;
            min-width: 0;
        }

        .perfil-save-btn {
            width: 100%;
            padding: 16px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--accent), var(--gold-light));
            color: var(--bg-deep);
            font-family: 'Sora', sans-serif;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(212,165,41,0.3);
        }

        .perfil-save-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .perfil-divider {
            height: 1px;
            background: var(--border);
            margin: 14px 0;
        }

        .perfil-pwd-row {
            display: -webkit-flex;
            display: flex;
            gap: 12px;
        }

        .perfil-pwd-row > .perfil-field { -webkit-flex: 1; flex: 1; min-width: 0; }

        .perfil-logout-btn {
            width: 100%;
            padding: 14px;
            border-radius: var(--radius-md);
            background: transparent;
            color: var(--coral);
            border: 2px solid rgba(232,93,93,0.3);
            font-family: inherit;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            cursor: pointer;
            margin-top: 8px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 380px) {
            .main { padding: 14px 12px; padding-bottom: 76px; }
            .evo-seals-row { gap: 6px; }
            .evo-seal-circle { width: 44px; height: 44px; font-size: 18px; border-radius: 14px; }
            .podium { gap: 6px; }
        }

        @media (min-width: 769px) {
            .main { padding: 24px; padding-bottom: 80px; max-width: 560px; margin: 0 auto; }
        }

        /* ===== BROAD COMPATIBILITY ===== */
        /* Prefix transitions for older WebKit/Samsung/UC browsers */
        button, input, select, .card, .bnav-btn, .rank-ct-chip, .ct-btn, .evo-seal-circle {
            -webkit-transition: all 0.2s ease;
            -o-transition: all 0.2s ease;
            transition: all 0.2s ease;
        }

        /* Prefix transforms */
        .bnav-btn.active .bnav-icon {
            -webkit-transform: scale(1.15);
            -ms-transform: scale(1.15);
            transform: scale(1.15);
        }

        button:active {
            -webkit-transform: scale(0.97);
            -ms-transform: scale(0.97);
            transform: scale(0.97);
        }

        /* Prefix animations */
        @-webkit-keyframes fadeUp {
            from { opacity: 0; -webkit-transform: translateY(20px); transform: translateY(20px); }
            to { opacity: 1; -webkit-transform: translateY(0); transform: translateY(0); }
        }

        @-webkit-keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @-webkit-keyframes pulse-seal {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212,165,41,0.2); }
            50% { box-shadow: 0 0 0 8px rgba(212,165,41,0); }
        }

        /* Prefix gradient text for older Chrome/Samsung */
        .hdr-title, .login-title {
            -webkit-background-clip: text !important;
            background-clip: text;
        }

        /* Ensure touch targets min 44px */
        button, a, input, select, .bnav-btn, .rank-ct-chip, .ct-btn {
            min-height: 44px;
        }

        /* Fix 300ms tap delay on old Android */
        a, button, input, select {
            touch-action: manipulation;
        }

        /* Samsung Internet input fix */
        input, select, textarea {
            -webkit-border-radius: 14px;
            border-radius: 14px;
        }

        /* Prevent zoom on input focus (iOS) */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            select, textarea, input[type="text"], input[type="password"], input[type="email"] {
                font-size: 16px;
            }
        }

        /* Notch safe areas for all devices */
        @supports (padding-left: env(safe-area-inset-left)) {
            .hdr { padding-left: max(20px, env(safe-area-inset-left)); padding-right: max(20px, env(safe-area-inset-right)); }
            .main { padding-left: max(16px, env(safe-area-inset-left)); padding-right: max(16px, env(safe-area-inset-right)); }
        }

        /* ===== ADMIN PANEL - TEMA INDIGO (DIFERENTE DO ALUNO) ===== */
        /* Admin color palette */
        :root {
            --adm-primary: #818CF8;
            --adm-primary-bright: #A5B4FC;
            --adm-primary-dim: rgba(129,140,248,0.10);
            --adm-primary-glow: rgba(129,140,248,0.25);
            --adm-bg: #080a1a;
            --adm-bg-card: #0f1228;
            --adm-bg-elevated: #161938;
            --adm-border: rgba(129,140,248,0.12);
            --adm-border-accent: rgba(129,140,248,0.25);
            --adm-text-1: #E8E9F3;
            --adm-text-2: #9698B8;
            --adm-text-3: #5C5E80;
            --adm-green: #34D399;
            --adm-green-dim: rgba(52,211,153,0.12);
            --adm-red: #F87171;
            --adm-red-dim: rgba(248,113,113,0.12);
            --adm-amber: #FBBF24;
            --adm-amber-dim: rgba(251,191,36,0.12);
        }

        /* Admin screen wrapper - distinct background */
        #adminScreen {
            background: var(--adm-bg);
            min-height: calc(100vh - 120px);
            padding-bottom: 100px;
        }

        /* Admin page title bar */
        .adm-page-title {
            padding: 20px 0 4px;
            text-align: center;
        }
        .adm-page-title h2 {
            font-family: 'Sora', sans-serif;
            font-size: 16px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--adm-primary-bright), var(--adm-primary), #C4B5FD);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }
        .adm-page-title p {
            font-size: 11px;
            color: var(--adm-text-3);
            margin: 4px 0 0;
            letter-spacing: 0.5px;
        }

        .admin-container { max-width: 560px; margin: 0 auto; padding: 0 4px; }

        /* Admin welcome banner */
        .admin-welcome {
            display: flex; align-items: center; gap: 14px;
            padding: 18px 16px;
            background: linear-gradient(135deg, var(--adm-primary-dim), rgba(99,102,241,0.04));
            border-radius: 16px;
            margin-bottom: 18px;
            border: 1px solid var(--adm-border-accent);
            position: relative;
            overflow: hidden;
        }
        .admin-welcome::after {
            content: '';
            position: absolute; top: -30px; right: -30px;
            width: 100px; height: 100px;
            background: radial-gradient(circle, var(--adm-primary-glow), transparent 70%);
            pointer-events: none;
        }
        .admin-welcome-icon { font-size: 36px; z-index: 1; }
        .admin-welcome-text { z-index: 1; }
        .admin-welcome-title { font-family: 'Sora', sans-serif; font-size: 18px; font-weight: 700; color: var(--adm-text-1); }
        .admin-welcome-sub { font-size: 11px; color: var(--adm-primary); font-weight: 600; letter-spacing: 1px; text-transform: uppercase; margin-top: 2px; }

        /* Admin sections */
        .admin-section {
            background: var(--adm-bg-card);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 14px;
            border: 1px solid var(--adm-border);
        }
        .admin-section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
        .admin-section-title {
            font-family: 'Sora', sans-serif; font-size: 14px; font-weight: 700;
            color: var(--adm-primary-bright);
            display: flex; align-items: center; gap: 8px;
        }

        /* Admin badges */
        .admin-badge { background: var(--adm-red); color: #fff; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 20px; min-width: 20px; text-align: center; }
        .admin-badge.green { background: var(--adm-green); color: #0a0a0a; }
        .admin-badge.blue { background: var(--adm-primary); color: #0a0a0a; }

        .admin-empty { text-align: center; color: var(--adm-text-3); padding: 24px 0; font-size: 13px; }

        /* Admin stats grid */
        .admin-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 18px; }
        .admin-stat {
            background: var(--adm-bg-card);
            border-radius: 12px;
            padding: 12px 6px;
            text-align: center;
            border: 1px solid var(--adm-border);
            position: relative;
            overflow: hidden;
        }
        .admin-stat::before {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--adm-primary), transparent);
        }
        .admin-stat-num { font-family: 'Sora', sans-serif; font-size: 26px; font-weight: 800; color: var(--adm-primary-bright); }
        .admin-stat-label { font-size: 10px; color: var(--adm-text-3); margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
        .admin-stat.warn .admin-stat-num { color: var(--adm-amber); }
        .admin-stat.warn::before { background: linear-gradient(90deg, transparent, var(--adm-amber), transparent); }
        .admin-stat.ok .admin-stat-num { color: var(--adm-green); }
        .admin-stat.ok::before { background: linear-gradient(90deg, transparent, var(--adm-green), transparent); }

        /* Admin cards */
        .admin-card {
            background: var(--adm-bg-elevated);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--adm-border);
            transition: border-color 0.2s;
        }
        .admin-card:last-child { margin-bottom: 0; }
        .admin-card:hover { border-color: var(--adm-border-accent); }
        .admin-card-top { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .admin-card-avatar {
            width: 36px; height: 36px; border-radius: 50%;
            background: var(--adm-primary-dim); color: var(--adm-primary-bright);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 14px; flex-shrink: 0;
            border: 1px solid var(--adm-border-accent);
        }
        .admin-card-info { flex: 1; min-width: 0; }
        .admin-card-name { font-weight: 600; color: var(--adm-text-1); font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .admin-card-meta { font-size: 12px; color: var(--adm-text-2); margin-top: 2px; }
        .admin-card-detail { font-size: 12px; color: var(--adm-text-3); margin-bottom: 8px; padding-left: 46px; }
        .admin-card-actions { display: flex; gap: 8px; padding-left: 46px; }

        /* Admin buttons */
        .admin-btn { padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: none; transition: all 0.2s; min-height: 36px; }
        .admin-btn.approve { background: var(--adm-green); color: #0a0a0a; }
        .admin-btn.approve:hover { background: #5EEAD4; }
        .admin-btn.reject { background: transparent; color: var(--adm-red); border: 1px solid var(--adm-red-dim); }
        .admin-btn.reject:hover { background: var(--adm-red-dim); }
        .admin-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .admin-refresh-btn {
            background: transparent; color: var(--adm-primary);
            border: 1px solid var(--adm-border-accent);
            padding: 6px 12px; border-radius: 8px;
            font-size: 12px; font-weight: 600; cursor: pointer; min-height: 32px;
        }
        .admin-refresh-btn:hover { background: var(--adm-primary-dim); }

        /* Admin bulk approve */
        .admin-bulk-btn {
            width: 100%; padding: 12px; border-radius: 10px; border: none;
            background: linear-gradient(135deg, var(--adm-primary), #6366F1);
            color: #fff; font-weight: 700; font-size: 14px; cursor: pointer;
            margin-top: 12px; min-height: 44px;
            box-shadow: 0 4px 16px var(--adm-primary-glow);
        }
        .admin-bulk-btn:hover { opacity: 0.9; }
        .admin-bulk-btn:disabled { opacity: 0.4; cursor: not-allowed; box-shadow: none; }

        /* Admin filter row */
        .admin-filter-row { display: flex; gap: 8px; margin-bottom: 12px; }
        .admin-filter-btn {
            flex: 1; padding: 8px; border-radius: 8px;
            background: var(--adm-bg-elevated); color: var(--adm-text-3);
            border: 1px solid var(--adm-border); font-size: 12px; font-weight: 600;
            cursor: pointer; text-align: center; min-height: 36px;
            transition: all 0.2s;
        }
        .admin-filter-btn.active { background: var(--adm-primary-dim); color: var(--adm-primary-bright); border-color: var(--adm-border-accent); }

        /* Status badges */
        .admin-checkin-status { display: inline-block; font-size: 10px; font-weight: 700; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        .admin-checkin-status.pendente { background: var(--adm-amber-dim); color: var(--adm-amber); }
        .admin-checkin-status.aprovado { background: var(--adm-green-dim); color: var(--adm-green); }
        .admin-checkin-status.rejeitado { background: var(--adm-red-dim); color: var(--adm-red); }
        .admin-checkin-time { font-size: 11px; color: var(--adm-text-3); background: var(--adm-primary-dim); padding: 2px 8px; border-radius: 4px; display: inline-block; }

        /* Admin student list */
        .admin-student-card {
            background: var(--adm-bg-elevated); border-radius: 10px;
            padding: 12px; margin-bottom: 8px; border: 1px solid var(--adm-border);
            display: flex; align-items: center; gap: 10px;
        }
        .admin-student-card .admin-card-avatar { width: 32px; height: 32px; font-size: 13px; }
        .admin-student-info { flex: 1; min-width: 0; }
        .admin-student-name { font-weight: 600; color: var(--adm-text-1); font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .admin-student-meta { font-size: 11px; color: var(--adm-text-3); }
        .admin-student-belt { font-size: 11px; font-weight: 600; color: var(--adm-text-2); }
        .admin-student-delete { background: transparent; border: 1px solid var(--adm-red-dim); color: var(--adm-red); font-size: 11px; padding: 4px 10px; border-radius: 6px; cursor: pointer; min-height: 28px; }

        /* Admin header badge */
        .admin-header-badge {
            display: inline-block; font-size: 9px; font-weight: 700;
            color: var(--adm-primary-bright); background: var(--adm-primary-dim);
            padding: 2px 8px; border-radius: 4px; letter-spacing: 1px;
            margin-left: 8px; vertical-align: middle;
            border: 1px solid var(--adm-border-accent);
        }

        /* Admin bottom nav */
        #adminNav {
            background: var(--adm-bg-card) !important;
            border-top: 1px solid var(--adm-border) !important;
        }
        #adminNav .bnav-btn { color: var(--adm-text-3); }
        #adminNav .bnav-btn.active { color: var(--adm-primary-bright); }
        #adminNav .bnav-btn.active::after {
            content: '';
            position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; border-radius: 50%;
            background: var(--adm-primary);
        }
        #adminNav .bnav-btn { position: relative; }

        /* Admin inner inputs */
        #adminScreen input, #adminScreen select, #adminScreen textarea {
            background: var(--adm-bg-elevated);
            border-color: var(--adm-border);
            color: var(--adm-text-1);
        }
        #adminScreen input:focus, #adminScreen select:focus, #adminScreen textarea:focus {
            border-color: var(--adm-primary);
            box-shadow: 0 0 0 3px var(--adm-primary-dim);
        }
        #adminScreen .btn-primary {
            background: linear-gradient(135deg, var(--adm-primary), #6366F1);
            box-shadow: 0 4px 12px var(--adm-primary-glow);
        }
        #adminScreen .perfil-logout-btn {
            background: var(--adm-bg-elevated);
            border-color: var(--adm-border);
            color: var(--adm-red);
        }
        #adminScreen .section-title { color: var(--adm-text-2); }
        #adminScreen .ct-btn {
            background: var(--adm-bg-elevated);
            border-color: var(--adm-border);
            color: var(--adm-text-2);
        }
        #adminScreen .ct-btn.selected {
            background: var(--adm-primary-dim);
            border-color: var(--adm-primary);
            color: var(--adm-primary-bright);
        }
        #adminScreen .selected-ct-bar {
            background: var(--adm-primary-dim);
            border-color: var(--adm-border-accent);
            color: var(--adm-primary-bright);
        }
        #adminScreen .checkin-profile {
            background: var(--adm-bg-elevated);
            border-color: var(--adm-border);
        }
        #adminScreen .checkin-avatar {
            background: var(--adm-primary-dim);
            color: var(--adm-primary-bright);
            border-color: var(--adm-border-accent);
        }
        #adminScreen .checkin-name { color: var(--adm-text-1); }
        #adminScreen .checkin-count-num { color: var(--adm-primary-bright); }
        #adminScreen .checkin-count-label { color: var(--adm-text-3); }

        /* Admin perfil card */
        #adminScreen .perfil-card {
            background: var(--adm-bg-elevated);
            border-color: var(--adm-border);
        }
        #adminScreen .perfil-avatar {
            background: var(--adm-primary-dim);
            color: var(--adm-primary-bright);
            border-color: var(--adm-border-accent);
        }
        #adminScreen .perfil-name { color: var(--adm-text-1); }
        #adminScreen .perfil-email { color: var(--adm-text-3); }
        #adminScreen .form-label { color: var(--adm-text-2); }

        /* CT Schedule Admin */

        /* Report Dashboard */
        .report-kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 18px;
        }
        .report-kpi {
            background: var(--adm-card);
            border: 1px solid var(--adm-border);
            border-radius: 12px;
            padding: 14px;
            text-align: center;
        }
        .report-kpi-num {
            font-size: 26px;
            font-weight: 800;
            font-family: 'Sora', sans-serif;
        }
        .report-kpi-num.gold { color: var(--gold); }
        .report-kpi-num.green { color: #2ecc71; }
        .report-kpi-num.cyan { color: #67e8f9; }
        .report-kpi-num.purple { color: #c084fc; }
        .report-kpi-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--adm-text-3);
            margin-top: 2px;
        }
        .report-section {
            background: var(--adm-card);
            border: 1px solid var(--adm-border);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 14px;
        }
        .report-section-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--adm-text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 14px;
        }
        .report-bar-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .report-bar-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--adm-text-2);
            min-width: 50px;
            text-align: right;
            flex-shrink: 0;
        }
        .report-bar-track {
            flex: 1;
            height: 22px;
            background: rgba(255,255,255,0.04);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        .report-bar-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.6s ease;
            min-width: 2px;
        }
        .report-bar-fill.gold { background: linear-gradient(90deg, #d4af37, #f5d76e); }
        .report-bar-fill.green { background: linear-gradient(90deg, #2ecc71, #67e8f9); }
        .report-bar-fill.cyan { background: linear-gradient(90deg, #67e8f9, #22d3ee); }
        .report-bar-fill.purple { background: linear-gradient(90deg, #a78bfa, #c084fc); }
        .report-bar-value {
            font-size: 11px;
            font-weight: 700;
            color: var(--adm-text-1);
            min-width: 30px;
            text-align: left;
            flex-shrink: 0;
        }
        .report-pico-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 18px;
        }
        .report-pico {
            background: var(--adm-card);
            border: 1px solid var(--adm-border);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
        }
        .report-pico-icon { font-size: 20px; margin-bottom: 4px; }
        .report-pico-val {
            font-size: 14px;
            font-weight: 800;
            color: var(--gold);
        }
        .report-pico-lbl {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--adm-text-3);
            margin-top: 2px;
        }
        .report-table {
            width: 100%;
            font-size: 11px;
            border-collapse: collapse;
        }
        .report-table th {
            text-align: left;
            font-weight: 700;
            color: var(--adm-text-3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 10px;
            padding: 6px 4px;
            border-bottom: 1px solid var(--adm-border);
        }
        .report-table td {
            padding: 6px 4px;
            color: var(--adm-text-2);
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        .report-table tr:hover td { color: var(--adm-text-1); }
        .report-filter-row {
            display: flex;
            gap: 6px;
            margin-bottom: 14px;
            flex-wrap: wrap;
        }
        .report-filter-btn {
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid var(--adm-border);
            background: transparent;
            color: var(--adm-text-3);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .report-filter-btn.active {
            background: var(--adm-primary-dim);
            border-color: var(--adm-primary-bright);
            color: var(--adm-primary-bright);
        }

        /* CT Schedule Admin */
        .ct-schedule-card {
            background: var(--adm-card);
            border: 1px solid var(--adm-border);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 14px;
        }
        .ct-schedule-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .ct-schedule-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--adm-text-1);
        }
        .ct-schedule-status {
            font-size: 11px;
            font-weight: 600;
            padding: 3px 10px;
            border-radius: 20px;
        }
        .ct-schedule-status.saved { background: rgba(45,138,78,0.15); color: #2ecc71; }
        .ct-schedule-status.unsaved { background: rgba(212,175,55,0.15); color: var(--gold); }
        .ct-schedule-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }
        .ct-day-toggle {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: 8px 0;
            border-radius: 10px;
            border: 1px solid var(--adm-border);
            background: transparent;
            transition: all 0.2s;
            color: var(--adm-text-3);
        }
        .ct-day-toggle .ct-day-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .ct-day-toggle .ct-day-icon {
            font-size: 16px;
        }
        .ct-day-toggle.active {
            background: rgba(45,138,78,0.15);
            border-color: #2ecc71;
            color: #2ecc71;
        }
        .ct-day-toggle.active .ct-day-icon::after { content: '✓'; }
        .ct-day-toggle:not(.active) .ct-day-icon::after { content: '✕'; }
        .ct-schedule-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 12px;
        }
        .ct-schedule-save {
            background: var(--adm-green);
            color: #0a0a0a;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .ct-schedule-save:hover { background: #5EEAD4; }
        .ct-schedule-save:disabled { opacity: 0.5; cursor: default; }

        .adm-tab { display: none; }
        .adm-tab.active { display: block; }

        /* ===== BIRTHDAY CELEBRATION ===== */
        .bday-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9999;
            background: radial-gradient(ellipse at center, rgba(15,12,8,0.97) 0%, rgba(5,5,5,0.99) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: bdayFadeIn 0.6s ease;
            overflow: hidden;
        }
        @keyframes bdayFadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Confetti particles */
        .bday-confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 2px;
            top: -20px;
            animation: bdayFall linear forwards;
        }
        @keyframes bdayFall {
            0% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg) scale(0.5); opacity: 0; }
        }

        /* Glow ring */
        .bday-glow {
            position: absolute;
            width: 280px; height: 280px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(212,175,55,0.15) 0%, transparent 70%);
            animation: bdayPulse 2.5s ease-in-out infinite;
        }
        @keyframes bdayPulse {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.3); opacity: 1; }
        }

        .bday-card {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 340px;
            padding: 32px 24px;
            animation: bdaySlideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.3s both;
        }
        @keyframes bdaySlideUp {
            from { transform: translateY(40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .bday-emoji {
            font-size: 64px;
            margin-bottom: 8px;
            animation: bdayBounce 1s ease infinite;
        }
        @keyframes bdayBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        .bday-title {
            font-family: 'Sora', sans-serif;
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #d4af37, #f5d76e, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
            line-height: 1.2;
        }

        .bday-name {
            font-family: 'Sora', sans-serif;
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 16px;
        }

        .bday-msg {
            font-size: 14px;
            color: var(--text-2);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .bday-stats {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        .bday-stat {
            background: rgba(212,175,55,0.08);
            border: 1px solid rgba(212,175,55,0.2);
            border-radius: 12px;
            padding: 12px 14px;
            text-align: center;
            min-width: 70px;
        }
        .bday-stat-num {
            font-size: 22px;
            font-weight: 800;
            color: var(--gold);
            font-family: 'Sora', sans-serif;
        }
        .bday-stat-lbl {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-3);
            margin-top: 2px;
            font-weight: 600;
        }

        .bday-quote {
            font-size: 13px;
            font-style: italic;
            color: var(--text-3);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .bday-family {
            font-size: 12px;
            color: var(--gold);
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 24px;
        }

        .bday-close {
            background: linear-gradient(135deg, #d4af37, #b8972e);
            color: #0a0a0a;
            border: none;
            padding: 12px 32px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 800;
            cursor: pointer;
            font-family: 'Sora', sans-serif;
            letter-spacing: 0.5px;
            transition: transform 0.2s;
        }
        .bday-close:hover { transform: scale(1.05); }
        .bday-close:active { transform: scale(0.97); }

        /* ===== REWARDS / GAMIFICATION ===== */
        .rwd-container { padding: 16px; max-width: 460px; margin: 0 auto; }

        /* Tier Hero Card */
        .rwd-hero {
            position: relative;
            border-radius: 20px;
            padding: 28px 20px 20px;
            text-align: center;
            overflow: hidden;
            margin-bottom: 16px;
        }
        .rwd-hero.bronze { background: linear-gradient(135deg, #1a1510 0%, #2a1f14 50%, #1a1510 100%); border: 1px solid rgba(205,127,50,0.25); }
        .rwd-hero.prata { background: linear-gradient(135deg, #141618 0%, #1e2226 50%, #141618 100%); border: 1px solid rgba(192,192,192,0.25); }
        .rwd-hero.ouro { background: linear-gradient(135deg, #1a1708 0%, #2a2510 50%, #1a1708 100%); border: 1px solid rgba(212,175,55,0.3); }
        .rwd-hero.diamante { background: linear-gradient(135deg, #0a1520 0%, #102030 50%, #0a1520 100%); border: 1px solid rgba(100,200,255,0.3); }

        .rwd-hero-shimmer {
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.03) 50%, transparent 70%);
            animation: rwdShimmer 4s ease-in-out infinite;
        }
        @keyframes rwdShimmer { 0%, 100% { transform: translateX(-30%) rotate(0deg); } 50% { transform: translateX(30%) rotate(5deg); } }

        .rwd-tier-icon { font-size: 48px; margin-bottom: 4px; position: relative; z-index: 1; }
        .rwd-tier-name {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2.5px;
            margin-bottom: 2px;
            position: relative; z-index: 1;
        }
        .rwd-hero.bronze .rwd-tier-name { color: #cd7f32; }
        .rwd-hero.prata .rwd-tier-name { color: #c0c0c0; }
        .rwd-hero.ouro .rwd-tier-name { color: #d4af37; }
        .rwd-hero.diamante .rwd-tier-name { color: #64c8ff; }

        .rwd-pontos {
            font-family: 'Sora', sans-serif;
            font-size: 42px;
            font-weight: 900;
            color: #fff;
            line-height: 1;
            margin-bottom: 2px;
            position: relative; z-index: 1;
        }
        .rwd-pontos-label { font-size: 11px; color: var(--text-3); letter-spacing: 1px; text-transform: uppercase; font-weight: 600; margin-bottom: 16px; position: relative; z-index: 1; }

        /* Desconto badge */
        .rwd-desconto {
            display: inline-block;
            padding: 6px 18px;
            border-radius: 20px;
            font-family: 'Sora', sans-serif;
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 14px;
            position: relative; z-index: 1;
        }
        .rwd-hero.bronze .rwd-desconto { background: rgba(205,127,50,0.12); color: #cd7f32; border: 1px solid rgba(205,127,50,0.25); }
        .rwd-hero.prata .rwd-desconto { background: rgba(192,192,192,0.12); color: #e0e0e0; border: 1px solid rgba(192,192,192,0.25); }
        .rwd-hero.ouro .rwd-desconto { background: rgba(212,175,55,0.15); color: #f5d76e; border: 1px solid rgba(212,175,55,0.3); }
        .rwd-hero.diamante .rwd-desconto { background: rgba(100,200,255,0.12); color: #64c8ff; border: 1px solid rgba(100,200,255,0.3); }

        /* Progress bar to next tier */
        .rwd-progress { position: relative; z-index: 1; }
        .rwd-progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-3);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .rwd-progress-track {
            height: 8px;
            background: rgba(255,255,255,0.06);
            border-radius: 4px;
            overflow: hidden;
        }
        .rwd-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .rwd-hero.bronze .rwd-progress-fill { background: linear-gradient(90deg, #8b5a2b, #cd7f32); }
        .rwd-hero.prata .rwd-progress-fill { background: linear-gradient(90deg, #808080, #c0c0c0); }
        .rwd-hero.ouro .rwd-progress-fill { background: linear-gradient(90deg, #b8972e, #f5d76e); }
        .rwd-hero.diamante .rwd-progress-fill { background: linear-gradient(90deg, #2890c8, #64c8ff); }

        /* Stats row */
        .rwd-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 16px; }
        .rwd-stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 14px 8px;
            text-align: center;
        }
        .rwd-stat-icon { font-size: 20px; margin-bottom: 4px; }
        .rwd-stat-num { font-family: 'Sora', sans-serif; font-size: 20px; font-weight: 800; color: #fff; }
        .rwd-stat-lbl { font-size: 9px; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-3); font-weight: 600; margin-top: 2px; }

        /* Breakdown */
        .rwd-section {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
        }
        .rwd-section-title {
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-2);
            margin-bottom: 12px;
        }
        .rwd-breakdown-row {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        .rwd-breakdown-row:last-child { border-bottom: none; }
        .rwd-breakdown-icon { font-size: 18px; margin-right: 10px; width: 28px; text-align: center; }
        .rwd-breakdown-label { flex: 1; font-size: 13px; color: var(--text-2); }
        .rwd-breakdown-pts {
            font-family: 'Sora', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: var(--gold);
        }

        /* How to earn */
        .rwd-rule-row {
            display: flex;
            align-items: center;
            padding: 7px 0;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        .rwd-rule-row:last-child { border-bottom: none; }
        .rwd-rule-icon { font-size: 16px; margin-right: 10px; width: 26px; text-align: center; }
        .rwd-rule-text { flex: 1; font-size: 12px; color: var(--text-3); }
        .rwd-rule-pts { font-size: 12px; font-weight: 700; color: var(--gold); font-family: 'Sora', sans-serif; }

        /* Tier ladder */
        .rwd-ladder { display: flex; flex-direction: column; gap: 6px; }
        .rwd-ladder-row {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-radius: 10px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.04);
            transition: all 0.3s;
        }
        .rwd-ladder-row.active { border-color: var(--gold); background: rgba(212,175,55,0.06); }
        .rwd-ladder-icon { font-size: 20px; margin-right: 10px; }
        .rwd-ladder-info { flex: 1; }
        .rwd-ladder-name { font-size: 13px; font-weight: 700; color: var(--text-1); }
        .rwd-ladder-range { font-size: 10px; color: var(--text-3); }
        .rwd-ladder-pct { font-family: 'Sora', sans-serif; font-size: 15px; font-weight: 800; }
        .rwd-ladder-row.active .rwd-ladder-pct { color: var(--gold); }

        /* History mini bars */
        .rwd-hist-row {
            display: flex;
            align-items: center;
            padding: 6px 0;
        }
        .rwd-hist-label { font-size: 11px; color: var(--text-3); min-width: 65px; font-weight: 600; }
        .rwd-hist-track { flex: 1; height: 18px; background: rgba(255,255,255,0.04); border-radius: 5px; overflow: hidden; margin: 0 8px; }
        .rwd-hist-fill { height: 100%; border-radius: 5px; background: linear-gradient(90deg, #b8972e, #d4af37); transition: width 0.6s ease; }
        .rwd-hist-val { font-size: 11px; font-weight: 700; color: var(--text-2); min-width: 36px; text-align: right; font-family: 'Sora', sans-serif; }

        /* CTs visited */
        .rwd-ct-tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .rwd-ct-tag {
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }
        .rwd-ct-tag.home { background: rgba(212,175,55,0.12); color: var(--gold); border: 1px solid rgba(212,175,55,0.25); }
        .rwd-ct-tag.visit { background: rgba(100,200,255,0.08); color: #64c8ff; border: 1px solid rgba(100,200,255,0.2); }
    </style>
</head>
<body>
    <div class="app">
        <!-- HEADER -->
        <div class="hdr">
            <div class="hdr-brand">
                                <div style="display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-flex-direction:column;flex-direction:column;">
                    <div class="hdr-title">JIU JITSU ACADEMY</div>
                    <div id="headerSubtitle" style="font-size:10px;letter-spacing:1.5px;color:var(--text-2);font-weight:600;text-transform:uppercase;font-family:'Sora',sans-serif;">Checkin</div>
                </div>
            </div>
            <div class="hdr-user" id="headerUser" onclick="handleLogout()">
                <div class="hdr-avatar" id="userInitial">L</div>
                <div class="hdr-name" id="headerUserName">User</div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main">
            <!-- LOGIN -->
            <div id="loginScreen">
                <div class="login-hero">
                    <h1 class="login-title">JIU JITSU ACADEMY</h1>
                    <p class="login-sub">Checkin de Treinos</p>
                </div>

                <div class="login-box">
                    <div id="loginTab">
                        <div class="form-card">
                            <div class="form-card-title">Entrar</div>
                            <form onsubmit="handleLogin(event)">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="loginEmail" placeholder="seu@email.com" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Senha</label>
                                    <div class="password-wrapper">
                                        <input type="password" id="loginPassword" placeholder="••••••" required>
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('loginPassword', this)" title="Mostrar senha">👁</button>
                                    </div>
                                </div>
                                <div id="loginMessage"></div>
                                <button type="submit" class="btn btn-primary">Entrar</button>
                            </form>
                        </div>
                        <button class="btn btn-outline" onclick="showRegister()">Criar Nova Conta</button>
                        <button class="btn" onclick="showForgotPassword()" style="background:transparent;color:var(--text-3);font-size:13px;margin-top:4px;text-decoration:underline;border:none;cursor:pointer;">Esqueci minha senha</button>
                    </div>

                    <div id="registerTab" style="display: none;">
                        <div class="form-card">
                            <div class="form-card-title">Cadastro</div>
                            <form onsubmit="handleRegister(event)">
                                <div class="form-group">
                                    <label class="form-label">Nome Completo</label>
                                    <input type="text" id="regName" placeholder="Seu Nome" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="regEmail" placeholder="seu@email.com" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Senha</label>
                                    <div class="password-wrapper">
                                        <input type="password" id="regPassword" placeholder="Mínimo 6 caracteres" required minlength="6">
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('regPassword', this)" title="Mostrar senha">👁</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirmar Senha</label>
                                    <div class="password-wrapper">
                                        <input type="password" id="regPasswordConfirm" placeholder="Repita a senha" required minlength="6">
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('regPasswordConfirm', this)" title="Mostrar senha">👁</button>
                                    </div>
                                    <div class="password-match-hint" id="passwordMatchHint"></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Faixa</label>
                                    <select id="regFaixa" required>
                                        <option value="">Selecione sua faixa</option>
                                        <option value="Branca">⚪ Branca</option>
                                        <option value="Azul">🔵 Azul</option>
                                        <option value="Roxa">🟣 Roxa</option>
                                        <option value="Marrom">🟤 Marrom</option>
                                        <option value="Preta">⚫ Preta</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Grau</label>
                                    <select id="regGrau" required>
                                        <option value="">Selecione o grau</option>
                                        <option value="0">0</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">CT Principal</label>
                                    <select id="regCT" required>
                                        <option value="">Selecione seu CT</option>
                                    </select>
                                </div>
                                <div id="registerMessage"></div>
                                <button type="submit" class="btn btn-primary">Cadastrar</button>
                            </form>
                        </div>
                        <button class="btn btn-outline" onclick="showLogin()">Voltar ao Login</button>
                    </div>

                    <div id="forgotTab" style="display: none;">
                        <div class="form-card">
                            <div class="form-card-title">🔑 Recuperar Senha</div>
                            <p style="font-size:12px;color:var(--text-3);margin-bottom:16px;">Digite seu email cadastrado e uma nova senha. O Professor irá avaliar e aprovar a alteração.</p>
                            <form onsubmit="handleForgotPassword(event)">
                                <div class="form-group">
                                    <label class="form-label">Email cadastrado</label>
                                    <input type="email" id="forgotEmail" placeholder="seu@email.com" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nova Senha</label>
                                    <div class="password-wrapper">
                                        <input type="password" id="forgotPassword" placeholder="Mínimo 6 caracteres" required minlength="6">
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('forgotPassword', this)" title="Mostrar senha">👁</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirmar Nova Senha</label>
                                    <div class="password-wrapper">
                                        <input type="password" id="forgotPasswordConfirm" placeholder="Repita a nova senha" required minlength="6">
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('forgotPasswordConfirm', this)" title="Mostrar senha">👁</button>
                                    </div>
                                </div>
                                <div id="forgotMessage"></div>
                                <button type="submit" class="btn btn-primary">Solicitar Nova Senha</button>
                            </form>
                        </div>
                        <button class="btn btn-outline" onclick="showLogin()">Voltar ao Login</button>
                    </div>
                </div>
            </div>

            <!-- APP -->
            <div id="appScreen" style="display:none;">
                <!-- TAB: CHECK-IN -->
                <div id="attendance" class="tab-content active">
                    <div class="checkin-profile">
                        <div class="checkin-avatar" id="checkinInitial">L</div>
                        <div class="checkin-info">
                            <div class="checkin-name" id="displayName">-</div>
                            <div class="checkin-meta"><span id="displayFaixa">-</span></div>
                        </div>
                        <div class="checkin-count">
                            <div class="checkin-count-num" id="displayCount">0</div>
                            <div class="checkin-count-label">Treinos</div>
                        </div>
                    </div>

                    <div class="ct-section">
                        <div class="section-title">Onde você treinou?</div>
                        <div class="ct-grid" id="ctGrid"></div>
                        <div class="selected-ct-bar" id="selectedInfo">
                            <span>Academia:</span>
                            <span id="selectedCT">-</span>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="confirmAttendance()">✓ Confirmar Presença</button>
                    <div id="attendanceMessage"></div>

                    <button class="btn btn-danger-outline" onclick="handleLogout()" style="margin-top: 24px;">Sair da Conta</button>
                </div>

                <!-- TAB: RANKING -->
                <div id="ranking" class="tab-content">
                    <div class="rank-period" id="periodFilterGrid">
                        <button class="rank-period-btn active" onclick="switchRankingPeriod('mes', event)">📅 Este Mês</button>
                        <button class="rank-period-btn" onclick="switchRankingPeriod('ano', event)">📆 Este Ano</button>
                    </div>

                    <div class="rank-ct-scroll" id="ctFilterGrid"></div>

                    <div class="user-stats-card" id="userTrainingSection">
                        <div class="section-title" style="margin-bottom:12px;">Seus treinos</div>
                        <div class="user-stats-row">
                            <div class="user-stats-total">
                                <div class="user-stats-num" id="userTotalCount">0</div>
                                <div class="user-stats-lbl" id="userTotalLabel">treinos</div>
                            </div>
                            <div class="user-ct-grid" id="userTrainingGrid"></div>
                        </div>
                    </div>

                    <div class="podium" id="top3Container"></div>

                    <div class="user-pos-card" id="userPositionSection">
                        <div class="user-pos-inner" id="userPositionCard"></div>
                    </div>

                    <div id="rankingListSection" style="display:none;">
                        <div class="section-title" style="margin-bottom:12px;">Ranking</div>
                        <div class="rank-list" id="rankingList"></div>
                    </div>

                    <div id="ctRankingContainer" style="display:none;">
                        <div class="section-title" id="ctRankingTitle" style="margin-bottom:12px;">Ranking</div>
                        <div class="rank-list" id="ctRankingList"></div>
                    </div>

                    <div id="rankingMessage" style="text-align:center; padding:30px; color:var(--text-3); font-size: 13px;">Carregando ranking...</div>
                </div>

                <!-- TAB: EVOLUÇÃO -->
                <div id="evolucao" class="tab-content">
                    <div class="evo-container">
                        <div class="evo-motivation" id="evoMotivation">
                            <div class="evo-motivation-icon">🔥</div>
                            <div class="evo-motivation-text" id="evoMotivationText">"Consistência constrói campeões."</div>
                            <div class="evo-motivation-sub" id="evoMotivationSub">Continue firme no tatame</div>
                        </div>

                        <div class="evo-hero" id="evoHero">
                            <div class="evo-hero-belt branca" id="evoHeroBelt">🥋</div>
                            <div class="evo-hero-info">
                                <div class="evo-hero-title" id="evoHeroTitle">Faixa Branca</div>
                                <div class="evo-hero-sub" id="evoHeroSub">Próxima: Azul</div>
                                <div id="evoHeroStatus"></div>
                            </div>
                            <div class="evo-hero-stats">
                                <div class="evo-hero-stat">
                                    <div class="evo-hero-stat-val" id="evoStatTreinos">0</div>
                                    <div class="evo-hero-stat-lbl">Treinos</div>
                                </div>
                                <div class="evo-hero-stat">
                                    <div class="evo-hero-stat-val" id="evoStatSemestre">0</div>
                                    <div class="evo-hero-stat-lbl">Semestre</div>
                                </div>
                            </div>
                        </div>

                        <div class="evo-seals">
                            <div class="evo-seals-title">🏅 Selos de Grau</div>
                            <div class="evo-seals-row" id="evoSealsRow"></div>
                        </div>

                        <div class="evo-freq">
                            <div class="evo-freq-row">
                                <div class="evo-freq-left">📊 Frequência Semestre</div>
                                <div class="evo-freq-pct" id="evoFreqPct">0%</div>
                            </div>
                            <div class="evo-freq-bar-bg">
                                <div class="evo-freq-bar-fill" id="evoFreqBarFill" style="width:0%"></div>
                            </div>
                            <div class="evo-freq-sub" id="evoFreqDetail">0 de 48 aulas possíveis</div>
                        </div>

                        <div class="evo-criteria-section" id="evoFaixaCriteria">
                            <div class="evo-criteria-header">
                                <div class="evo-criteria-header-icon">🏅</div>
                                <div class="evo-criteria-header-text" id="evoFaixaCriteriaTitle">Exame de Faixa</div>
                                <div class="evo-criteria-header-sub" id="evoFaixaProgress">0/6</div>
                            </div>
                            <div class="evo-criteria-list" id="evoFaixaCriteriaList"></div>
                        </div>

                        <button class="evo-exam-btn disabled" id="evoExamBtn" disabled>🔒 Critérios pendentes para Exame de Faixa</button>

                        <div class="ibjjf-roadmap">
                            <div class="ibjjf-title">🥋 Sistema de Graduação IBJJF</div>
                            <div class="ibjjf-subtitle">Seu caminho da Faixa Branca até a Faixa Preta</div>

                            <div class="ibjjf-legend">
                                <div class="ibjjf-legend-item"><div class="ibjjf-legend-dot past"></div>Concluída</div>
                                <div class="ibjjf-legend-item"><div class="ibjjf-legend-dot current"></div>Atual</div>
                                <div class="ibjjf-legend-item"><div class="ibjjf-legend-dot next"></div>Próxima</div>
                                <div class="ibjjf-legend-item"><div class="ibjjf-legend-dot future"></div>Futuro</div>
                            </div>

                            <div class="ibjjf-track" id="ibjjfTrack">
                                <div class="ibjjf-track-fill" id="ibjjfTrackFill" style="height:0%"></div>
                            </div>

                            <div class="ibjjf-summary">
                                <div class="ibjjf-summary-row">
                                    <div class="ibjjf-summary-label">Progresso Geral</div>
                                    <div class="ibjjf-summary-val" id="ibjjfOverallPct">0%</div>
                                </div>
                                <div class="ibjjf-summary-bar-bg">
                                    <div class="ibjjf-summary-bar-fill" id="ibjjfOverallFill" style="width:0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PERFIL TAB -->

                <!-- REWARDS TAB -->
                <div id="rewards" class="tab-content">
                    <div class="rwd-container">
                        <!-- Hero Tier Card -->
                        <div class="rwd-hero bronze" id="rwdHero">
                            <div class="rwd-hero-shimmer"></div>
                            <div class="rwd-tier-icon" id="rwdTierIcon">🥉</div>
                            <div class="rwd-tier-name" id="rwdTierName">BRONZE</div>
                            <div class="rwd-pontos" id="rwdPontos">0</div>
                            <div class="rwd-pontos-label">Pontos este mês</div>
                            <div class="rwd-desconto" id="rwdDesconto">Sem desconto</div>
                            <div class="rwd-progress" id="rwdProgressSection">
                                <div class="rwd-progress-labels">
                                    <span id="rwdProgressLeft">Bronze</span>
                                    <span id="rwdProgressRight">Prata (100 pts)</span>
                                </div>
                                <div class="rwd-progress-track">
                                    <div class="rwd-progress-fill" id="rwdProgressFill" style="width:0%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Stats -->
                        <div class="rwd-stats">
                            <div class="rwd-stat-card">
                                <div class="rwd-stat-icon">🏠</div>
                                <div class="rwd-stat-num" id="rwdHomeCount">0</div>
                                <div class="rwd-stat-lbl">CT Base</div>
                            </div>
                            <div class="rwd-stat-card">
                                <div class="rwd-stat-icon">🌍</div>
                                <div class="rwd-stat-num" id="rwdVisitCount">0</div>
                                <div class="rwd-stat-lbl">Visitante</div>
                            </div>
                            <div class="rwd-stat-card">
                                <div class="rwd-stat-icon">📍</div>
                                <div class="rwd-stat-num" id="rwdCTsCount">0</div>
                                <div class="rwd-stat-lbl">CTs</div>
                            </div>
                        </div>

                        <!-- CTs Visitados -->
                        <div class="rwd-section" id="rwdCTsSection" style="display:none;">
                            <div class="rwd-section-title">📍 CTs Visitados</div>
                            <div class="rwd-ct-tags" id="rwdCTsTags"></div>
                        </div>

                        <!-- Breakdown -->
                        <div class="rwd-section">
                            <div class="rwd-section-title">⚡ Detalhamento de Pontos</div>
                            <div id="rwdBreakdown">
                                <div style="text-align:center;color:var(--text-3);font-size:12px;padding:12px;">Carregando...</div>
                            </div>
                        </div>

                        <!-- Histórico -->
                        <div class="rwd-section">
                            <div class="rwd-section-title">📊 Histórico Mensal</div>
                            <div id="rwdHistorico"></div>
                        </div>

                        <!-- Tier Ladder -->
                        <div class="rwd-section">
                            <div class="rwd-section-title">🏅 Níveis de Desconto</div>
                            <div class="rwd-ladder" id="rwdLadder"></div>
                        </div>

                        <!-- How to Earn -->
                        <div class="rwd-section">
                            <div class="rwd-section-title">🎯 Como Ganhar Pontos</div>
                            <div class="rwd-rule-row"><div class="rwd-rule-icon">🏠</div><div class="rwd-rule-text">Check-in no seu CT Base</div><div class="rwd-rule-pts">+10 pts</div></div>
                            <div class="rwd-rule-row"><div class="rwd-rule-icon">🌍</div><div class="rwd-rule-text">Check-in em outro CT (visitante)</div><div class="rwd-rule-pts">+15 pts</div></div>
                            <div class="rwd-rule-row"><div class="rwd-rule-icon">🔥</div><div class="rwd-rule-text">3+ treinos na semana</div><div class="rwd-rule-pts">+20 pts</div></div>
                            <div class="rwd-rule-row"><div class="rwd-rule-icon">💪</div><div class="rwd-rule-text">5+ treinos na semana</div><div class="rwd-rule-pts">+50 pts</div></div>
                            <div class="rwd-rule-row"><div class="rwd-rule-icon">📍</div><div class="rwd-rule-text">Treinar em 2 CTs no mês</div><div class="rwd-rule-pts">+30 pts</div></div>
                            <div class="rwd-rule-row"><div class="rwd-rule-icon">🗺️</div><div class="rwd-rule-text">Treinar em 3+ CTs no mês</div><div class="rwd-rule-pts">+60 pts</div></div>
                        </div>
                    </div>
                </div>

                <div id="perfil" class="tab-content">
                    <div class="perfil-container">
                        <div class="perfil-header">
                            <div class="perfil-avatar-big" id="perfilAvatar">?</div>
                            <div class="perfil-nome" id="perfilNome">—</div>
                            <div class="perfil-faixa-tag" id="perfilFaixaTag">—</div>
                            <div class="perfil-completeness">
                                <div class="perfil-completeness-row">
                                    <div class="perfil-completeness-label">📋 Perfil completo</div>
                                    <div class="perfil-completeness-pct" id="perfilCompletePct">0%</div>
                                </div>
                                <div class="perfil-completeness-bar">
                                    <div class="perfil-completeness-fill" id="perfilCompleteFill" style="width:0%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="perfil-section">
                            <div class="perfil-section-title"><span>👤</span> Dados Pessoais</div>
                            <div class="perfil-field">
                                <label>Data de Nascimento</label>
                                <input type="date" id="perfilNascimento">
                            </div>
                            <div class="perfil-row">
                                <div class="perfil-field">
                                    <label>Gênero</label>
                                    <select id="perfilGenero">
                                        <option value="">Selecione</option>
                                        <option value="Masculino">Masculino</option>
                                        <option value="Feminino">Feminino</option>
                                        <option value="Outro">Outro</option>
                                        <option value="Prefiro não dizer">Prefiro não dizer</option>
                                    </select>
                                </div>
                                <div class="perfil-field">
                                    <label>Profissão</label>
                                    <input type="text" id="perfilProfissao" placeholder="Ex: Engenheiro, Professor...">
                                </div>
                            </div>
                            <div class="perfil-field">
                                <label>Bairro / Cidade</label>
                                <input type="text" id="perfilBairro" placeholder="Ex: Tijuca - Rio de Janeiro">
                            </div>
                        </div>

                        <div class="perfil-section">
                            <div class="perfil-section-title"><span>📱</span> Contato</div>
                            <div class="perfil-field">
                                <label>Telefone / WhatsApp</label>
                                <input type="tel" id="perfilTelefone" placeholder="(21) 99999-9999">
                            </div>
                            <div class="perfil-field">
                                <label>Instagram</label>
                                <input type="text" id="perfilInstagram" placeholder="@seuusuario">
                            </div>
                            <div class="perfil-field">
                                <label>Contato de Emergência</label>
                                <input type="text" id="perfilEmergencia" placeholder="Nome — (21) 99999-9999">
                            </div>
                        </div>

                        <div class="perfil-section">
                            <div class="perfil-section-title"><span>🥋</span> Sobre seu Jiu Jitsu</div>
                            <div class="perfil-field">
                                <label>Como conheceu a academia?</label>
                                <select id="perfilOrigem">
                                    <option value="">Selecione</option>
                                    <option value="Indicação de amigo">Indicação de amigo</option>
                                    <option value="Indicação de aluno">Indicação de aluno</option>
                                    <option value="Instagram">Instagram</option>
                                    <option value="Facebook">Facebook</option>
                                    <option value="TikTok">TikTok</option>
                                    <option value="Google / Busca">Google / Busca</option>
                                    <option value="Passei na frente">Passei na frente</option>
                                    <option value="Evento / Campeonato">Evento / Campeonato</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                            <div class="perfil-field">
                                <label>Objetivo no Jiu Jitsu</label>
                                <select id="perfilObjetivo">
                                    <option value="">Selecione</option>
                                    <option value="Saúde e condicionamento">Saúde e condicionamento</option>
                                    <option value="Defesa pessoal">Defesa pessoal</option>
                                    <option value="Competição">Competição</option>
                                    <option value="Hobby / Lazer">Hobby / Lazer</option>
                                    <option value="Disciplina / Foco">Disciplina / Foco</option>
                                    <option value="Socializar">Socializar</option>
                                    <option value="Faixa preta">Chegar à faixa preta</option>
                                </select>
                            </div>
                            <div class="perfil-field">
                                <label>Horário preferido de treino</label>
                                <select id="perfilHorario">
                                    <option value="">Selecione</option>
                                    <option value="Manhã (6h-11h)">Manhã (6h-11h)</option>
                                    <option value="Almoço (11h-14h)">Almoço (11h-14h)</option>
                                    <option value="Tarde (14h-18h)">Tarde (14h-18h)</option>
                                    <option value="Noite (18h-22h)">Noite (18h-22h)</option>
                                    <option value="Flexível">Flexível</option>
                                </select>
                            </div>
                            <div class="perfil-field">
                                <label>Experiência anterior</label>
                                <select id="perfilExperiencia">
                                    <option value="">Selecione</option>
                                    <option value="Nunca treinei">Nunca treinei</option>
                                    <option value="Menos de 1 ano">Menos de 1 ano</option>
                                    <option value="1-2 anos">1-2 anos</option>
                                    <option value="3-5 anos">3-5 anos</option>
                                    <option value="5-10 anos">5-10 anos</option>
                                    <option value="10+ anos">10+ anos</option>
                                </select>
                            </div>
                        </div>

                        <div class="perfil-section">
                            <div class="perfil-section-title"><span>🏥</span> Saúde e Segurança</div>
                            <div class="perfil-field">
                                <label>Lesão ou condição médica</label>
                                <textarea id="perfilSaude" placeholder="Ex: Lesão no joelho, hérnia de disco, asma..."></textarea>
                            </div>
                        </div>

                        <div id="perfilMessage"></div>
                        <button class="perfil-save-btn" id="perfilSaveBtn" onclick="saveProfile()">💾 Salvar Perfil</button>

                        <div class="perfil-section" style="margin-top:16px;">
                            <div class="perfil-section-title"><span>🔒</span> Alterar Senha</div>
                            <div class="perfil-field">
                                <label>Senha Atual</label>
                                <input type="password" id="perfilSenhaAtual" placeholder="••••••">
                            </div>
                            <div class="perfil-pwd-row">
                                <div class="perfil-field">
                                    <label>Nova Senha</label>
                                    <input type="password" id="perfilSenhaNova" placeholder="••••••">
                                </div>
                                <div class="perfil-field">
                                    <label>Confirmar</label>
                                    <input type="password" id="perfilSenhaConfirma" placeholder="••••••">
                                </div>
                            </div>
                            <div id="perfilPwdMessage"></div>
                            <button class="perfil-save-btn" style="margin-top:10px" onclick="changePassword()">🔑 Alterar Senha</button>
                        </div>

                        <button class="perfil-logout-btn" onclick="handleLogout()">🚪 Sair da Conta</button>
                    </div>
                </div>

            </div>
            <!-- end appScreen -->

            <!-- ============================================= -->
            <!-- ===== ADMIN SCREEN (TOTALMENTE SEPARADO) ==== -->
            <!-- ============================================= -->
            <div id="adminScreen" style="display:none;">

            <!-- TAB: PAINEL (Dashboard) -->
            <div id="adm-painel" class="adm-tab active">
                <div class="admin-container">
                    <div class="adm-page-title">
                        <h2>Painel do Administrador</h2>
                        <p>Gestão de alunos e presenças</p>
                    </div>

                    <div class="admin-welcome">
                        <div class="admin-welcome-icon">🥋</div>
                        <div class="admin-welcome-text">
                            <div class="admin-welcome-title" id="adminWelcomeName">Professor</div>
                            <div class="admin-welcome-sub">Bem-vindo ao painel</div>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="admin-stats">
                        <div class="admin-stat warn">
                            <div class="admin-stat-num" id="adminPendingAccountsCount">0</div>
                            <div class="admin-stat-label">Cadastros</div>
                        </div>
                        <div class="admin-stat warn">
                            <div class="admin-stat-num" id="adminPendingResetsCount">0</div>
                            <div class="admin-stat-label">Senhas</div>
                        </div>
                        <div class="admin-stat warn">
                            <div class="admin-stat-num" id="adminPendingCheckinsCount">0</div>
                            <div class="admin-stat-label">Pendentes</div>
                        </div>
                        <div class="admin-stat ok">
                            <div class="admin-stat-num" id="adminTodayCheckinsCount">0</div>
                            <div class="admin-stat-label">Hoje</div>
                        </div>
                    </div>

                    <!-- Pending Accounts -->
                    <div class="admin-section">
                        <div class="admin-section-header">
                            <div class="admin-section-title">🆕 Novos Alunos <span class="admin-badge" id="adminAccBadge" style="display:none">0</span></div>
                            <button class="admin-refresh-btn" onclick="loadPendingAccounts()">↻</button>
                        </div>
                        <div id="adminAccountsList">
                            <div class="admin-empty">Carregando...</div>
                        </div>
                    </div>

                    <!-- Pending Password Resets -->
                    <div class="admin-section">
                        <div class="admin-section-header">
                            <div class="admin-section-title">🔑 Reset de Senha <span class="admin-badge" id="adminResetBadge" style="display:none">0</span></div>
                            <button class="admin-refresh-btn" onclick="loadPendingResets()">↻</button>
                        </div>
                        <div id="adminResetsList">
                            <div class="admin-empty">Carregando...</div>
                        </div>
                    </div>

                    <!-- Pending Check-ins -->
                    <div class="admin-section">
                        <div class="admin-section-header">
                            <div class="admin-section-title">⏳ Check-ins Pendentes <span class="admin-badge" id="adminCheckinBadge" style="display:none">0</span></div>
                            <button class="admin-refresh-btn" onclick="loadPendingCheckins()">↻</button>
                        </div>
                        <div class="admin-filter-row">
                            <button class="admin-filter-btn active" onclick="filterAdminCheckins('hoje', event)">Hoje</button>
                            <button class="admin-filter-btn" onclick="filterAdminCheckins('semana', event)">Semana</button>
                            <button class="admin-filter-btn" onclick="filterAdminCheckins('todos', event)">Todos</button>
                        </div>
                        <div id="adminCheckinsList">
                            <div class="admin-empty">Carregando...</div>
                        </div>
                        <button class="admin-bulk-btn" id="adminBulkApproveBtn" style="display:none" onclick="bulkApproveCheckins()">✓ Aprovar Todos Pendentes</button>
                    </div>

                    <!-- Recent Approved -->
                    <div class="admin-section">
                        <div class="admin-section-header">
                            <div class="admin-section-title">✅ Aprovados Hoje <span class="admin-badge green" id="adminApprovedBadge" style="display:none">0</span></div>
                        </div>
                        <div id="adminApprovedList">
                            <div class="admin-empty">Nenhum aprovado hoje</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: ALUNOS -->
            <div id="adm-alunos" class="adm-tab">
                <div class="admin-container">
                    <div class="adm-page-title">
                        <h2>Gestão de Alunos</h2>
                    </div>
                    <div class="admin-section">
                        <div class="admin-section-header">
                            <div class="admin-section-title">👥 Alunos Cadastrados <span class="admin-badge green" id="adminStudentsBadge" style="display:none">0</span></div>
                            <button class="admin-refresh-btn" onclick="loadStudentsList()">↻</button>
                        </div>
                        <div style="margin-bottom:12px;">
                            <input type="text" id="adminStudentSearch" placeholder="Buscar por nome ou email..." oninput="filterStudentsList()" style="width:100%;box-sizing:border-box;">
                        </div>
                        <div id="adminStudentsList">
                            <div class="admin-empty">Carregando...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: CTs SCHEDULE -->
            <div id="adm-cts" class="adm-tab">
                <div class="admin-container">
                    <div class="adm-page-title">
                        <h2>Centros de Treinamento</h2>
                        <p>Configure os dias de treino por CT</p>
                    </div>
                    <div id="adminCTScheduleList">
                        <div class="admin-empty">Carregando...</div>
                    </div>
                </div>
            </div>

            <!-- TAB: RELATÓRIOS -->
            <div id="adm-relatorios" class="adm-tab">
                <div class="admin-container">
                    <div class="adm-page-title">
                        <h2>Relatórios</h2>
                        <p>Métricas de frequência e presença</p>
                    </div>

                    <!-- CT Filter -->
                    <div class="report-section" style="padding:12px;">
                        <div class="report-section-title" style="margin-bottom:10px;">📍 Filtrar por CT</div>
                        <div class="report-filter-row" id="rptCTFilter">
                            <button class="report-filter-btn active" onclick="switchReportCT('todos')">Todos os CTs</button>
                        </div>
                    </div>

                    <!-- KPIs -->
                    <div class="report-kpi-grid" id="reportKPIs">
                        <div class="report-kpi"><div class="report-kpi-num gold" id="rptTotal">-</div><div class="report-kpi-label">Presenças</div></div>
                        <div class="report-kpi"><div class="report-kpi-num green" id="rptAlunos">-</div><div class="report-kpi-label">Alunos Ativos</div></div>
                        <div class="report-kpi"><div class="report-kpi-num cyan" id="rptMedia">-</div><div class="report-kpi-label">Média/Mês</div></div>
                        <div class="report-kpi"><div class="report-kpi-num purple" id="rptMediaAluno">-</div><div class="report-kpi-label">Média/Aluno</div></div>
                    </div>

                    <!-- Picos -->
                    <div class="report-pico-grid" id="reportPicos">
                        <div class="report-pico"><div class="report-pico-icon">📅</div><div class="report-pico-val" id="rptPicoMes">-</div><div class="report-pico-lbl">Melhor Mês</div></div>
                        <div class="report-pico"><div class="report-pico-icon">📆</div><div class="report-pico-val" id="rptPicoDia">-</div><div class="report-pico-lbl">Dia Favorito</div></div>
                        <div class="report-pico"><div class="report-pico-icon">⏰</div><div class="report-pico-val" id="rptPicoHora">-</div><div class="report-pico-lbl">Horário Pico</div></div>
                    </div>

                    <!-- Frequência por Mês -->
                    <div class="report-section">
                        <div class="report-section-title">📊 Frequência por Mês</div>
                        <div id="rptByMonth"></div>
                    </div>

                    <!-- Frequência por Dia da Semana -->
                    <div class="report-section">
                        <div class="report-section-title">📆 Frequência por Dia da Semana</div>
                        <div id="rptByDay"></div>
                    </div>

                    <!-- Frequência por Horário -->
                    <div class="report-section">
                        <div class="report-section-title">⏰ Frequência por Horário</div>
                        <div id="rptByHour"></div>
                    </div>

                    <!-- Frequência por CT (só quando "Todos") -->
                    <div class="report-section" id="rptByCTSection">
                        <div class="report-section-title">📍 Presenças por CT</div>
                        <div id="rptByCT"></div>
                    </div>

                    <!-- Top Alunos -->
                    <div class="report-section">
                        <div class="report-section-title">🏆 Top Alunos (mais presenças)</div>
                        <div id="rptTopAlunos"></div>
                    </div>

                    <!-- Lista de Presenças -->
                    <div class="report-section">
                        <div class="report-section-title">📋 Últimas Presenças</div>
                        <div style="overflow-x:auto;">
                            <table class="report-table" id="rptRecordsTable">
                                <thead>
                                    <tr><th>Aluno</th><th>CT</th><th>Data</th><th>Hora</th><th>Dia</th></tr>
                                </thead>
                                <tbody id="rptRecords"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: MEU CHECK-IN -->
            <div id="adm-checkin" class="adm-tab">
                <div class="admin-container">
                    <div class="adm-page-title">
                        <h2>Meu Check-in</h2>
                    </div>
                    <div class="admin-section">
                        <div class="admin-section-header">
                            <div class="admin-section-title">✍️ Meu Check-in</div>
                        </div>
                        <div class="checkin-profile" style="margin-bottom:16px;">
                            <div class="checkin-avatar" id="admCheckinInitial">P</div>
                            <div class="checkin-info">
                                <div class="checkin-name" id="admDisplayName">-</div>
                                <div class="checkin-meta"><span id="admDisplayFaixa">-</span></div>
                            </div>
                            <div class="checkin-count">
                                <div class="checkin-count-num" id="admDisplayCount">0</div>
                                <div class="checkin-count-label">Treinos</div>
                            </div>
                        </div>

                        <div class="ct-section">
                            <div class="section-title">Onde você treinou?</div>
                            <div class="ct-grid" id="admCtGrid"></div>
                            <div class="selected-ct-bar" id="admSelectedInfo">
                                <span>Academia:</span>
                                <span id="admSelectedCT">-</span>
                            </div>
                        </div>

                        <button class="btn btn-primary" onclick="adminConfirmAttendance()">✓ Confirmar Presença</button>
                        <div id="admAttendanceMessage"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: PERFIL ADMIN -->
            <div id="adm-perfil" class="adm-tab">
                <div class="admin-container">
                    <div class="adm-page-title">
                        <h2>Meu Perfil</h2>
                    </div>
                    <div class="admin-section">
                        <div class="admin-section-header">
                            <div class="admin-section-title">👤 Meu Perfil</div>
                        </div>
                        <div class="perfil-card" style="margin-bottom:16px;">
                            <div class="perfil-header">
                                <div class="perfil-avatar" id="admPerfilInitial">P</div>
                                <div class="perfil-info">
                                    <div class="perfil-name" id="admPerfilName">-</div>
                                    <div class="perfil-email" id="admPerfilEmail">-</div>
                                    <div style="margin-top:6px;"><span class="admin-checkin-status aprovado">PROFESSOR</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="admin-section">
                        <div class="admin-section-header">
                            <div class="admin-section-title">🔒 Alterar Senha</div>
                        </div>
                        <div class="form-group"><label class="form-label">Senha Atual</label><input type="password" id="admCurrentPw" placeholder="••••••"></div>
                        <div class="form-group"><label class="form-label">Nova Senha</label><input type="password" id="admNewPw" placeholder="Mínimo 6 caracteres"></div>
                        <div class="form-group"><label class="form-label">Confirmar Nova Senha</label><input type="password" id="admConfirmPw" placeholder="Repita a nova senha"></div>
                        <div id="admPwMessage"></div>
                        <button class="btn btn-primary" onclick="adminChangePassword()">🔑 Alterar Senha</button>
                    </div>

                    <button class="perfil-logout-btn" onclick="handleLogout()" style="margin-top:16px">🚪 Sair da Conta</button>
                </div>
            </div>

        </div>
        <!-- end adminScreen -->

        </div>
        <!-- end main -->

        <!-- STUDENT BOTTOM NAV -->
        <div class="bnav" id="bottomNav">
            <div class="bnav-inner">
                <button class="bnav-btn active" onclick="switchTab('attendance', event)">
                    <span class="bnav-icon">✍️</span>
                    <span class="bnav-label">Check-in</span>
                </button>
                <button class="bnav-btn" onclick="switchTab('ranking', event)">
                    <span class="bnav-icon">🏆</span>
                    <span class="bnav-label">Ranking</span>
                </button>
                <button class="bnav-btn" onclick="switchTab('rewards', event)">
                    <span class="bnav-icon">🎁</span>
                    <span class="bnav-label">Prêmios</span>
                </button>
                <button class="bnav-btn" onclick="switchTab('evolucao', event)">
                    <span class="bnav-icon">📈</span>
                    <span class="bnav-label">Evolução</span>
                </button>
                <button class="bnav-btn" onclick="switchTab('perfil', event)">
                    <span class="bnav-icon">👤</span>
                    <span class="bnav-label">Perfil</span>
                </button>
            </div>
        </div>

        <!-- ADMIN BOTTOM NAV -->
        <div class="bnav" id="adminNav" style="display:none;">
            <div class="bnav-inner">
                <button class="bnav-btn active" onclick="switchAdminTab('adm-painel', event)">
                    <span class="bnav-icon">🏠</span>
                    <span class="bnav-label">Painel</span>
                </button>
                <button class="bnav-btn" onclick="switchAdminTab('adm-alunos', event)">
                    <span class="bnav-icon">👥</span>
                    <span class="bnav-label">Alunos</span>
                </button>
                <button class="bnav-btn" onclick="switchAdminTab('adm-cts', event)">
                    <span class="bnav-icon">📍</span>
                    <span class="bnav-label">CTs</span>
                </button>
                <button class="bnav-btn" onclick="switchAdminTab('adm-relatorios', event)">
                    <span class="bnav-icon">📊</span>
                    <span class="bnav-label">Relatórios</span>
                </button>
                <button class="bnav-btn" onclick="switchAdminTab('adm-checkin', event)">
                    <span class="bnav-icon">✍️</span>
                    <span class="bnav-label">Check-in</span>
                </button>
                <button class="bnav-btn" onclick="switchAdminTab('adm-perfil', event)">
                    <span class="bnav-icon">👤</span>
                    <span class="bnav-label">Perfil</span>
                </button>
            </div>
        </div>

    </div>
    <!-- end app -->

    <!-- BIRTHDAY CELEBRATION MODAL -->
    <div id="bdayOverlay" class="bday-overlay" style="display:none;">
        <div class="bday-glow"></div>
        <div class="bday-card">
            <div class="bday-emoji">🎂</div>
            <div class="bday-title">Feliz Aniversário!</div>
            <div class="bday-name" id="bdayName">Aluno</div>
            <div class="bday-stats" id="bdayStats"></div>
            <div class="bday-msg" id="bdayMsg"></div>
            <div class="bday-quote" id="bdayQuote"></div>
            <div class="bday-family">🥋 Obrigado por fazer parte da nossa família!</div>
            <button class="bday-close" onclick="closeBirthday()">Ossú! 🤙</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyvja3B3LtBTZtQUWdJEmYFMPS4JURApbdPWhf-HPm0d7SmiGCgBOMfp0IU8VVcrj9yvw/exec';
        let currentUser = null;
        let selectedCT = null;
        let allCTs = [];
        let ctSchedules = {}; // { 'CT Goodfellas': { seg: true, ter: false, ... } }
        let currentRankingPeriod = 'mes';
        let currentRankingFilter = 'geral';
        let allRankingData = null;

        // ===== UTILS =====
        function showMessage(elementId, message, type) {
            const el = document.getElementById(elementId);
            if (!el) return;
            el.innerHTML = '<div class="msg ' + type + '">' + message + '</div>';
        }

        // ===== INIT =====
        window.addEventListener('load', function() {
            const s = localStorage.getItem('bjjUser');
            if (s) {
                try {
                    currentUser = JSON.parse(s);
                    showAppScreen();
                    loadAttendanceInfo();
                    loadCTs();
                    // Carregar perfil do cache e atualizar do backend
                    var cached = localStorage.getItem('bjjProfile');
                    if (cached) {
                        try {
                            var cachedProfile = JSON.parse(cached);
                            fillProfileFields(cachedProfile);
                            checkBirthday(cachedProfile);
                        } catch(e2) {}
                    }
                    fetchProfileFromBackend();
                } catch(e) {
                    localStorage.removeItem('bjjUser');
                    localStorage.removeItem('bjjProfile');
                }
            }
        });

        // ===== AUTH =====
        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            showMessage('loginMessage', 'Conectando...', 'warning');

            try {
                const r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'login', email, password }) });
                const data = await r.json();
                if (data.authenticated === true) {
                    currentUser = data;
                    localStorage.setItem('bjjUser', JSON.stringify(currentUser));
                    showAppScreen();
                    loadAttendanceInfo();
                    loadCTs();
                    fetchProfileFromBackend();
                } else {
                    showMessage('loginMessage', data.message || 'Erro ao fazer login', 'danger');
                }
            } catch (err) {
                showMessage('loginMessage', 'Erro de conexão: ' + err.message, 'danger');
            }
        }

        // ===== PASSWORD UTILITIES =====
        function togglePasswordVisibility(inputId, btn) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = '🙈';
                btn.title = 'Ocultar senha';
            } else {
                input.type = 'password';
                btn.textContent = '👁';
                btn.title = 'Mostrar senha';
            }
        }

        function checkPasswordMatch() {
            const pw = document.getElementById('regPassword').value;
            const confirm = document.getElementById('regPasswordConfirm').value;
            const hint = document.getElementById('passwordMatchHint');
            if (!confirm) { hint.textContent = ''; hint.className = 'password-match-hint'; return; }
            if (pw === confirm) {
                hint.textContent = '✔ Senhas coincidem';
                hint.className = 'password-match-hint match';
            } else {
                hint.textContent = '✘ Senhas não coincidem';
                hint.className = 'password-match-hint no-match';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const regPw = document.getElementById('regPassword');
            const regPwC = document.getElementById('regPasswordConfirm');
            if (regPw) regPw.addEventListener('input', checkPasswordMatch);
            if (regPwC) regPwC.addEventListener('input', checkPasswordMatch);
        });

        async function handleRegister(event) {
            event.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const passwordConfirm = document.getElementById('regPasswordConfirm').value;
            const faixa = document.getElementById('regFaixa').value;
            const grau = document.getElementById('regGrau').value;
            const ct = document.getElementById('regCT').value;

            if (password.length < 6) { showMessage('registerMessage', '⚠️ Senha deve ter no mínimo 6 caracteres', 'warning'); return; }
            if (password !== passwordConfirm) { showMessage('registerMessage', '⚠️ As senhas não coincidem', 'warning'); return; }
            if (!ct) { showMessage('registerMessage', '⚠️ Escolha seu CT Principal', 'warning'); return; }
            showMessage('registerMessage', 'Cadastrando...', 'warning');

            try {
                const r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'requestAccount', name, email, password, faixa, grau, ct }) });
                const data = await r.json();
                if (data.success) {
                    showMessage('registerMessage', '✅ Cadastro realizado! Faça login após aprovação.', 'success');
                    setTimeout(() => showLogin(), 2000);
                } else {
                    showMessage('registerMessage', data.message || 'Erro ao cadastrar', 'danger');
                }
            } catch (err) {
                showMessage('registerMessage', 'Erro de conexão', 'danger');
            }
        }

        // ===== NAVIGATION =====
        function isAdmin() {
            return currentUser && (currentUser.admin === true || currentUser.admin === 'TRUE');
        }

        function showAppScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('headerUser').style.display = 'flex';
            document.getElementById('headerUserName').textContent = currentUser.name.split(' ')[0];
            document.getElementById('userInitial').textContent = currentUser.name.charAt(0).toUpperCase();

            if (isAdmin()) {
                // ADMIN SCREEN
                document.getElementById('appScreen').style.display = 'none';
                document.getElementById('bottomNav').style.display = 'none';
                document.getElementById('adminScreen').style.display = 'block';
                document.getElementById('adminNav').style.display = 'block';
                document.getElementById('headerSubtitle').innerHTML = 'Administrador <span class="admin-header-badge">ADMIN</span>';
                // Admin header color
                document.querySelector('.hdr').style.background = 'var(--adm-bg-card)';
                document.querySelector('.hdr').style.borderBottomColor = 'var(--adm-border)';
                document.querySelector('.hdr-title').style.background = 'linear-gradient(135deg, var(--adm-primary-bright), var(--adm-primary))';
                document.querySelector('.hdr-title').style.webkitBackgroundClip = 'text';
                document.querySelector('.hdr-title').style.webkitTextFillColor = 'transparent';
                document.querySelector('.hdr-avatar').style.background = 'var(--adm-primary-dim)';
                document.querySelector('.hdr-avatar').style.color = 'var(--adm-primary-bright)';
                document.querySelector('.hdr-avatar').style.borderColor = 'var(--adm-border-accent)';
                // Fill admin profile info
                document.getElementById('adminWelcomeName').textContent = currentUser.name.split(' ')[0];
                document.getElementById('admPerfilName').textContent = currentUser.name;
                document.getElementById('admPerfilEmail').textContent = currentUser.email;
                document.getElementById('admPerfilInitial').textContent = currentUser.name.charAt(0).toUpperCase();
                document.getElementById('admCheckinInitial').textContent = currentUser.name.charAt(0).toUpperCase();
                document.getElementById('admDisplayName').textContent = currentUser.name;
                document.getElementById('admDisplayFaixa').textContent = currentUser.faixa;
                document.getElementById('admDisplayCount').textContent = currentUser.treinos || '0';
                // Load dashboard
                loadAdminPanel();
            } else {
                // STUDENT SCREEN
                document.getElementById('adminScreen').style.display = 'none';
                document.getElementById('adminNav').style.display = 'none';
                document.getElementById('appScreen').style.display = 'block';
                document.getElementById('bottomNav').style.display = 'block';
                document.getElementById('headerSubtitle').textContent = 'Checkin';
                document.getElementById('checkinInitial').textContent = currentUser.name.charAt(0).toUpperCase();
                // Student header color (reset to gold)
                document.querySelector('.hdr').style.background = '';
                document.querySelector('.hdr').style.borderBottomColor = '';
                document.querySelector('.hdr-title').style.background = '';
                document.querySelector('.hdr-title').style.webkitBackgroundClip = '';
                document.querySelector('.hdr-title').style.webkitTextFillColor = '';
                document.querySelector('.hdr-avatar').style.background = '';
                document.querySelector('.hdr-avatar').style.color = '';
                document.querySelector('.hdr-avatar').style.borderColor = '';
            }
        }

        function showLogin() {
            document.getElementById('registerTab').style.display = 'none';
            document.getElementById('forgotTab').style.display = 'none';
            document.getElementById('loginTab').style.display = 'block';
        }

        function showRegister() {
            document.getElementById('loginTab').style.display = 'none';
            document.getElementById('forgotTab').style.display = 'none';
            document.getElementById('registerTab').style.display = 'block';
            loadCTs();
        }

        function showForgotPassword() {
            document.getElementById('loginTab').style.display = 'none';
            document.getElementById('registerTab').style.display = 'none';
            document.getElementById('forgotTab').style.display = 'block';
        }

        async function handleForgotPassword(e) {
            e.preventDefault();
            var email = document.getElementById('forgotEmail').value.trim();
            var senha = document.getElementById('forgotPassword').value;
            var senhaConfirm = document.getElementById('forgotPasswordConfirm').value;

            if (senha !== senhaConfirm) {
                showMessage('forgotMessage', 'As senhas não coincidem', 'error');
                return;
            }
            if (senha.length < 6) {
                showMessage('forgotMessage', 'Senha deve ter no mínimo 6 caracteres', 'error');
                return;
            }

            showMessage('forgotMessage', 'Enviando solicitação...', 'info');
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'requestPasswordReset', email: email, novaSenha: senha }) });
                var data = await r.json();
                if (data.success) {
                    showMessage('forgotMessage', data.message || 'Solicitação enviada! Aguarde aprovação do Professor.', 'success');
                    document.getElementById('forgotPassword').value = '';
                    document.getElementById('forgotPasswordConfirm').value = '';
                    setTimeout(function() { showLogin(); }, 3000);
                } else {
                    showMessage('forgotMessage', data.message || 'Erro ao solicitar', 'error');
                }
            } catch (err) {
                showMessage('forgotMessage', 'Erro de conexão', 'error');
            }
        }

        function handleLogout() {
            if (confirm('Sair da conta?')) {
                localStorage.removeItem('bjjUser');
                localStorage.removeItem('bjjProfile');
                currentUser = null;
                // Limpar campos do perfil
                for (var i = 0; i < PERFIL_FIELDS.length; i++) {
                    var el = document.getElementById(PERFIL_FIELDS[i].id);
                    if (el) el.value = '';
                }
                document.getElementById('appScreen').style.display = 'none';
                document.getElementById('adminScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('headerUser').style.display = 'none';
                document.getElementById('bottomNav').style.display = 'none';
                document.getElementById('adminNav').style.display = 'none';
                document.getElementById('headerSubtitle').textContent = 'Checkin';
                // Reset header to default gold theme
                document.querySelector('.hdr').style.background = '';
                document.querySelector('.hdr').style.borderBottomColor = '';
                document.querySelector('.hdr-title').style.background = '';
                document.querySelector('.hdr-title').style.webkitBackgroundClip = '';
                document.querySelector('.hdr-title').style.webkitTextFillColor = '';
                if (document.querySelector('.hdr-avatar')) {
                    document.querySelector('.hdr-avatar').style.background = '';
                    document.querySelector('.hdr-avatar').style.color = '';
                    document.querySelector('.hdr-avatar').style.borderColor = '';
                }
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                showLogin();
            }
        }

        function switchTab(tabName, evt) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.bnav-btn').forEach(b => b.classList.remove('active'));
            var tab = document.getElementById(tabName);
            if (tab) tab.classList.add('active');
            var e = evt || window.event;
            if (e && e.target) {
                var btn = e.target.closest('.bnav-btn');
                if (btn) btn.classList.add('active');
            }

            if (tabName === 'ranking') loadRanking();
            if (tabName === 'rewards') loadRewards();
            if (tabName === 'evolucao') loadEvolucao();
            if (tabName === 'perfil') loadProfile();
        }

        // ===== CHECK-IN =====
        async function loadCTs() {
            try {
                const r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getCTsList' }) });
                const data = await r.json();
                if (data.success && data.cts) {
                    allCTs = data.cts;
                    // Armazenar schedules
                    ctSchedules = {};
                    data.cts.forEach(ct => {
                        if (typeof ct === 'object' && ct.schedule) {
                            ctSchedules[ct.name] = ct.schedule;
                        }
                    });
                    const regCT = document.getElementById('regCT');
                    if (regCT) {
                        data.cts.forEach(ct => {
                            const name = typeof ct === 'string' ? ct : ct.name || ct.toString();
                            if (!Array.from(regCT.options).find(o => o.value === name)) {
                                const opt = document.createElement('option');
                                opt.value = name;
                                opt.textContent = name;
                                regCT.appendChild(opt);
                            }
                        });
                    }
                    const grid = document.getElementById('ctGrid');
                    if (grid) {
                        grid.innerHTML = '';
                        data.cts.forEach(ct => {
                            const name = typeof ct === 'string' ? ct : ct.name || ct.toString();
                            const btn = document.createElement('button');
                            btn.type = 'button';
                            btn.className = 'ct-btn';
                            btn.textContent = name;
                            btn.addEventListener('click', () => selectCT(name));
                            grid.appendChild(btn);
                        });
                    }
                }
            } catch (err) { console.error('Erro CTs:', err); }
        }

        function selectCT(ctName) {
            selectedCT = ctName;
            document.querySelectorAll('.ct-btn').forEach(b => b.classList.remove('selected'));
            event.target?.classList.add('selected');
            document.getElementById('selectedCT').textContent = ctName;
            document.getElementById('selectedInfo').classList.add('active');

            // Avisar se hoje não é dia de treino neste CT
            var schedule = ctSchedules[ctName];
            if (schedule) {
                var dayKeys = ['dom', 'seg', 'ter', 'qua', 'qui', 'sex', 'sab'];
                var hoje = dayKeys[new Date().getDay()];
                var temConfig = Object.values(schedule).some(function(v) { return v === true; });
                if (temConfig && !schedule[hoje]) {
                    var dayLabels = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
                    var hojeDia = dayLabels[new Date().getDay()];
                    showMessage('attendanceMessage', '⚠️ Hoje (' + hojeDia + ') não é dia de treino no ' + ctName + '. Seu check-in ficará pendente para avaliação do Professor.', 'warning');
                } else {
                    // Limpar mensagem se dia é permitido
                    var msgEl = document.getElementById('attendanceMessage');
                    if (msgEl) msgEl.innerHTML = '';
                }
            }
        }

        function confirmAttendance() {
            if (!selectedCT) { showMessage('attendanceMessage', 'Selecione o CT', 'warning'); return; }

            // ===== VALIDAÇÃO DE HORÁRIO (sem check-in retroativo) =====
            var now = new Date();
            var hora = now.getHours();
            // Horário permitido: 06:00 às 23:00
            if (hora < 6 || hora >= 23) {
                showMessage('attendanceMessage', '⚠️ Check-in disponível apenas das 06:00 às 23:00', 'warning');
                return;
            }

            showMessage('attendanceMessage', 'Registrando presença...', 'info');

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'attendance', email: currentUser.email, name: currentUser.name,
                    faixa: currentUser.faixa, grau: currentUser.grau, ct: selectedCT
                })
            }).then(r => r.json()).then(data => {
                if (data.success) {
                    // Admin: check-in direto (sem aprovação)
                    if (data.direct) {
                        currentUser.treinos = (currentUser.treinos || 0) + 1;
                        localStorage.setItem('bjjUser', JSON.stringify(currentUser));
                        document.getElementById('displayCount').textContent = currentUser.treinos;
                        showMessage('attendanceMessage', '✅ Presença confirmada!', 'success');
                    } else {
                        showMessage('attendanceMessage', '✅ Check-in registrado! Aguardando aprovação do Professor.', 'success');
                    }
                    selectedCT = null;
                    document.querySelectorAll('.ct-btn').forEach(b => b.classList.remove('selected'));
                    document.getElementById('selectedCT').textContent = '-';
                    document.getElementById('selectedInfo').classList.remove('active');
                    setTimeout(() => document.getElementById('attendanceMessage').innerHTML = '', 5000);
                } else {
                    showMessage('attendanceMessage', data.message || 'Erro', 'danger');
                }
            }).catch(() => showMessage('attendanceMessage', 'Erro de conexão', 'danger'));
        }

        function loadAttendanceInfo() {
            if (currentUser) {
                document.getElementById('displayName').textContent = currentUser.name;
                document.getElementById('displayFaixa').textContent = currentUser.faixa;
                document.getElementById('displayCount').textContent = currentUser.treinos || '0';
            }
        }

        // ===== RANKING =====
        async function loadRanking() {
            // Reset UI
            document.getElementById('rankingMessage').style.display = 'block';
            document.getElementById('rankingMessage').textContent = 'Carregando ranking...';
            document.getElementById('userTrainingSection').style.display = 'none';
            document.getElementById('top3Container').style.display = 'none';
            document.getElementById('top3Container').innerHTML = '';
            document.getElementById('userPositionSection').style.display = 'none';
            document.getElementById('rankingListSection').style.display = 'none';
            document.getElementById('ctRankingContainer').style.display = 'none';
            document.getElementById('ctFilterGrid').innerHTML = '';

            try {
                const r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getRankingMonth', email: currentUser.email, period: currentRankingPeriod }) });
                const data = await r.json();
                if (data.success && data.ranking && data.ranking.length > 0) {
                    displayRanking(data.ranking);
                } else {
                    document.getElementById('rankingMessage').textContent = 'Sem dados de ranking';
                }
            } catch (err) {
                document.getElementById('rankingMessage').textContent = 'Erro ao carregar ranking';
            }
        }

        function switchRankingPeriod(period, evt) {
            document.querySelectorAll('.rank-period-btn').forEach(b => b.classList.remove('active'));
            var e = evt || window.event;
            if (e && e.target) { var b = e.target.closest('.rank-period-btn'); if (b) b.classList.add('active'); }
            currentRankingPeriod = period;
            currentRankingFilter = 'geral';
            const label = document.getElementById('userTotalLabel');
            label.textContent = period === 'mes' ? 'treinos este mês' : 'treinos este ano';
            loadRanking();
        }

        function switchRankingFilter(ctName, evt) {
            document.querySelectorAll('.rank-ct-chip').forEach(c => c.classList.remove('active'));
            var e = evt || window.event;
            if (e && e.target) { var c = e.target.closest('.rank-ct-chip'); if (c) c.classList.add('active'); }
            currentRankingFilter = ctName;

            if (ctName === 'geral') {
                document.getElementById('userTrainingSection').style.display = 'block';
                document.getElementById('top3Container').style.display = 'grid';
                document.getElementById('userPositionSection').style.display = null;
                document.getElementById('rankingListSection').style.display = null;
                document.getElementById('ctRankingContainer').style.display = 'none';
                displayGeneralRanking(allRankingData);
            } else {
                document.getElementById('userTrainingSection').style.display = 'none';
                document.getElementById('top3Container').style.display = 'none';
                document.getElementById('userPositionSection').style.display = 'none';
                document.getElementById('rankingListSection').style.display = 'none';
                document.getElementById('ctRankingContainer').style.display = 'block';
                displayCTRanking(allRankingData, ctName);
            }
        }

        function displayRanking(ranking) {
            allRankingData = ranking;
            const ctsSet = new Set();
            ranking.forEach(s => { if (s.treinosPorCT) Object.keys(s.treinosPorCT).forEach(ct => ctsSet.add(ct)); });

            const filterGrid = document.getElementById('ctFilterGrid');
            filterGrid.innerHTML = '';

            const geralChip = document.createElement('button');
            geralChip.className = 'rank-ct-chip geral active';
            geralChip.textContent = '📊 Geral';
            geralChip.onclick = function(e) { switchRankingFilter('geral', e); };
            filterGrid.appendChild(geralChip);

            Array.from(ctsSet).sort().forEach(ct => {
                const chip = document.createElement('button');
                chip.className = 'rank-ct-chip';
                chip.textContent = ct;
                chip.onclick = function(e) { switchRankingFilter(ct, e); };
                filterGrid.appendChild(chip);
            });

            displayGeneralRanking(ranking);
        }

        function displayGeneralRanking(ranking) {
            document.getElementById('rankingMessage').style.display = 'none';

            const userRank = ranking.find(r => r.email.toLowerCase() === currentUser.email.toLowerCase());
            const userPosition = ranking.findIndex(r => r.email.toLowerCase() === currentUser.email.toLowerCase()) + 1;

            // User training cards
            if (userRank && userRank.treinosPorCT && Object.keys(userRank.treinosPorCT).length > 0) {
                const section = document.getElementById('userTrainingSection');
                section.style.display = 'block';
                const grid = document.getElementById('userTrainingGrid');
                grid.innerHTML = '';
                Object.keys(userRank.treinosPorCT).sort().forEach(ct => {
                    const tag = document.createElement('div');
                    tag.className = 'user-ct-tag';
                    tag.innerHTML = '<div class="user-ct-tag-name">' + ct + '</div><div class="user-ct-tag-count">' + userRank.treinosPorCT[ct] + '</div>';
                    grid.appendChild(tag);
                });
                document.getElementById('userTotalCount').textContent = userRank.totalTreinos;
            } else {
                document.getElementById('userTrainingSection').style.display = 'none';
            }

            // Top 3
            const top3 = document.getElementById('top3Container');
            top3.innerHTML = '';
            const medals = ['🥇','🥈','🥉'];
            const classes = ['gold','silver','bronze'];
            for (let i = 0; i < Math.min(3, ranking.length); i++) {
                const s = ranking[i];
                let cts = '';
                if (s.treinosPorCT) cts = Object.keys(s.treinosPorCT).map(c => c + ': ' + s.treinosPorCT[c]).join(' | ');
                const card = document.createElement('div');
                card.className = 'podium-card ' + classes[i];
                card.innerHTML = '<div class="podium-medal">' + medals[i] + '</div><div class="podium-name">' + s.name + '</div><div class="podium-faixa">' + s.faixa + '</div><div class="podium-count">' + s.totalTreinos + '</div><div class="podium-ct">' + s.ctPrincipal + '</div>' + (cts ? '<div style="font-size:9px;color:var(--text-3);margin-top:4px;">' + cts + '</div>' : '');
                top3.appendChild(card);
            }
            top3.style.display = ranking.length > 0 ? 'grid' : 'none';

            // User position (if >3)
            if (userRank && userPosition > 3) {
                const posSection = document.getElementById('userPositionSection');
                posSection.style.display = 'block';
                const nextUser = ranking[userPosition] || null;
                const nextDiff = nextUser ? userRank.totalTreinos - nextUser.totalTreinos : 0;
                let uCts = '';
                if (userRank.treinosPorCT) uCts = Object.keys(userRank.treinosPorCT).map(c => c + ': ' + userRank.treinosPorCT[c]).join(' • ');
                document.getElementById('userPositionCard').innerHTML =
                    '<div><div class="user-pos-rank">#' + userPosition + 'º lugar</div><div class="user-pos-name">' + currentUser.name + '</div><div class="user-pos-meta">' + userRank.faixa + ' • ' + userRank.totalTreinos + ' treinos</div>' + (uCts ? '<div style="font-size:11px;color:var(--text-3);margin-top:4px;">' + uCts + '</div>' : '') + '</div><div><div class="user-pos-next-label">Próximo</div><div class="user-pos-diff">' + (nextDiff > 0 ? '+' : '') + nextDiff + ' treinos</div></div>';
            }

            // 4th+ list
            const listSection = document.getElementById('rankingListSection');
            const list = document.getElementById('rankingList');
            if (ranking.length > 3) {
                listSection.style.display = 'block';
                list.innerHTML = '';
                for (let i = 3; i < ranking.length; i++) {
                    const s = ranking[i];
                    const isMe = s.email.toLowerCase() === currentUser.email.toLowerCase();
                    let cts = '';
                    if (s.treinosPorCT) cts = Object.keys(s.treinosPorCT).map(c => c + ': ' + s.treinosPorCT[c]).join(' • ');
                    const item = document.createElement('div');
                    item.className = 'rank-item' + (isMe ? ' me' : '');
                    item.innerHTML = '<div class="rank-item-left"><div class="rank-pos">#' + (i+1) + '</div><div><div class="rank-name">' + s.name + (isMe ? ' ✨' : '') + '</div><div class="rank-detail">' + s.faixa + ' • ' + s.ctPrincipal + '</div>' + (cts ? '<div style="font-size:10px;color:var(--text-3);margin-top:2px;">' + cts + '</div>' : '') + '</div></div><div class="rank-num">' + s.totalTreinos + '</div>';
                    list.appendChild(item);
                }
            }
        }

        function displayCTRanking(ranking, ctName) {
            const ctRanking = ranking
                .filter(s => s.treinosPorCT && s.treinosPorCT[ctName] && s.treinosPorCT[ctName] > 0)
                .map(s => ({ ...s, ctTreinos: s.treinosPorCT[ctName] }))
                .sort((a, b) => b.ctTreinos - a.ctTreinos);

            const list = document.getElementById('ctRankingList');
            document.getElementById('ctRankingTitle').textContent = 'Ranking em ' + ctName;
            list.innerHTML = '';

            if (ctRanking.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:var(--text-3);padding:20px;">Nenhum aluno treinou neste CT</div>';
                return;
            }

            for (let i = 0; i < ctRanking.length; i++) {
                const s = ctRanking[i];
                const isMe = s.email.toLowerCase() === currentUser.email.toLowerCase();
                const item = document.createElement('div');
                item.className = 'rank-item' + (isMe ? ' me' : '');
                item.innerHTML = '<div class="rank-item-left"><div class="rank-pos">#' + (i+1) + '</div><div><div class="rank-name">' + s.name + (isMe ? ' ✨' : '') + '</div><div class="rank-detail">' + s.faixa + ' • ' + s.ctPrincipal + '</div></div></div><div class="rank-num">' + s.ctTreinos + '</div>';
                list.appendChild(item);
            }
        }

        // ===== EVOLUÇÃO =====
        const BELT_CONFIG = {
            'Branca': { order: 0, emoji: '⚪', class: 'branca', next: 'Azul', minMonths: 12, minTreinos: 90 },
            'Azul':   { order: 1, emoji: '🔵', class: 'azul',   next: 'Roxa', minMonths: 24, minTreinos: 200 },
            'Roxa':   { order: 2, emoji: '🟣', class: 'roxa',   next: 'Marrom', minMonths: 24, minTreinos: 300 },
            'Marrom': { order: 3, emoji: '🟤', class: 'marrom', next: 'Preta', minMonths: 18, minTreinos: 200 },
            'Preta':  { order: 4, emoji: '⚫', class: 'preta',  next: null, minMonths: 0, minTreinos: 0 }
        };
        const BELT_ORDER = ['Branca', 'Azul', 'Roxa', 'Marrom', 'Preta'];
        const BELT_ACCUMULATED = { 'Branca': 0, 'Azul': 90, 'Roxa': 290, 'Marrom': 590, 'Preta': 790 };
        const SEMESTER_MAX_CLASSES = 48;
        const GRAU_MIN_TREINOS = 22;
        const FREQ_MIN_APTO = 75;
        const FREQ_MIN_EVOLUCAO = 60;

        function loadEvolucao() {
            if (!currentUser) return;
            const faixa = currentUser.faixa || 'Branca';
            const grau = parseInt(currentUser.grau) || 0;
            const totalTreinos = parseInt(currentUser.treinos) || 0;
            const treinosSemestre = Math.min(totalTreinos, SEMESTER_MAX_CLASSES);
            const freq = Math.min(SEMESTER_MAX_CLASSES > 0 ? Math.round((treinosSemestre / SEMESTER_MAX_CLASSES) * 100) : 0, 100);
            const avaliacao = currentUser.avaliacaoTecnica || false;
            const compromisso = currentUser.compromisso || false;
            const tempoNaFaixa = currentUser.tempoNaFaixa || 0;

            renderHero(faixa, grau, totalTreinos, treinosSemestre, freq);
            renderSeals(grau, treinosSemestre);
            renderFrequencyNew(freq, treinosSemestre);
            renderFaixaCriteria(faixa, grau, totalTreinos, freq, tempoNaFaixa, avaliacao, compromisso);
            renderIBJJFRoadmap(faixa, grau, totalTreinos);
            renderMotivation(freq);
        }

        function renderHero(faixa, grau, totalTreinos, treinosSemestre, freq) {
            const cfg = BELT_CONFIG[faixa] || BELT_CONFIG['Branca'];
            document.getElementById('evoHeroBelt').className = 'evo-hero-belt ' + cfg.class;
            document.getElementById('evoHeroTitle').textContent = 'Faixa ' + faixa + ' ' + cfg.emoji;
            document.getElementById('evoHeroSub').textContent = grau + '/4 graus' + (cfg.next ? ' • Próxima: ' + cfg.next : ' • 🏆 Máxima');

            const statusEl = document.getElementById('evoHeroStatus');
            if (freq < FREQ_MIN_EVOLUCAO) statusEl.innerHTML = '<div class="evo-hero-status red">🔴 Não apto</div>';
            else if (freq < FREQ_MIN_APTO) statusEl.innerHTML = '<div class="evo-hero-status yellow">🟡 Em evolução</div>';
            else statusEl.innerHTML = '<div class="evo-hero-status green">🟢 Apto</div>';

            document.getElementById('evoStatTreinos').textContent = totalTreinos;
            document.getElementById('evoStatSemestre').textContent = treinosSemestre;
        }

        function renderSeals(grauAtual, treinosSemestre) {
            const row = document.getElementById('evoSealsRow');
            row.innerHTML = '';
            const reqs = [GRAU_MIN_TREINOS, GRAU_MIN_TREINOS*2, GRAU_MIN_TREINOS*3, GRAU_MIN_TREINOS*4];

            for (let i = 0; i < 4; i++) {
                const min = reqs[i];
                const isUnlocked = (i + 1) <= grauAtual;
                const isCurrent = !isUnlocked && (i === grauAtual);
                const progress = Math.min(treinosSemestre, min);
                const pct = Math.round((progress / min) * 100);

                let cls = 'locked', icon = '🔒', lbl = '', prog = '';
                if (isUnlocked) { cls = 'unlocked'; icon = '⭐'; lbl = 'unlocked'; prog = 'Conquistado'; }
                else if (isCurrent) { cls = 'current-target'; icon = pct >= 100 ? '✅' : '🎯'; lbl = 'current-target'; prog = progress + '/' + min; }

                const seal = document.createElement('div');
                seal.className = 'evo-seal';
                seal.innerHTML = '<div class="evo-seal-circle ' + cls + '">' + icon + '</div><div class="evo-seal-label ' + lbl + '">' + (i+1) + 'º Grau</div><div class="evo-seal-progress">' + prog + '</div>';
                row.appendChild(seal);
            }
        }

        function renderFrequencyNew(freq, treinosSemestre) {
            const cls = freq < FREQ_MIN_EVOLUCAO ? 'red' : freq < FREQ_MIN_APTO ? 'yellow' : 'green';
            const pctEl = document.getElementById('evoFreqPct');
            pctEl.textContent = freq + '%';
            pctEl.className = 'evo-freq-pct ' + cls;
            const barEl = document.getElementById('evoFreqBarFill');
            barEl.className = 'evo-freq-bar-fill ' + cls;
            setTimeout(() => { barEl.style.width = Math.min(freq, 100) + '%'; }, 100);
            document.getElementById('evoFreqDetail').textContent = treinosSemestre + ' de ' + SEMESTER_MAX_CLASSES + ' aulas possíveis';
        }

        function renderFaixaCriteria(faixa, grau, totalTreinos, freq, tempoNaFaixa, avaliacao, compromisso) {
            const cfg = BELT_CONFIG[faixa] || BELT_CONFIG['Branca'];
            if (!cfg.next) {
                document.getElementById('evoFaixaCriteria').style.display = 'none';
                document.getElementById('evoExamBtn').style.display = 'none';
                return;
            }
            document.getElementById('evoFaixaCriteriaTitle').textContent = faixa + ' → ' + cfg.next;

            const criteria = [
                { label: '4 graus completos', detail: grau + '/4 graus', pass: grau >= 4 },
                { label: 'Tempo mínimo ' + cfg.minMonths + ' meses', detail: tempoNaFaixa + '/' + cfg.minMonths + ' meses', pass: tempoNaFaixa >= cfg.minMonths },
                { label: 'Mínimo ' + cfg.minTreinos + ' treinos', detail: totalTreinos + '/' + cfg.minTreinos, pass: totalTreinos >= cfg.minTreinos },
                { label: 'Frequência ≥ 75%', detail: freq + '%', pass: freq >= 75 },
                { label: 'Avaliação técnica', detail: avaliacao ? 'Aprovada' : 'Pendente', pass: avaliacao, pending: !avaliacao },
                { label: 'Compromisso validado', detail: compromisso ? 'Validado' : 'Pendente', pass: compromisso, pending: !compromisso }
            ];

            const passCount = criteria.filter(c => c.pass).length;
            document.getElementById('evoFaixaProgress').textContent = passCount + '/' + criteria.length;

            const listEl = document.getElementById('evoFaixaCriteriaList');
            listEl.innerHTML = '';
            criteria.forEach(c => {
                const st = c.pass ? 'pass' : (c.pending ? 'pending' : 'fail');
                const icon = c.pass ? '✓' : (c.pending ? '⏳' : '✗');
                listEl.innerHTML += '<div class="evo-criteria-item"><div class="evo-criteria-check ' + st + '">' + icon + '</div><div class="evo-criteria-text"><div class="evo-criteria-label">' + c.label + '</div><div class="evo-criteria-detail">' + c.detail + '</div></div></div>';
            });

            const allPass = grau >= 4 && tempoNaFaixa >= cfg.minMonths && totalTreinos >= cfg.minTreinos && freq >= 75 && avaliacao && compromisso;
            const btn = document.getElementById('evoExamBtn');
            if (allPass) {
                btn.className = 'evo-exam-btn active';
                btn.disabled = false;
                btn.innerHTML = '🏅 Solicitar Exame → ' + cfg.next;
                btn.onclick = () => alert('Solicitação de exame enviada! Aguarde contato do professor.');
            } else {
                btn.className = 'evo-exam-btn disabled';
                btn.disabled = true;
                btn.innerHTML = '🔒 ' + (criteria.length - passCount) + ' critério(s) pendente(s)';
            }
        }

        /* ===== IBJJF FULL BELT SYSTEM ===== */
        var IBJJF_BELTS = [
            { id: 'branca',  name: 'Branca',  cls: 'branca',  age: '16+', graus: 4, minMonths: 0,  minTreinos: 0 },
            { id: 'azul',    name: 'Azul',    cls: 'azul',    age: '16+', graus: 4, minMonths: 24, minTreinos: 90 },
            { id: 'roxa',    name: 'Roxa',    cls: 'roxa',    age: '16+', graus: 4, minMonths: 24, minTreinos: 200 },
            { id: 'marrom',  name: 'Marrom',  cls: 'marrom',  age: '18+', graus: 4, minMonths: 18, minTreinos: 300 },
            { id: 'preta',   name: 'Preta',   cls: 'preta',   age: '19+', graus: 6, minMonths: 36, minTreinos: 200 }
        ];

        var FAIXA_TO_IBJJF = { 'Branca': 'branca', 'Azul': 'azul', 'Roxa': 'roxa', 'Marrom': 'marrom', 'Preta': 'preta' };

        function renderIBJJFRoadmap(faixaAtual, grauAtual, totalTreinos) {
            var track = document.getElementById('ibjjfTrack');
            var fillEl = document.getElementById('ibjjfTrackFill');
            track.innerHTML = '';
            track.appendChild(fillEl);

            var currentId = FAIXA_TO_IBJJF[faixaAtual] || 'branca';
            var currentIdx = -1;
            for (var ai = 0; ai < IBJJF_BELTS.length; ai++) { if (IBJJF_BELTS[ai].id === currentId) { currentIdx = ai; break; } }
            var nextIdx = currentIdx + 1;

            var completedNodes = 0;

            for (var i = 0; i < IBJJF_BELTS.length; i++) {
                var belt = IBJJF_BELTS[i];

                var state = 'future';
                if (i < currentIdx) state = 'completed';
                else if (i === currentIdx) state = 'current';
                else if (i === nextIdx) state = 'next';

                if (state === 'completed' || state === 'current') completedNodes++;

                var node = document.createElement('div');
                node.className = 'ibjjf-node ' + state;

                var h = '<div class="ibjjf-node-inner">';
                h += '<div class="ibjjf-belt-band ' + belt.cls + '"></div>';
                h += '<div class="ibjjf-belt-info">';
                h += '<div class="ibjjf-belt-name">' + belt.name + '</div>';

                var meta = [];
                if (belt.age) meta.push('Idade: ' + belt.age);
                if (belt.minMonths > 0) meta.push('min ' + belt.minMonths + ' meses');
                if (belt.minTreinos > 0) meta.push(belt.minTreinos + ' treinos');
                h += '<div class="ibjjf-belt-meta">' + meta.join(' · ') + '</div>';
                h += '</div>';

                h += '<div class="ibjjf-belt-badges">';
                if (state === 'current') {
                    var maxG = belt.graus || 4;
                    h += '<div class="ibjjf-grau-dots">';
                    for (var g = 0; g < maxG; g++) {
                        h += '<div class="ibjjf-grau-dot' + (g < grauAtual ? ' filled' : '') + '"></div>';
                    }
                    h += '</div>';
                    h += '<div class="ibjjf-status-tag here" style="margin-left:8px">VOCÊ</div>';
                } else if (state === 'next') {
                    h += '<div class="ibjjf-status-tag goal">META</div>';
                } else if (state === 'completed') {
                    h += '<div class="ibjjf-status-tag done">✓</div>';
                }
                h += '</div></div>';

                node.innerHTML = h;
                track.appendChild(node);
            }

            var fillPct = IBJJF_BELTS.length > 0 ? Math.round((completedNodes / IBJJF_BELTS.length) * 100) : 0;
            setTimeout(function() { fillEl.style.height = Math.min(fillPct, 100) + '%'; }, 200);

            var overallPct = 0;
            if (currentIdx >= 0) {
                overallPct = Math.round((currentIdx / (IBJJF_BELTS.length - 1)) * 100);
                if (currentIdx < IBJJF_BELTS.length - 1) {
                    var cfg = BELT_CONFIG[faixaAtual];
                    if (cfg && cfg.minTreinos > 0) {
                        var segPct = Math.round((1 / (IBJJF_BELTS.length - 1)) * 100);
                        overallPct += Math.round(Math.min(totalTreinos / cfg.minTreinos, 0.99) * segPct);
                    }
                }
            }
            overallPct = Math.min(overallPct, 100);
            document.getElementById('ibjjfOverallPct').textContent = overallPct + '%';
            setTimeout(function() { document.getElementById('ibjjfOverallFill').style.width = overallPct + '%'; }, 300);
        }

        function renderMotivation(freq) {
            const iconEl = document.getElementById('evoMotivation').querySelector('.evo-motivation-icon');
            const textEl = document.getElementById('evoMotivationText');
            const subEl = document.getElementById('evoMotivationSub');
            if (freq >= 75) { iconEl.textContent = '🔥'; textEl.textContent = '"Consistência constrói campeões."'; subEl.textContent = 'Sua dedicação está no caminho certo!'; }
            else if (freq >= 60) { iconEl.textContent = '💪'; textEl.textContent = '"Você está perto. Continue firme."'; subEl.textContent = 'Mais alguns treinos e você atinge o objetivo'; }
            else if (freq >= 30) { iconEl.textContent = '🥋'; textEl.textContent = '"A faixa preta é construída nos dias que você quase faltou."'; subEl.textContent = 'Cada treino conta — volte ao tatame'; }
            else { iconEl.textContent = '🌅'; textEl.textContent = '"A jornada de mil milhas começa com um único passo."'; subEl.textContent = 'Nunca é tarde para recomeçar'; }
        }

        // ===== PROFILE (Aba Alunos, colunas I-T) =====
        // I:Nascimento|J:Genero|K:Profissao|L:Bairro|M:Telefone|N:Instagram|O:Emergencia|P:Origem|Q:Objetivo|R:Horario|S:Experiencia|T:Saude
        var PERFIL_FIELDS = [
            { id: 'perfilNascimento', key: 'nascimento' },
            { id: 'perfilGenero',     key: 'genero' },
            { id: 'perfilProfissao',  key: 'profissao' },
            { id: 'perfilBairro',     key: 'bairro' },
            { id: 'perfilTelefone',   key: 'telefone' },
            { id: 'perfilInstagram',  key: 'instagram' },
            { id: 'perfilEmergencia', key: 'emergencia' },
            { id: 'perfilOrigem',     key: 'origem' },
            { id: 'perfilObjetivo',   key: 'objetivo' },
            { id: 'perfilHorario',    key: 'horario' },
            { id: 'perfilExperiencia',key: 'experiencia' },
            { id: 'perfilSaude',      key: 'saude' }
        ];

        function loadProfile() {
            if (!currentUser) return;
            document.getElementById('perfilAvatar').textContent = (currentUser.name || '?')[0].toUpperCase();
            document.getElementById('perfilNome').textContent = currentUser.name || '—';
            document.getElementById('perfilFaixaTag').textContent = (currentUser.faixa || 'Branca') + ' • ' + (currentUser.grau || 0) + '/4 graus • ' + (currentUser.treinos || 0) + ' treinos';
            
            // 1) Load from localStorage cache first (instant)
            var cached = localStorage.getItem('bjjProfile');
            if (cached) {
                try {
                    var cachedProfile = JSON.parse(cached);
                    fillProfileFields(cachedProfile);
                } catch(e) { localStorage.removeItem('bjjProfile'); }
            }
            
            // 2) Then fetch from backend to get latest data
            fetchProfileFromBackend();
            
            document.getElementById('perfilSenhaAtual').value = '';
            document.getElementById('perfilSenhaNova').value = '';
            document.getElementById('perfilSenhaConfirma').value = '';
        }

        function fillProfileFields(p) {
            if (!p) return;
            for (var i = 0; i < PERFIL_FIELDS.length; i++) {
                var f = PERFIL_FIELDS[i];
                var el = document.getElementById(f.id);
                if (!el) continue;
                var val = p[f.key];
                if (val === undefined || val === null) val = '';
                val = val.toString();
                // Convert ISO date to YYYY-MM-DD
                if (f.key === 'nascimento' && val.indexOf('T') > -1) {
                    val = val.substring(0, 10);
                }
                el.value = val;
            }
            updateProfileCompleteness();
        }

        async function fetchProfileFromBackend() {
            if (!currentUser || !currentUser.email) return;
            try {
                var r = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'getProfile', email: currentUser.email })
                });
                var data = await r.json();
                if (data.success && data.profile) {
                    // Cache in localStorage
                    localStorage.setItem('bjjProfile', JSON.stringify(data.profile));
                    fillProfileFields(data.profile);
                    // Check birthday after profile loads
                    checkBirthday(data.profile);
                }
            } catch (err) { console.error('Erro perfil:', err); }
        }

        // ===== BIRTHDAY CELEBRATION =====
        function checkBirthday(profile) {
            if (!profile || !profile.nascimento) return;
            if (!currentUser) return;

            // Parse birth date
            var nascStr = profile.nascimento.toString();
            if (nascStr.indexOf('T') > -1) nascStr = nascStr.substring(0, 10);
            var parts = nascStr.split('-');
            if (parts.length < 3) return;

            var birthMonth = parseInt(parts[1]);
            var birthDay = parseInt(parts[2]);
            var birthYear = parseInt(parts[0]);

            var now = new Date();
            var todayMonth = now.getMonth() + 1;
            var todayDay = now.getDate();
            var currentYear = now.getFullYear();

            // Is today the birthday?
            if (birthMonth !== todayMonth || birthDay !== todayDay) return;

            // Calculate age
            var idade = currentYear - birthYear;
            var faixa = currentUser.faixa || 'Branca';

            // 10+ mensagens que rotacionam aleatoriamente a cada acesso
            var allMessages = [
                'Mais um ano de vida e mais um capítulo na sua história no tatame. Que venham muitas finalizações nesse novo ciclo!',
                'Hoje é seu dia! A mesma garra que você mostra no treino, a vida celebra com mais um ano de conquistas.',
                'Parabéns, guerreiro(a)! O tatame te moldou e a vida te presenteia com mais um ano de evolução. Ossú!',
                'Cada treino seu é uma vitória. Hoje a maior vitória é celebrar mais um ano de vida. Felicidades!',
                'Neste dia especial, lembre-se: sua presença no tatame inspira mais do que você imagina. Parabéns!',
                'Aniversário de quem vive o Jiu Jitsu é comemorado em dobro: na vida e no tatame. Que dia incrível!',
                'Você prova todo dia que disciplina e paixão andam juntas. Hoje o tatame celebra você. Parabéns!',
                'Mais um ano de quedas, levantadas e superações. Isso é Jiu Jitsu. Isso é a vida. Feliz aniversário!',
                'O Jiu Jitsu ensina que cada dia é uma chance de ser melhor. Hoje você é melhor por mais um ano. Parabéns!',
                'Sua jornada no tatame é feita de suor, respeito e evolução. Que este novo ano multiplique tudo isso!',
                'Treinar com você é um privilégio. Que este aniversário marque o início de grandes conquistas!',
                'A academia inteira celebra com você hoje. Mais um ano de luta, amizade e crescimento. Ossú!'
            ];

            // 10+ citações motivacionais
            var allQuotes = [
                '"A faixa não segura as calças, ela segura sua história de superação."',
                '"Cada ano é uma nova fase. No tatame e na vida, a evolução nunca para."',
                '"Mais um ano de vida, mais um ano de luta. O Jiu Jitsu ensina que cada dia é uma vitória."',
                '"O tatame é onde celebramos cada conquista. Hoje celebramos você!"',
                '"A melhor luta da sua vida é a que você trava consigo mesmo. Parabéns por mais um ano vencendo!"',
                '"No Jiu Jitsu e na vida: consistência, resiliência e humildade."',
                '"Que neste novo ano você conquiste muitos treinos e fortaleça cada vez mais sua base."',
                '"O campeão não é aquele que sempre vence, mas aquele que nunca desiste de lutar."',
                '"Quem treina junto, cresce junto. Obrigado por fazer parte dessa família."',
                '"O tatame é o espelho da vida: te derruba, te ensina e te levanta mais forte."',
                '"Sua maior faixa é a persistência. Continue no caminho, guerreiro!"',
                '"Aniversário é dia de celebrar cada gota de suor que virou conquista."'
            ];

            var msg = allMessages[Math.floor(Math.random() * allMessages.length)];
            var quote = allQuotes[Math.floor(Math.random() * allQuotes.length)];

            // Belt emojis
            var beltEmoji = { 'Branca': '⚪', 'Azul': '🔵', 'Roxa': '🟣', 'Marrom': '🟤', 'Preta': '⚫' };

            showBirthdayCelebration(currentUser.name, idade, 0, faixa, beltEmoji[faixa] || '🥋', msg, quote);
        }

        function showBirthdayCelebration(name, idade, treinos, faixa, beltEmoji, msg, quote) {
            var firstName = name.split(' ')[0];

            // Fill content
            document.getElementById('bdayName').textContent = firstName + '!';
            document.getElementById('bdayMsg').textContent = msg;
            document.getElementById('bdayQuote').textContent = quote;

            // Age card
            if (idade > 0) {
                document.getElementById('bdayStats').innerHTML = '<div class="bday-stat"><div class="bday-stat-num">🎉 ' + idade + ' anos</div></div>';
            } else {
                document.getElementById('bdayStats').innerHTML = '';
            }

            // Show overlay
            var overlay = document.getElementById('bdayOverlay');
            overlay.style.display = 'flex';

            // Generate confetti
            spawnConfetti(overlay);
        }

        function spawnConfetti(container) {
            var colors = ['#d4af37', '#f5d76e', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dfe6e9', '#fd79a8', '#a29bfe', '#00b894', '#e17055'];
            var shapes = ['square', 'circle'];

            for (var i = 0; i < 60; i++) {
                var confetti = document.createElement('div');
                confetti.className = 'bday-confetti';
                var color = colors[Math.floor(Math.random() * colors.length)];
                var size = 6 + Math.random() * 8;
                var left = Math.random() * 100;
                var delay = Math.random() * 3;
                var duration = 3 + Math.random() * 4;
                var shape = shapes[Math.floor(Math.random() * shapes.length)];

                confetti.style.cssText = 'background:' + color + ';width:' + size + 'px;height:' + size + 'px;left:' + left + '%;animation-delay:' + delay + 's;animation-duration:' + duration + 's;' + (shape === 'circle' ? 'border-radius:50%;' : 'border-radius:2px;');
                container.appendChild(confetti);
            }

            // Continuous confetti waves
            var waveCount = 0;
            var waveInterval = setInterval(function() {
                waveCount++;
                if (waveCount > 4) { clearInterval(waveInterval); return; }
                for (var j = 0; j < 20; j++) {
                    var c = document.createElement('div');
                    c.className = 'bday-confetti';
                    var clr = colors[Math.floor(Math.random() * colors.length)];
                    var sz = 6 + Math.random() * 8;
                    c.style.cssText = 'background:' + clr + ';width:' + sz + 'px;height:' + sz + 'px;left:' + (Math.random() * 100) + '%;animation-duration:' + (3 + Math.random() * 4) + 's;' + (Math.random() > 0.5 ? 'border-radius:50%;' : '');
                    container.appendChild(c);
                }
            }, 2000);
        }

        function closeBirthday() {
            var overlay = document.getElementById('bdayOverlay');
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 0.5s ease';
            setTimeout(function() {
                overlay.style.display = 'none';
                overlay.style.opacity = '';
                overlay.style.transition = '';
                // Remove confetti
                var confettis = overlay.querySelectorAll('.bday-confetti');
                confettis.forEach(function(c) { c.remove(); });
            }, 500);
        }

        function updateProfileCompleteness() {
            var filled = 0;
            for (var i = 0; i < PERFIL_FIELDS.length; i++) {
                var el = document.getElementById(PERFIL_FIELDS[i].id);
                if (el && el.value && el.value.trim() !== '') filled++;
            }
            var pct = Math.round((filled / PERFIL_FIELDS.length) * 100);
            document.getElementById('perfilCompletePct').textContent = pct + '%';
            setTimeout(function() { document.getElementById('perfilCompleteFill').style.width = pct + '%'; }, 100);
        }

        async function saveProfile() {
            if (!currentUser) return;
            var btn = document.getElementById('perfilSaveBtn');
            btn.disabled = true;
            btn.textContent = '⏳ Salvando...';

            var profileData = {};
            for (var i = 0; i < PERFIL_FIELDS.length; i++) {
                var f = PERFIL_FIELDS[i];
                var el = document.getElementById(f.id);
                profileData[f.key] = el ? el.value || '' : '';
            }

            try {
                var r = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'saveProfile',
                        email: currentUser.email,
                        profile: profileData
                    })
                });
                var data = await r.json();
                if (data.success) {
                    // Cache locally for persistence
                    localStorage.setItem('bjjProfile', JSON.stringify(profileData));
                    showMessage('perfilMessage', '✅ Perfil salvo com sucesso!', 'success');
                    updateProfileCompleteness();
                } else {
                    showMessage('perfilMessage', '❌ ' + (data.message || data.error || 'Erro ao salvar'), 'danger');
                }
            } catch (err) {
                showMessage('perfilMessage', '❌ Erro de conexão', 'danger');
            }

            btn.disabled = false;
            btn.textContent = '💾 Salvar Perfil';
            setTimeout(function() { document.getElementById('perfilMessage').innerHTML = ''; }, 4000);
        }

        async function changePassword() {
            if (!currentUser) return;
            var atual = document.getElementById('perfilSenhaAtual').value;
            var nova = document.getElementById('perfilSenhaNova').value;
            var confirma = document.getElementById('perfilSenhaConfirma').value;

            if (!atual || !nova || !confirma) { showMessage('perfilPwdMessage', '⚠️ Preencha todos os campos', 'warning'); return; }
            if (nova.length < 6) { showMessage('perfilPwdMessage', '⚠️ Mínimo 6 caracteres', 'warning'); return; }
            if (nova !== confirma) { showMessage('perfilPwdMessage', '⚠️ As senhas não coincidem', 'warning'); return; }

            try {
                var r = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'changePassword', email: currentUser.email, currentPassword: atual, newPassword: nova })
                });
                var data = await r.json();
                if (data.success) {
                    showMessage('perfilPwdMessage', '✅ Senha alterada!', 'success');
                    document.getElementById('perfilSenhaAtual').value = '';
                    document.getElementById('perfilSenhaNova').value = '';
                    document.getElementById('perfilSenhaConfirma').value = '';
                } else {
                    showMessage('perfilPwdMessage', '❌ ' + (data.message || data.error || 'Erro'), 'danger');
                }
            } catch (err) {
                showMessage('perfilPwdMessage', '❌ Erro de conexão', 'danger');
            }
            setTimeout(function() { document.getElementById('perfilPwdMessage').innerHTML = ''; }, 4000);
        }

        // Phone mask
        (function() {
            var tel = document.getElementById('perfilTelefone');
            if (tel) {
                tel.addEventListener('input', function(e) {
                    var v = e.target.value.replace(/\D/g, '');
                    if (v.length > 11) v = v.substring(0, 11);
                    if (v.length > 6) v = '(' + v.substring(0, 2) + ') ' + v.substring(2, 7) + '-' + v.substring(7);
                    else if (v.length > 2) v = '(' + v.substring(0, 2) + ') ' + v.substring(2);
                    else if (v.length > 0) v = '(' + v;
                    e.target.value = v;
                    updateProfileCompleteness();
                });
            }
            var allFields = document.querySelectorAll('#perfil input, #perfil select, #perfil textarea');
            for (var i = 0; i < allFields.length; i++) {
                allFields[i].addEventListener('change', updateProfileCompleteness);
                allFields[i].addEventListener('input', function(e) {
                    if (e.target.id !== 'perfilTelefone') updateProfileCompleteness();
                });
            }
        })();

        // ===== AUTO UPDATE GRAU =====
        async function autoUpdateGrau(novoGrau) {
            if (!currentUser) return;
            if (currentUser._updatingGrau) return;
            if (novoGrau <= (currentUser.grau || 0)) return;
            currentUser._updatingGrau = true;
            try {
                const r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'updateGrau', email: currentUser.email, grau: novoGrau }) });
                const data = await r.json();
                if (data.success) {
                    currentUser.grau = novoGrau;
                    localStorage.setItem('bjjUser', JSON.stringify(currentUser));
                }
            } catch (err) { console.error('Erro grau:', err); }
            finally { currentUser._updatingGrau = false; }
        }

        // ===== REWARDS / GAMIFICATION =====
        var rewardsData = null;

        async function loadRewards() {
            if (!currentUser || !currentUser.email) return;

            // Show loading state
            document.getElementById('rwdPontos').textContent = '...';
            document.getElementById('rwdBreakdown').innerHTML = '<div style="text-align:center;color:var(--text-3);font-size:12px;padding:12px;">Carregando...</div>';

            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getRewardsData', email: currentUser.email }) });
                var data = await r.json();
                if (data.success) {
                    rewardsData = data;
                    renderRewards(data);
                } else {
                    document.getElementById('rwdPontos').textContent = '0';
                    document.getElementById('rwdBreakdown').innerHTML = '<div style="text-align:center;color:var(--text-3);font-size:12px;padding:12px;">Erro ao carregar</div>';
                }
            } catch (err) {
                document.getElementById('rwdPontos').textContent = '0';
            }
        }

        function renderRewards(d) {
            var TIER_CONFIG = {
                bronze:   { icon: '🥉', name: 'BRONZE',   label: 'Sem desconto' },
                prata:    { icon: '🥈', name: 'PRATA',    label: '5% de desconto' },
                ouro:     { icon: '🥇', name: 'OURO',     label: '10% de desconto' },
                diamante: { icon: '💎', name: 'DIAMANTE', label: '15% de desconto' }
            };

            var tier = d.tier || 'bronze';
            var cfg = TIER_CONFIG[tier];

            // Hero card
            var hero = document.getElementById('rwdHero');
            hero.className = 'rwd-hero ' + tier;
            document.getElementById('rwdTierIcon').textContent = cfg.icon;
            document.getElementById('rwdTierName').textContent = cfg.name;
            document.getElementById('rwdDesconto').textContent = d.desconto > 0 ? d.desconto + '% de desconto' : 'Sem desconto';

            // Animate pontos counter
            animateCounter('rwdPontos', d.pontos || 0);

            // Progress
            if (d.proximoTier) {
                document.getElementById('rwdProgressSection').style.display = 'block';
                document.getElementById('rwdProgressLeft').textContent = cfg.name;
                var TIER_THRESHOLDS = { 'Prata': 100, 'Ouro': 250, 'Diamante': 450 };
                document.getElementById('rwdProgressRight').textContent = d.proximoTier + ' (' + TIER_THRESHOLDS[d.proximoTier] + ' pts)';
                setTimeout(function() {
                    document.getElementById('rwdProgressFill').style.width = Math.min(100, d.progresso || 0) + '%';
                }, 100);
            } else {
                document.getElementById('rwdProgressSection').style.display = 'none';
            }

            // Stats
            document.getElementById('rwdHomeCount').textContent = d.totalHome || 0;
            document.getElementById('rwdVisitCount').textContent = d.totalVisita || 0;
            document.getElementById('rwdCTsCount').textContent = d.numCTs || 0;

            // CTs tags
            var ctsSection = document.getElementById('rwdCTsSection');
            if (d.ctsVisitados && d.ctsVisitados.length > 0) {
                ctsSection.style.display = 'block';
                var tagsHtml = '';
                for (var t = 0; t < d.ctsVisitados.length; t++) {
                    var isHome = d.ctsVisitados[t] === d.homeCT;
                    tagsHtml += '<div class="rwd-ct-tag ' + (isHome ? 'home' : 'visit') + '">' +
                        (isHome ? '🏠 ' : '🌍 ') + d.ctsVisitados[t] + '</div>';
                }
                document.getElementById('rwdCTsTags').innerHTML = tagsHtml;
            } else {
                ctsSection.style.display = 'none';
            }

            // Breakdown
            var bkHtml = '';
            if (d.breakdown && d.breakdown.length > 0) {
                for (var b = 0; b < d.breakdown.length; b++) {
                    var bk = d.breakdown[b];
                    bkHtml += '<div class="rwd-breakdown-row">' +
                        '<div class="rwd-breakdown-icon">' + (bk.icon || '⚡') + '</div>' +
                        '<div class="rwd-breakdown-label">' + bk.label + '</div>' +
                        '<div class="rwd-breakdown-pts">+' + bk.pts + '</div>' +
                    '</div>';
                }
            } else {
                bkHtml = '<div style="text-align:center;color:var(--text-3);font-size:12px;padding:16px;">Nenhum treino registrado este mês.<br>Faça check-in para começar a pontuar! 🥋</div>';
            }
            document.getElementById('rwdBreakdown').innerHTML = bkHtml;

            // Histórico
            var histHtml = '';
            if (d.historico && d.historico.length > 0) {
                var maxHist = Math.max.apply(null, d.historico.map(function(h) { return h.pontos; }));
                if (maxHist === 0) maxHist = 1;
                for (var h = 0; h < d.historico.length; h++) {
                    var hItem = d.historico[h];
                    var hPct = Math.round((hItem.pontos / maxHist) * 100);
                    var isCurrentMonth = (h === d.historico.length - 1);
                    histHtml += '<div class="rwd-hist-row">' +
                        '<div class="rwd-hist-label">' + hItem.label + '</div>' +
                        '<div class="rwd-hist-track"><div class="rwd-hist-fill" style="width:' + hPct + '%;' + (isCurrentMonth ? 'background:linear-gradient(90deg,#d4af37,#f5d76e);' : '') + '"></div></div>' +
                        '<div class="rwd-hist-val">' + hItem.pontos + ' pts</div>' +
                    '</div>';
                }
            } else {
                histHtml = '<div style="text-align:center;color:var(--text-3);font-size:12px;padding:12px;">Sem dados históricos</div>';
            }
            document.getElementById('rwdHistorico').innerHTML = histHtml;

            // Tier Ladder
            var TIERS = [
                { key: 'diamante', icon: '💎', name: 'Diamante', range: '450+ pts', pct: '15%' },
                { key: 'ouro', icon: '🥇', name: 'Ouro', range: '250–449 pts', pct: '10%' },
                { key: 'prata', icon: '🥈', name: 'Prata', range: '100–249 pts', pct: '5%' },
                { key: 'bronze', icon: '🥉', name: 'Bronze', range: '0–99 pts', pct: '—' }
            ];
            var ladderHtml = '';
            for (var l = 0; l < TIERS.length; l++) {
                var tr = TIERS[l];
                var isActive = tr.key === tier;
                ladderHtml += '<div class="rwd-ladder-row' + (isActive ? ' active' : '') + '">' +
                    '<div class="rwd-ladder-icon">' + tr.icon + '</div>' +
                    '<div class="rwd-ladder-info">' +
                        '<div class="rwd-ladder-name">' + tr.name + '</div>' +
                        '<div class="rwd-ladder-range">' + tr.range + '</div>' +
                    '</div>' +
                    '<div class="rwd-ladder-pct">' + tr.pct + '</div>' +
                '</div>';
            }
            document.getElementById('rwdLadder').innerHTML = ladderHtml;
        }

        function animateCounter(elementId, target) {
            var el = document.getElementById(elementId);
            var current = 0;
            var duration = 800;
            var steps = 30;
            var increment = target / steps;
            var stepTime = duration / steps;

            function step() {
                current += increment;
                if (current >= target) {
                    el.textContent = target;
                    return;
                }
                el.textContent = Math.round(current);
                setTimeout(step, stepTime);
            }

            if (target === 0) { el.textContent = '0'; return; }
            step();
        }

        // ===== ADMIN PANEL =====
        let adminCheckinFilter = 'hoje';
        let adminPendingCheckins = [];
        let adminApprovedCheckins = [];
        let adminSelectedCT = null;
        let adminStudentsCache = [];

        function switchAdminTab(tabName, evt) {
            document.querySelectorAll('.adm-tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('#adminNav .bnav-btn').forEach(function(b) { b.classList.remove('active'); });
            var tab = document.getElementById(tabName);
            if (tab) tab.classList.add('active');
            var e = evt || window.event;
            if (e && e.target) {
                var btn = e.target.closest('.bnav-btn');
                if (btn) btn.classList.add('active');
            }
            if (tabName === 'adm-painel') loadAdminPanel();
            if (tabName === 'adm-alunos') loadStudentsList();
            if (tabName === 'adm-cts') loadCTScheduleAdmin();
            if (tabName === 'adm-relatorios') loadAttendanceReport();
            if (tabName === 'adm-checkin') loadAdminCTs();
            if (tabName === 'adm-perfil') loadAdminProfile();
        }

        function loadAdminProfile() {
            if (!currentUser) return;
            document.getElementById('admPerfilName').textContent = currentUser.name;
            document.getElementById('admPerfilEmail').textContent = currentUser.email;
            document.getElementById('admPerfilInitial').textContent = currentUser.name.charAt(0).toUpperCase();
        }

        async function loadAdminPanel() {
            if (!currentUser || !isAdmin()) return;
            loadPendingAccounts();
            loadPendingResets();
            loadPendingCheckins();
        }

        // --- ADMIN OWN CHECK-IN ---
        async function loadAdminCTs() {
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getCTsList' }) });
                var data = await r.json();
                if (data.success && data.cts) {
                    var grid = document.getElementById('admCtGrid');
                    if (grid) {
                        grid.innerHTML = '';
                        data.cts.forEach(function(ct) {
                            var name = typeof ct === 'string' ? ct : ct.name || ct.toString();
                            var btn = document.createElement('button');
                            btn.type = 'button';
                            btn.className = 'ct-btn';
                            if (adminSelectedCT === name) btn.classList.add('selected');
                            btn.textContent = name;
                            btn.addEventListener('click', function() {
                                adminSelectedCT = name;
                                document.querySelectorAll('#admCtGrid .ct-btn').forEach(function(b) { b.classList.remove('selected'); });
                                btn.classList.add('selected');
                                document.getElementById('admSelectedCT').textContent = name;
                                document.getElementById('admSelectedInfo').classList.add('active');
                            });
                            grid.appendChild(btn);
                        });
                    }
                }
            } catch (err) { console.error('Erro CTs admin:', err); }
        }

        function adminConfirmAttendance() {
            if (!adminSelectedCT) { showMessage('admAttendanceMessage', 'Selecione o CT', 'warning'); return; }
            var now = new Date();
            var hora = now.getHours();
            if (hora < 6 || hora >= 23) {
                showMessage('admAttendanceMessage', '⚠️ Check-in disponível apenas das 06:00 às 23:00', 'warning');
                return;
            }
            showMessage('admAttendanceMessage', 'Registrando...', 'info');
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'attendance', email: currentUser.email, name: currentUser.name,
                    faixa: currentUser.faixa, grau: currentUser.grau, ct: adminSelectedCT
                })
            }).then(function(r) { return r.json(); }).then(function(data) {
                if (data.success) {
                    currentUser.treinos = (currentUser.treinos || 0) + 1;
                    localStorage.setItem('bjjUser', JSON.stringify(currentUser));
                    document.getElementById('admDisplayCount').textContent = currentUser.treinos;
                    showMessage('admAttendanceMessage', '✅ Presença confirmada!', 'success');
                    adminSelectedCT = null;
                    document.querySelectorAll('#admCtGrid .ct-btn').forEach(function(b) { b.classList.remove('selected'); });
                    document.getElementById('admSelectedCT').textContent = '-';
                    document.getElementById('admSelectedInfo').classList.remove('active');
                    setTimeout(function() { document.getElementById('admAttendanceMessage').innerHTML = ''; }, 4000);
                } else {
                    showMessage('admAttendanceMessage', data.message || 'Erro', 'danger');
                }
            }).catch(function() { showMessage('admAttendanceMessage', 'Erro de conexão', 'danger'); });
        }

        // --- ADMIN CHANGE PASSWORD ---
        async function adminChangePassword() {
            var cur = document.getElementById('admCurrentPw').value;
            var nw = document.getElementById('admNewPw').value;
            var confirm = document.getElementById('admConfirmPw').value;
            if (!cur || !nw) { showMessage('admPwMessage', 'Preencha todos os campos', 'warning'); return; }
            if (nw.length < 6) { showMessage('admPwMessage', 'Mínimo 6 caracteres', 'warning'); return; }
            if (nw !== confirm) { showMessage('admPwMessage', 'Senhas não conferem', 'warning'); return; }
            showMessage('admPwMessage', 'Alterando...', 'info');
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({
                    action: 'changePassword', email: currentUser.email, currentPassword: cur, newPassword: nw
                })});
                var data = await r.json();
                if (data.success) {
                    showMessage('admPwMessage', '✅ Senha alterada!', 'success');
                    document.getElementById('admCurrentPw').value = '';
                    document.getElementById('admNewPw').value = '';
                    document.getElementById('admConfirmPw').value = '';
                } else {
                    showMessage('admPwMessage', data.message || 'Erro', 'danger');
                }
            } catch (err) { showMessage('admPwMessage', 'Erro de conexão', 'danger'); }
        }

        // --- STUDENTS LIST ---
        // --- ATTENDANCE REPORT ---
        var reportData = null;
        var reportSelectedCT = 'todos';

        function switchReportCT(ct) {
            reportSelectedCT = ct;
            loadAttendanceReport();
        }

        async function loadAttendanceReport() {
            document.getElementById('rptTotal').textContent = '...';
            document.getElementById('rptAlunos').textContent = '...';
            document.getElementById('rptMedia').textContent = '...';
            document.getElementById('rptMediaAluno').textContent = '...';
            try {
                var payload = { action: 'getAttendanceReport' };
                if (reportSelectedCT && reportSelectedCT !== 'todos') payload.ct = reportSelectedCT;
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
                var data = await r.json();
                if (data.success) {
                    reportData = data;
                    renderReportCTFilter(data);
                    renderReport(data);
                } else {
                    document.getElementById('rptTotal').textContent = '0';
                }
            } catch (err) {
                document.getElementById('rptTotal').textContent = 'Erro';
            }
        }

        function renderReportCTFilter(d) {
            var container = document.getElementById('rptCTFilter');
            container.innerHTML = '';
            var allCTs = d.allCTs || [];
            var current = d.filterCT || 'todos';

            // Botão "Todos"
            var allBtn = document.createElement('button');
            allBtn.className = 'report-filter-btn' + (current === 'todos' ? ' active' : '');
            allBtn.textContent = 'Todos os CTs';
            allBtn.onclick = function() { switchReportCT('todos'); };
            container.appendChild(allBtn);

            // Botão por CT
            for (var i = 0; i < allCTs.length; i++) {
                var btn = document.createElement('button');
                btn.className = 'report-filter-btn' + (current === allCTs[i] ? ' active' : '');
                btn.textContent = allCTs[i];
                btn.setAttribute('data-ct', allCTs[i]);
                btn.onclick = (function(ct) { return function() { switchReportCT(ct); }; })(allCTs[i]);
                container.appendChild(btn);
            }
        }

        function renderReport(d) {
            var isFiltered = d.filterCT && d.filterCT !== 'todos';
            var ctLabel = isFiltered ? ' (' + d.filterCT + ')' : '';

            // KPIs
            document.getElementById('rptTotal').textContent = d.totalGeral || 0;
            document.getElementById('rptAlunos').textContent = d.totalAlunos || 0;
            var mediaMes = d.byMonth && d.byMonth.length > 0 ? Math.round(d.totalGeral / d.byMonth.length) : 0;
            document.getElementById('rptMedia').textContent = mediaMes;
            var mediaAluno = d.totalAlunos > 0 ? (d.totalGeral / d.totalAlunos).toFixed(1) : '0';
            document.getElementById('rptMediaAluno').textContent = mediaAluno;

            // Picos
            var DAY_LABELS_RPT = { dom: 'Domingo', seg: 'Segunda', ter: 'Terça', qua: 'Quarta', qui: 'Quinta', sex: 'Sexta', sab: 'Sábado' };
            if (d.pico) {
                document.getElementById('rptPicoMes').textContent = d.pico.mes ? d.pico.mes.label + ' (' + d.pico.mes.total + ')' : '-';
                document.getElementById('rptPicoDia').textContent = d.pico.dia ? DAY_LABELS_RPT[d.pico.dia] || d.pico.dia : '-';
                document.getElementById('rptPicoHora').textContent = d.pico.hora ? d.pico.hora.hour + ' (' + d.pico.hora.total + ')' : '-';
            }

            // By Month
            renderBarChart('rptByMonth', (d.byMonth || []).map(function(m) { return { label: m.label, value: m.total }; }), 'gold');

            // By Day
            var dayOrder = ['seg', 'ter', 'qua', 'qui', 'sex', 'sab', 'dom'];
            var dayLabels = { seg: 'Seg', ter: 'Ter', qua: 'Qua', qui: 'Qui', sex: 'Sex', sab: 'Sáb', dom: 'Dom' };
            var dayData = dayOrder.map(function(k) { return { label: dayLabels[k], value: d.byDayOfWeek ? d.byDayOfWeek[k] || 0 : 0 }; });
            renderBarChart('rptByDay', dayData, 'green');

            // By Hour
            renderBarChart('rptByHour', (d.byHour || []).map(function(h) { return { label: h.hour, value: h.total }; }), 'cyan');

            // By CT — só mostra quando "Todos"
            var ctSection = document.getElementById('rptByCTSection');
            if (isFiltered) {
                ctSection.style.display = 'none';
            } else {
                ctSection.style.display = 'block';
                renderBarChart('rptByCT', (d.byCT || []).map(function(c) { return { label: c.ct, value: c.total }; }), 'purple');
            }

            // Top Alunos
            var topHtml = '';
            if (d.byAluno && d.byAluno.length > 0) {
                var maxAluno = d.byAluno[0].total;
                for (var a = 0; a < Math.min(15, d.byAluno.length); a++) {
                    var al = d.byAluno[a];
                    var pct = maxAluno > 0 ? Math.round((al.total / maxAluno) * 100) : 0;
                    topHtml += '<div class="report-bar-row">' +
                        '<div class="report-bar-label" style="min-width:100px;font-size:11px;">' + (a + 1) + '. ' + al.name + '</div>' +
                        '<div class="report-bar-track"><div class="report-bar-fill gold" style="width:' + pct + '%"></div></div>' +
                        '<div class="report-bar-value">' + al.total + '</div>' +
                    '</div>';
                }
            } else {
                topHtml = '<div style="text-align:center;color:var(--adm-text-3);padding:12px;">Sem dados</div>';
            }
            document.getElementById('rptTopAlunos').innerHTML = topHtml;

            // Records
            var tbody = document.getElementById('rptRecords');
            var rHtml = '';
            if (d.records && d.records.length > 0) {
                for (var r = 0; r < d.records.length; r++) {
                    var rec = d.records[r];
                    rHtml += '<tr><td>' + rec.name + '</td><td>' + rec.ct + '</td><td>' + rec.data + '</td><td>' + rec.hora + '</td><td>' + (rec.dia || '') + '</td></tr>';
                }
            } else {
                rHtml = '<tr><td colspan="5" style="text-align:center;padding:16px;color:var(--adm-text-3);">Nenhuma presença registrada</td></tr>';
            }
            tbody.innerHTML = rHtml;
        }

        function renderBarChart(containerId, data, colorClass) {
            var container = document.getElementById(containerId);
            if (!data || data.length === 0) {
                container.innerHTML = '<div style="text-align:center;color:var(--adm-text-3);padding:12px;font-size:12px;">Sem dados</div>';
                return;
            }
            var maxVal = Math.max.apply(null, data.map(function(d) { return d.value; }));
            if (maxVal === 0) maxVal = 1;
            var html = '';
            for (var i = 0; i < data.length; i++) {
                var pct = Math.round((data[i].value / maxVal) * 100);
                html += '<div class="report-bar-row">' +
                    '<div class="report-bar-label">' + data[i].label + '</div>' +
                    '<div class="report-bar-track"><div class="report-bar-fill ' + colorClass + '" style="width:' + pct + '%"></div></div>' +
                    '<div class="report-bar-value">' + data[i].value + '</div>' +
                '</div>';
            }
            container.innerHTML = html;
        }

        // --- CT SCHEDULE MANAGEMENT ---
        var ctScheduleCache = {};

        async function loadCTScheduleAdmin() {
            var container = document.getElementById('adminCTScheduleList');
            container.innerHTML = '<div class="admin-empty">Carregando...</div>';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getCTsList' }) });
                var data = await r.json();
                if (data.success && data.cts && data.cts.length > 0) {
                    ctScheduleCache = {};
                    var html = '';
                    var DAY_LABELS = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
                    var DAY_KEYS = ['seg', 'ter', 'qua', 'qui', 'sex', 'sab', 'dom'];

                    for (var i = 0; i < data.cts.length; i++) {
                        var ct = data.cts[i];
                        var ctName = typeof ct === 'string' ? ct : ct.name;
                        var schedule = (typeof ct === 'object' && ct.schedule) ? ct.schedule : {};
                        ctScheduleCache[ctName] = JSON.parse(JSON.stringify(schedule));

                        html += '<div class="ct-schedule-card" id="ctSched_' + i + '">';
                        html += '<div class="ct-schedule-header">';
                        html += '<div class="ct-schedule-name">📍 ' + ctName + '</div>';
                        html += '<span class="ct-schedule-status saved" id="ctSchedStatus_' + i + '">salvo</span>';
                        html += '</div>';
                        html += '<div class="ct-schedule-days">';

                        for (var d = 0; d < DAY_KEYS.length; d++) {
                            var active = schedule[DAY_KEYS[d]] === true;
                            html += '<div class="ct-day-toggle ' + (active ? 'active' : '') + '" ';
                            html += 'onclick="toggleCTDay(\'' + ctName.replace(/'/g, "\\'") + '\', \'' + DAY_KEYS[d] + '\', this, ' + i + ')">';
                            html += '<span class="ct-day-label">' + DAY_LABELS[d] + '</span>';
                            html += '<span class="ct-day-icon"></span>';
                            html += '</div>';
                        }

                        html += '</div>';
                        html += '<div class="ct-schedule-actions">';
                        html += '<button class="ct-schedule-save" id="ctSchedSave_' + i + '" onclick="saveCTSchedule(\'' + ctName.replace(/'/g, "\\'") + '\', ' + i + ')">Salvar Horário</button>';
                        html += '</div>';
                        html += '</div>';
                    }

                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="admin-empty">Nenhum CT cadastrado</div>';
                }
            } catch (err) {
                container.innerHTML = '<div class="admin-empty">Erro ao carregar CTs</div>';
            }
        }

        function toggleCTDay(ctName, dayKey, el, cardIdx) {
            var isActive = el.classList.contains('active');
            if (isActive) {
                el.classList.remove('active');
            } else {
                el.classList.add('active');
            }
            // Update cache
            if (!ctScheduleCache[ctName]) ctScheduleCache[ctName] = {};
            ctScheduleCache[ctName][dayKey] = !isActive;
            // Mark as unsaved
            var statusEl = document.getElementById('ctSchedStatus_' + cardIdx);
            if (statusEl) {
                statusEl.textContent = 'alterado';
                statusEl.className = 'ct-schedule-status unsaved';
            }
        }

        async function saveCTSchedule(ctName, cardIdx) {
            var saveBtn = document.getElementById('ctSchedSave_' + cardIdx);
            if (saveBtn) { saveBtn.disabled = true; saveBtn.textContent = 'Salvando...'; }

            var schedule = ctScheduleCache[ctName] || {};
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'saveCTSchedule', ctName: ctName, schedule: schedule }) });
                var data = await r.json();
                if (data.success) {
                    var statusEl = document.getElementById('ctSchedStatus_' + cardIdx);
                    if (statusEl) {
                        statusEl.textContent = '✓ salvo';
                        statusEl.className = 'ct-schedule-status saved';
                    }
                    // Atualiza ctSchedules global
                    ctSchedules[ctName] = JSON.parse(JSON.stringify(schedule));
                } else {
                    alert(data.message || 'Erro ao salvar');
                }
            } catch (err) {
                alert('Erro de conexão');
            }
            if (saveBtn) { saveBtn.disabled = false; saveBtn.textContent = 'Salvar Horário'; }
        }

        // --- STUDENTS LIST ---
        async function loadStudentsList() {
            var container = document.getElementById('adminStudentsList');
            container.innerHTML = '<div class="admin-empty">Carregando...</div>';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getStudentsList' }) });
                var data = await r.json();
                if (data.success && data.students) {
                    adminStudentsCache = data.students;
                    renderStudentsList(adminStudentsCache);
                    var badge = document.getElementById('adminStudentsBadge');
                    badge.textContent = data.students.length;
                    badge.style.display = 'inline-block';
                } else {
                    container.innerHTML = '<div class="admin-empty">Nenhum aluno cadastrado</div>';
                }
            } catch (err) {
                container.innerHTML = '<div class="admin-empty">Erro ao carregar</div>';
            }
        }

        function renderStudentsList(students) {
            var container = document.getElementById('adminStudentsList');
            if (students.length === 0) {
                container.innerHTML = '<div class="admin-empty">Nenhum aluno encontrado</div>';
                return;
            }
            var html = '';
            for (var i = 0; i < students.length; i++) {
                var s = students[i];
                var initial = (s.name || '?').charAt(0).toUpperCase();
                var isAdm = (s.admin === true || s.admin === 'TRUE');
                html += '<div class="admin-student-card">' +
                    '<div class="admin-card-avatar">' + initial + '</div>' +
                    '<div class="admin-student-info">' +
                        '<div class="admin-student-name">' + (s.name || '-') + (isAdm ? ' <span class="admin-header-badge">ADMIN</span>' : '') + '</div>' +
                        '<div class="admin-student-meta">' + (s.email || '') + '</div>' +
                        '<div class="admin-student-belt">🥋 ' + (s.faixa || '-') + ' · 📍 ' + (s.ct || '-') + '</div>' +
                    '</div>' +
                    (isAdm ? '' : '<button class="admin-student-delete" onclick="deleteStudent(\'' + (s.email || '').replace(/'/g, "\\'") + '\')">✕</button>') +
                '</div>';
            }
            container.innerHTML = html;
        }

        function filterStudentsList() {
            var q = (document.getElementById('adminStudentSearch').value || '').toLowerCase();
            if (!q) { renderStudentsList(adminStudentsCache); return; }
            var filtered = adminStudentsCache.filter(function(s) {
                return ((s.name || '').toLowerCase().indexOf(q) !== -1) || ((s.email || '').toLowerCase().indexOf(q) !== -1);
            });
            renderStudentsList(filtered);
        }

        async function deleteStudent(email) {
            if (!confirm('Remover o aluno ' + email + '? Esta ação não pode ser desfeita.')) return;
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'deleteStudent', email: email }) });
                var data = await r.json();
                if (data.success) {
                    loadStudentsList();
                } else { alert(data.message || 'Erro'); }
            } catch (err) { alert('Erro de conexão'); }
        }

        // --- PENDING ACCOUNTS ---
        async function loadPendingAccounts() {
            var container = document.getElementById('adminAccountsList');
            container.innerHTML = '<div class="admin-empty">Carregando...</div>';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getPendingAccounts' }) });
                var data = await r.json();
                if (data.success && data.accounts && data.accounts.length > 0) {
                    var html = '';
                    for (var i = 0; i < data.accounts.length; i++) {
                        var acc = data.accounts[i];
                        html += renderAccountCard(acc, i);
                    }
                    container.innerHTML = html;
                    var badge = document.getElementById('adminAccBadge');
                    badge.textContent = data.accounts.length;
                    badge.style.display = 'inline-block';
                    document.getElementById('adminPendingAccountsCount').textContent = data.accounts.length;
                } else {
                    container.innerHTML = '<div class="admin-empty">Nenhum cadastro pendente 🎉</div>';
                    document.getElementById('adminAccBadge').style.display = 'none';
                    document.getElementById('adminPendingAccountsCount').textContent = '0';
                }
            } catch (err) {
                container.innerHTML = '<div class="admin-empty">Erro ao carregar</div>';
            }
        }

        function renderAccountCard(acc, idx) {
            var initial = (acc.name || '?').charAt(0).toUpperCase();
            var faixa = acc.faixa || 'Branca';
            var ct = acc.ct || '-';
            var dataStr = acc.data ? new Date(acc.data).toLocaleDateString('pt-BR') : '-';
            return '<div class="admin-card" id="accCard' + idx + '">' +
                '<div class="admin-card-top">' +
                    '<div class="admin-card-avatar">' + initial + '</div>' +
                    '<div class="admin-card-info">' +
                        '<div class="admin-card-name">' + (acc.name || 'Sem nome') + '</div>' +
                        '<div class="admin-card-meta">' + (acc.email || '') + '</div>' +
                    '</div>' +
                '</div>' +
                '<div class="admin-card-detail">🥋 ' + faixa + ' · 📍 ' + ct + ' · 📅 ' + dataStr + '</div>' +
                '<div class="admin-card-actions">' +
                    '<button class="admin-btn approve" onclick="approveAccount(\'' + (acc.email || '').replace(/'/g, "\\'") + '\',' + idx + ')">✓ Aprovar</button>' +
                    '<button class="admin-btn reject" onclick="rejectAccount(\'' + (acc.email || '').replace(/'/g, "\\'") + '\',' + idx + ')">✕ Rejeitar</button>' +
                '</div>' +
            '</div>';
        }

        async function approveAccount(email, idx) {
            var card = document.getElementById('accCard' + idx);
            if (card) card.style.opacity = '0.5';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'approveAccount', email: email }) });
                var data = await r.json();
                if (data.success) {
                    if (card) { card.style.background = 'rgba(45,138,78,0.1)'; card.innerHTML = '<div class="admin-empty" style="color:#2d8a4e">✅ ' + email + ' aprovado!</div>'; }
                    setTimeout(loadPendingAccounts, 1500);
                } else {
                    alert(data.message || 'Erro ao aprovar');
                    if (card) card.style.opacity = '1';
                }
            } catch (err) {
                alert('Erro de conexão');
                if (card) card.style.opacity = '1';
            }
        }

        async function rejectAccount(email, idx) {
            if (!confirm('Rejeitar cadastro de ' + email + '?')) return;
            var card = document.getElementById('accCard' + idx);
            if (card) card.style.opacity = '0.5';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'rejectAccount', email: email }) });
                var data = await r.json();
                if (data.success) {
                    if (card) { card.style.background = 'rgba(232,93,93,0.1)'; card.innerHTML = '<div class="admin-empty" style="color:var(--coral)">❌ ' + email + ' rejeitado</div>'; }
                    setTimeout(loadPendingAccounts, 1500);
                } else { alert(data.message || 'Erro'); if (card) card.style.opacity = '1'; }
            } catch (err) { alert('Erro de conexão'); if (card) card.style.opacity = '1'; }
        }

        // --- PENDING PASSWORD RESETS ---
        async function loadPendingResets() {
            var container = document.getElementById('adminResetsList');
            container.innerHTML = '<div class="admin-empty">Carregando...</div>';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getPendingResets' }) });
                var data = await r.json();
                if (data.success && data.resets && data.resets.length > 0) {
                    var html = '';
                    for (var i = 0; i < data.resets.length; i++) {
                        var rst = data.resets[i];
                        var initial = (rst.name || '?').charAt(0).toUpperCase();
                        html += '<div class="admin-card" id="rstCard' + i + '">' +
                            '<div class="admin-card-top">' +
                                '<div class="admin-card-avatar">' + initial + '</div>' +
                                '<div class="admin-card-info">' +
                                    '<div class="admin-card-name">' + (rst.name || 'Aluno') + '</div>' +
                                    '<div class="admin-card-meta">' + (rst.email || '') + '</div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="admin-card-detail">🔑 Solicitação de nova senha · 📅 ' + (rst.data || '-') + '</div>' +
                            '<div class="admin-card-actions">' +
                                '<button class="admin-btn approve" onclick="approveReset(\'' + (rst.email || '').replace(/'/g, "\\'") + '\',' + i + ')">✓ Aprovar</button>' +
                                '<button class="admin-btn reject" onclick="rejectReset(\'' + (rst.email || '').replace(/'/g, "\\'") + '\',' + i + ')">✕ Rejeitar</button>' +
                            '</div>' +
                        '</div>';
                    }
                    container.innerHTML = html;
                    var badge = document.getElementById('adminResetBadge');
                    badge.textContent = data.resets.length;
                    badge.style.display = 'inline-block';
                    document.getElementById('adminPendingResetsCount').textContent = data.resets.length;
                } else {
                    container.innerHTML = '<div class="admin-empty">Nenhum reset pendente 🎉</div>';
                    document.getElementById('adminResetBadge').style.display = 'none';
                    document.getElementById('adminPendingResetsCount').textContent = '0';
                }
            } catch (err) {
                container.innerHTML = '<div class="admin-empty">Erro ao carregar</div>';
            }
        }

        async function approveReset(email, idx) {
            var card = document.getElementById('rstCard' + idx);
            if (card) card.style.opacity = '0.5';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'approvePasswordReset', email: email }) });
                var data = await r.json();
                if (data.success) {
                    if (card) { card.style.background = 'rgba(45,138,78,0.1)'; card.innerHTML = '<div class="admin-empty" style="color:#2d8a4e">✅ Senha de ' + email + ' atualizada!</div>'; }
                    setTimeout(loadPendingResets, 1500);
                } else {
                    alert(data.message || 'Erro ao aprovar');
                    if (card) card.style.opacity = '1';
                }
            } catch (err) {
                alert('Erro de conexão');
                if (card) card.style.opacity = '1';
            }
        }

        async function rejectReset(email, idx) {
            if (!confirm('Rejeitar reset de senha de ' + email + '?')) return;
            var card = document.getElementById('rstCard' + idx);
            if (card) card.style.opacity = '0.5';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'rejectPasswordReset', email: email }) });
                var data = await r.json();
                if (data.success) {
                    if (card) { card.style.background = 'rgba(232,93,93,0.1)'; card.innerHTML = '<div class="admin-empty" style="color:var(--coral)">❌ Reset rejeitado</div>'; }
                    setTimeout(loadPendingResets, 1500);
                } else { alert(data.message || 'Erro'); if (card) card.style.opacity = '1'; }
            } catch (err) { alert('Erro de conexão'); if (card) card.style.opacity = '1'; }
        }

        // --- PENDING CHECK-INS ---
        async function loadPendingCheckins() {
            var container = document.getElementById('adminCheckinsList');
            var approvedContainer = document.getElementById('adminApprovedList');
            container.innerHTML = '<div class="admin-empty">Carregando...</div>';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getPendingCheckins', filter: adminCheckinFilter }) });
                var data = await r.json();

                // Pending
                adminPendingCheckins = (data.pending || []);
                adminApprovedCheckins = (data.approved || []);

                renderPendingCheckins();
                renderApprovedCheckins();

                // Stats
                document.getElementById('adminPendingCheckinsCount').textContent = adminPendingCheckins.length;
                document.getElementById('adminTodayCheckinsCount').textContent = (data.todayTotal || 0);

            } catch (err) {
                container.innerHTML = '<div class="admin-empty">Erro ao carregar</div>';
            }
        }

        function renderPendingCheckins() {
            var container = document.getElementById('adminCheckinsList');
            var bulkBtn = document.getElementById('adminBulkApproveBtn');
            if (adminPendingCheckins.length === 0) {
                container.innerHTML = '<div class="admin-empty">Nenhum check-in pendente 🎉</div>';
                document.getElementById('adminCheckinBadge').style.display = 'none';
                bulkBtn.style.display = 'none';
                return;
            }

            var html = '';
            for (var i = 0; i < adminPendingCheckins.length; i++) {
                var ck = adminPendingCheckins[i];
                html += renderCheckinCard(ck, i);
            }
            container.innerHTML = html;

            var badge = document.getElementById('adminCheckinBadge');
            badge.textContent = adminPendingCheckins.length;
            badge.style.display = 'inline-block';

            bulkBtn.style.display = adminPendingCheckins.length > 1 ? 'block' : 'none';
            bulkBtn.textContent = '✓ Aprovar Todos (' + adminPendingCheckins.length + ')';
        }

        function renderApprovedCheckins() {
            var container = document.getElementById('adminApprovedList');
            if (adminApprovedCheckins.length === 0) {
                container.innerHTML = '<div class="admin-empty">Nenhum check-in aprovado hoje</div>';
                document.getElementById('adminApprovedBadge').style.display = 'none';
                return;
            }
            var html = '';
            for (var i = 0; i < adminApprovedCheckins.length; i++) {
                var ck = adminApprovedCheckins[i];
                var initial = (ck.name || '?').charAt(0).toUpperCase();
                html += '<div class="admin-card">' +
                    '<div class="admin-card-top">' +
                        '<div class="admin-card-avatar">' + initial + '</div>' +
                        '<div class="admin-card-info">' +
                            '<div class="admin-card-name">' + (ck.name || '-') + '</div>' +
                            '<div class="admin-card-meta">' + (ck.ct || '') + ' · <span class="admin-checkin-time">' + (ck.hora || '') + '</span></div>' +
                        '</div>' +
                        '<span class="admin-checkin-status aprovado">aprovado</span>' +
                    '</div>' +
                '</div>';
            }
            container.innerHTML = html;
            var badge = document.getElementById('adminApprovedBadge');
            badge.textContent = adminApprovedCheckins.length;
            badge.style.display = 'inline-block';
        }

        function renderCheckinCard(ck, idx) {
            var initial = (ck.name || '?').charAt(0).toUpperCase();
            var dataStr = ck.dataFormatada || '-';
            var rowIndex = ck.rowIndex || 0;
            return '<div class="admin-card" id="ckCard' + idx + '">' +
                '<div class="admin-card-top">' +
                    '<div class="admin-card-avatar">' + initial + '</div>' +
                    '<div class="admin-card-info">' +
                        '<div class="admin-card-name">' + (ck.name || '-') + '</div>' +
                        '<div class="admin-card-meta">' + (ck.email || '') + '</div>' +
                    '</div>' +
                    '<span class="admin-checkin-status pendente">pendente</span>' +
                '</div>' +
                '<div class="admin-card-detail">📍 ' + (ck.ct || '-') + ' · ⏰ ' + (ck.hora || '-') + ' · 📅 ' + dataStr + '</div>' +
                '<div class="admin-card-actions">' +
                    '<button class="admin-btn approve" onclick="approveCheckin(' + rowIndex + ',' + idx + ')">✓ Aprovar</button>' +
                    '<button class="admin-btn reject" onclick="rejectCheckin(' + rowIndex + ',' + idx + ')">✕ Rejeitar</button>' +
                '</div>' +
            '</div>';
        }

        function filterAdminCheckins(filter, evt) {
            document.querySelectorAll('.admin-filter-btn').forEach(function(b) { b.classList.remove('active'); });
            if (evt && evt.target) evt.target.classList.add('active');
            adminCheckinFilter = filter;
            loadPendingCheckins();
        }

        async function approveCheckin(rowIndex, cardIdx) {
            var card = document.getElementById('ckCard' + cardIdx);
            if (card) card.style.opacity = '0.5';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'approveCheckin', rowIndex: rowIndex, approvedBy: currentUser.email }) });
                var data = await r.json();
                if (data.success) {
                    if (card) { card.style.background = 'rgba(45,138,78,0.1)'; card.innerHTML = '<div class="admin-empty" style="color:#2d8a4e">✅ Aprovado!</div>'; }
                    setTimeout(loadPendingCheckins, 1000);
                } else {
                    alert(data.message || 'Erro');
                    if (card) card.style.opacity = '1';
                }
            } catch (err) { alert('Erro de conexão'); if (card) card.style.opacity = '1'; }
        }

        async function rejectCheckin(rowIndex, cardIdx) {
            if (!confirm('Rejeitar este check-in?')) return;
            var card = document.getElementById('ckCard' + cardIdx);
            if (card) card.style.opacity = '0.5';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'rejectCheckin', rowIndex: rowIndex }) });
                var data = await r.json();
                if (data.success) {
                    if (card) { card.style.background = 'rgba(232,93,93,0.1)'; card.innerHTML = '<div class="admin-empty" style="color:var(--coral)">❌ Rejeitado</div>'; }
                    setTimeout(loadPendingCheckins, 1000);
                } else { alert(data.message || 'Erro'); if (card) card.style.opacity = '1'; }
            } catch (err) { alert('Erro de conexão'); if (card) card.style.opacity = '1'; }
        }

        async function bulkApproveCheckins() {
            if (!confirm('Aprovar todos os ' + adminPendingCheckins.length + ' check-ins pendentes?')) return;
            var btn = document.getElementById('adminBulkApproveBtn');
            btn.disabled = true;
            btn.textContent = 'Aprovando...';
            try {
                var r = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'bulkApproveCheckins', approvedBy: currentUser.email, filter: adminCheckinFilter }) });
                var data = await r.json();
                if (data.success) {
                    btn.textContent = '✅ ' + (data.count || 0) + ' aprovados!';
                    setTimeout(loadPendingCheckins, 1500);
                } else { alert(data.message || 'Erro'); }
            } catch (err) { alert('Erro de conexão'); }
            btn.disabled = false;
        }
    </script>
</body>
</html>
