<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0a0e1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ü•ã Jiu Jitsu Academy - Checkin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        :root{--bg:#0a0e1a;--surface:#111827;--surface2:#1a2236;--surface3:#222d44;--accent:#f59e0b;--accent2:#fbbf24;--accent-glow:rgba(245,158,11,0.15);--green:#10b981;--green-soft:rgba(16,185,129,0.12);--red:#ef4444;--red-soft:rgba(239,68,68,0.12);--yellow:#f59e0b;--yellow-soft:rgba(245,158,11,0.12);--blue:#3b82f6;--blue-soft:rgba(59,130,246,0.12);--text:#f1f5f9;--text2:#94a3b8;--text3:#64748b;--border:rgba(255,255,255,0.06);--radius:16px;--radius-sm:10px;--radius-xs:6px;--safe-bottom:env(safe-area-inset-bottom,0px)}
        html,body{width:100%;height:100%;overflow:hidden;font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);-webkit-user-select:none;user-select:none;-webkit-text-size-adjust:100%}
        .app-wrapper{width:100%;height:100%;display:flex;flex-direction:column;position:relative}
        .app-body{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding-bottom:calc(72px + var(--safe-bottom))}
        .app-body::-webkit-scrollbar{display:none}

        /* Header */
        .app-header{padding:14px 20px;padding-top:calc(14px + env(safe-area-inset-top,0px));display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,var(--bg) 0%,transparent 100%);position:sticky;top:0;z-index:50}
        .app-logo{display:flex;align-items:center;gap:10px}
        .app-logo-icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#d97706);display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 4px 16px rgba(245,158,11,0.25)}
        .app-logo-text{font-family:'Sora',sans-serif;font-weight:700;font-size:14px;letter-spacing:.5px}
        .app-logo-text span{color:var(--accent)}
        .header-action{width:36px;height:36px;border-radius:10px;background:var(--surface);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;transition:background .2s}
        .header-action:active{background:var(--surface2)}

        /* Bottom Nav */
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;padding:8px 16px;padding-bottom:calc(8px + var(--safe-bottom));background:rgba(10,14,26,.92);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:1px solid rgba(255,255,255,.06);display:flex;justify-content:space-around;z-index:100}
        .nav-item{display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 12px;border-radius:12px;background:none;border:none;color:var(--text3);font-family:'DM Sans',sans-serif;font-size:10px;font-weight:600;cursor:pointer;transition:all .2s;position:relative}
        .nav-item .nav-icon{font-size:22px;transition:transform .2s}
        .nav-item.active{color:var(--accent)}
        .nav-item.active .nav-icon{transform:scale(1.1)}
        .nav-item.active::after{content:'';position:absolute;top:-8px;left:50%;transform:translateX(-50%);width:20px;height:3px;border-radius:2px;background:var(--accent)}
        .nav-item:active{transform:scale(.93)}

        /* Tabs */
        .tab-page{display:none;padding:0 16px 24px}
        .tab-page.active{display:block;animation:fadeUp .3s ease}
        @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

        /* Login */
        .login-screen{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px 24px;background:radial-gradient(ellipse at 50% 0%,rgba(245,158,11,.08) 0%,transparent 60%),var(--bg)}
        .login-brand{text-align:center;margin-bottom:40px}
        .login-brand-icon{width:72px;height:72px;border-radius:20px;background:linear-gradient(135deg,var(--accent),#d97706);display:inline-flex;align-items:center;justify-content:center;font-size:36px;margin-bottom:16px;box-shadow:0 8px 32px rgba(245,158,11,.3)}
        .login-brand h1{font-family:'Sora',sans-serif;font-weight:800;font-size:22px;letter-spacing:1px;margin-bottom:6px}
        .login-brand h1 span{color:var(--accent)}
        .login-brand p{color:var(--text2);font-size:13px}
        .login-card{width:100%;max-width:380px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px 24px}
        .login-card h2{font-family:'Sora',sans-serif;font-size:16px;font-weight:700;color:var(--accent);margin-bottom:24px;text-align:center;letter-spacing:.5px}
        .field{margin-bottom:16px}
        .field label{display:block;font-size:12px;font-weight:600;color:var(--text2);margin-bottom:6px}
        .field input,.field select{width:100%;padding:12px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;transition:border .2s;-webkit-user-select:text;user-select:text}
        .field input:focus,.field select:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow)}
        .field input::placeholder{color:var(--text3)}
        .field select{-webkit-appearance:none;appearance:none}
        .btn-primary{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),#d97706);color:#000;font-family:'Sora',sans-serif;font-size:14px;font-weight:700;letter-spacing:.5px;border:none;border-radius:var(--radius-sm);cursor:pointer;transition:all .2s;box-shadow:0 4px 16px rgba(245,158,11,.3)}
        .btn-primary:active{transform:scale(.97)}
        .btn-primary:disabled{opacity:.4;pointer-events:none}
        .btn-ghost{width:100%;padding:12px;margin-top:12px;background:transparent;border:1px solid var(--border);color:var(--text2);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;border-radius:var(--radius-sm);cursor:pointer}
        .btn-ghost:active{background:var(--surface2)}
        .msg-box{padding:10px 14px;border-radius:var(--radius-xs);font-size:13px;text-align:center;margin:12px 0;animation:fadeUp .3s ease}
        .msg-success{background:var(--green-soft);color:var(--green)}.msg-danger{background:var(--red-soft);color:var(--red)}.msg-warning{background:var(--yellow-soft);color:var(--yellow)}.msg-info{background:var(--blue-soft);color:var(--blue)}

        /* Check-in */
        .checkin-profile{display:flex;align-items:center;gap:14px;padding:16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:16px}
        .checkin-avatar{width:50px;height:50px;border-radius:14px;background:linear-gradient(135deg,var(--surface2),var(--surface3));display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0}
        .checkin-info{flex:1;min-width:0}.checkin-name{font-family:'Sora',sans-serif;font-weight:700;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .checkin-meta{display:flex;gap:12px;margin-top:4px}.checkin-tag{font-size:11px;font-weight:600;color:var(--text2);display:flex;align-items:center;gap:3px}.checkin-tag .val{color:var(--accent)}
        .checkin-stats{display:flex;flex-direction:column;align-items:center;padding:6px 12px;background:var(--accent-glow);border-radius:var(--radius-sm)}
        .checkin-stats-num{font-family:'Sora',sans-serif;font-weight:800;font-size:20px;color:var(--accent);line-height:1}.checkin-stats-lbl{font-size:9px;font-weight:600;color:var(--text3);margin-top:2px;text-transform:uppercase}
        .section-label{font-family:'Sora',sans-serif;font-size:13px;font-weight:700;color:var(--text2);margin-bottom:10px}
        .ct-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}
        .ct-btn{padding:14px 10px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;text-align:center}
        .ct-btn:active{transform:scale(.96)}.ct-btn.selected{border-color:var(--accent);background:var(--accent-glow);color:var(--accent);box-shadow:0 0 0 2px var(--accent-glow)}
        .selected-summary{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:16px}
        .selected-summary-label{font-size:12px;color:var(--text3)}.selected-summary-value{font-size:14px;font-weight:700;color:var(--accent)}

        /* Ranking */
        .period-segmented{display:flex;gap:4px;background:var(--surface);border-radius:var(--radius-sm);padding:3px;margin-bottom:12px}
        .period-seg-btn{flex:1;padding:10px;background:transparent;border:none;color:var(--text3);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;border-radius:8px;cursor:pointer;transition:all .2s}
        .period-seg-btn.active{background:var(--accent);color:#000;box-shadow:0 2px 8px rgba(245,158,11,.3)}
        .ct-chips-scroll{display:flex;gap:6px;overflow-x:auto;padding-bottom:4px;margin-bottom:16px;-webkit-overflow-scrolling:touch}.ct-chips-scroll::-webkit-scrollbar{display:none}
        .ct-chip{flex-shrink:0;padding:8px 14px;background:var(--surface);border:1px solid var(--border);border-radius:20px;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer;transition:all .2s;white-space:nowrap}.ct-chip.active{background:var(--accent);color:#000;border-color:var(--accent)}
        .user-training-section{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:16px}
        .rank-section-label{font-family:'Sora',sans-serif;font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px}
        .user-stats-row{display:flex;align-items:center;gap:14px}.user-stats-total{text-align:center;min-width:60px}
        .user-stats-total-num{font-family:'Sora',sans-serif;font-weight:800;font-size:28px;color:var(--accent);line-height:1}.user-stats-total-label{font-size:10px;color:var(--text3);margin-top:2px}
        .user-training-grid{display:flex;flex-wrap:wrap;gap:6px;flex:1}.user-training-ct{padding:5px 10px;background:var(--surface2);border-radius:6px;font-size:11px;font-weight:600;color:var(--text2)}.user-training-ct-count{color:var(--accent);font-weight:700}
        .top3-container{display:flex;align-items:flex-end;justify-content:center;gap:8px;margin-bottom:20px;padding:10px 0}
        .podium-card{flex:1;max-width:110px;text-align:center;padding:12px 6px;border-radius:var(--radius-sm);background:var(--surface);border:1px solid var(--border)}.podium-card.first{padding-bottom:16px;margin-bottom:8px;border-color:var(--accent);background:linear-gradient(180deg,var(--accent-glow),var(--surface))}
        .podium-medal{font-size:22px;margin-bottom:4px}.podium-name{font-family:'Sora',sans-serif;font-size:11px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.podium-count{font-family:'Sora',sans-serif;font-size:18px;font-weight:800;color:var(--accent);line-height:1.2}.podium-faixa{font-size:10px;color:var(--text3);margin-top:2px}.podium-ct-info{font-size:9px;color:var(--text3);margin-top:2px}
        .user-position-section{margin-bottom:16px}.user-position-card{display:flex;align-items:center;gap:12px;padding:12px 14px;background:var(--accent-glow);border:1px solid rgba(245,158,11,.2);border-radius:var(--radius-sm)}
        .user-pos-rank{font-family:'Sora',sans-serif;font-weight:800;font-size:18px;color:var(--accent);min-width:30px}.user-pos-name{font-size:13px;font-weight:600;flex:1}.user-pos-count{font-family:'Sora',sans-serif;font-weight:800;font-size:16px;color:var(--accent)}
        .ranking-list-section{margin-bottom:16px}.ranking-list{display:flex;flex-direction:column;gap:4px}
        .ranking-item{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm)}
        .ranking-pos{font-family:'Sora',sans-serif;font-weight:700;font-size:13px;color:var(--text3);min-width:24px}.ranking-name{font-size:13px;font-weight:600;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ranking-details{font-size:10px;color:var(--text3)}.ranking-count{font-family:'Sora',sans-serif;font-weight:800;font-size:15px;color:var(--accent)}
        #ctRankingContainer{margin-bottom:16px}

        /* ========== EVOLU√á√ÉO ADDICTIVE ========== */
        .evo-stagger{opacity:0;transform:translateY(20px);transition:all .5s cubic-bezier(.22,1,.36,1)}.evo-stagger.visible{opacity:1;transform:translateY(0)}
        .pull-indicator{text-align:center;height:0;overflow:hidden;transition:height .2s;color:var(--accent);font-size:12px;font-weight:600}
        .pull-indicator.active{height:40px;display:flex;align-items:center;justify-content:center}
        .pull-spinner{display:inline-block;width:16px;height:16px;border:2px solid var(--surface2);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;margin-right:8px}
        .evo-container{display:flex;flex-direction:column;gap:14px;position:relative}

        /* Streak */
        .evo-streak{display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:var(--radius);background:linear-gradient(135deg,rgba(245,158,11,.12),rgba(239,68,68,.08));border:1px solid rgba(245,158,11,.15);overflow:hidden;position:relative}
        .evo-streak::before{content:'';position:absolute;top:-50%;right:-20px;width:100px;height:100px;border-radius:50%;background:radial-gradient(circle,rgba(245,158,11,.15),transparent 70%);pointer-events:none}
        .evo-streak-fire{font-size:32px;animation:fireFlicker 1.5s ease-in-out infinite}
        @keyframes fireFlicker{0%,100%{transform:scale(1) rotate(0)}25%{transform:scale(1.1) rotate(-3deg)}50%{transform:scale(1.05) rotate(2deg)}75%{transform:scale(1.12) rotate(-2deg)}}
        .evo-streak-info{flex:1}.evo-streak-count{font-family:'Sora',sans-serif;font-weight:800;font-size:20px;background:linear-gradient(135deg,var(--accent),#ef4444);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .evo-streak-label{font-size:11px;color:var(--text3);margin-top:1px}
        .evo-streak-best{padding:4px 10px;border-radius:8px;background:rgba(255,255,255,.05);font-size:10px;font-weight:700;color:var(--text3)}.evo-streak-best span{color:var(--accent)}

        /* Motivation */
        .evo-motivation{text-align:center;padding:18px;background:linear-gradient(135deg,rgba(245,158,11,.06),rgba(168,85,247,.05));border:1px solid var(--border);border-radius:var(--radius);position:relative;overflow:hidden}
        .evo-motivation::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(255,255,255,.01) 10px,rgba(255,255,255,.01) 20px);pointer-events:none}
        .evo-motivation-icon{font-size:28px;margin-bottom:6px}.evo-motivation-text{font-family:'Sora',sans-serif;font-size:14px;font-weight:700;font-style:italic;color:var(--accent2)}.evo-motivation-sub{font-size:11px;color:var(--text3);margin-top:4px}

        /* Hero */
        .evo-hero{display:flex;align-items:center;gap:14px;padding:16px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);position:relative;overflow:hidden}
        .evo-hero::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;border-radius:50%;background:radial-gradient(circle,var(--accent-glow),transparent 70%);pointer-events:none}
        .evo-hero-belt{width:54px;height:54px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0}
        .evo-hero-belt.branca{background:linear-gradient(135deg,#e2e8f0,#cbd5e1)}.evo-hero-belt.azul{background:linear-gradient(135deg,#3b82f6,#2563eb);box-shadow:0 4px 20px rgba(59,130,246,.3)}.evo-hero-belt.roxa{background:linear-gradient(135deg,#8b5cf6,#7c3aed);box-shadow:0 4px 20px rgba(139,92,246,.3)}.evo-hero-belt.marrom{background:linear-gradient(135deg,#a16207,#78350f);box-shadow:0 4px 20px rgba(161,98,7,.3)}.evo-hero-belt.preta{background:linear-gradient(135deg,#1e293b,#0f172a);border:2px solid var(--accent);box-shadow:0 4px 20px rgba(245,158,11,.2)}
        .evo-hero-info{flex:1;min-width:0;position:relative;z-index:1}.evo-hero-title{font-family:'Sora',sans-serif;font-size:16px;font-weight:700}.evo-hero-sub{font-size:11px;color:var(--text3);margin-top:2px}
        .evo-hero-status{display:inline-block;margin-top:6px}.evo-hero-status>div{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:6px;font-size:11px;font-weight:700}
        .evo-hero-status .green{background:var(--green-soft);color:var(--green)}.evo-hero-status .yellow{background:var(--yellow-soft);color:var(--yellow)}.evo-hero-status .red{background:var(--red-soft);color:var(--red)}
        .evo-hero-stats{display:flex;gap:12px;position:relative;z-index:1}.evo-hero-stat{text-align:center}
        .evo-hero-stat-val{font-family:'Sora',sans-serif;font-weight:800;font-size:22px;color:var(--accent);line-height:1}.evo-hero-stat-lbl{font-size:9px;font-weight:600;color:var(--text3);text-transform:uppercase;margin-top:3px}
        .evo-ct-notice{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm)}.evo-ct-notice-icon{font-size:14px}.evo-ct-notice-text{font-size:11px;color:var(--text3)}.evo-ct-notice-text strong{color:var(--accent);font-weight:700}

        /* Seals SVG Circular */
        .evo-seals{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:18px 12px}
        .evo-seals-title{font-family:'Sora',sans-serif;font-size:13px;font-weight:700;text-align:center;margin-bottom:16px}
        .evo-seals-row{display:flex;justify-content:space-around}
        .evo-seal{text-align:center;flex:1;cursor:pointer;transition:transform .2s;position:relative}.evo-seal:active{transform:scale(.92)}
        .seal-ring-wrap{width:64px;height:64px;position:relative;margin:0 auto}
        .seal-ring-svg{width:64px;height:64px;transform:rotate(-90deg)}
        .seal-ring-bg{fill:none;stroke:var(--surface2);stroke-width:4}
        .seal-ring-fill{fill:none;stroke-width:4;stroke-linecap:round;transition:stroke-dashoffset 1.2s cubic-bezier(.22,1,.36,1)}
        .seal-ring-fill.amber{stroke:var(--accent);filter:drop-shadow(0 0 6px rgba(245,158,11,.5))}.seal-ring-fill.gray{stroke:var(--text3);opacity:.3}
        .seal-center-icon{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:22px;transition:all .3s}
        .evo-seal-label{font-family:'Sora',sans-serif;font-size:10px;font-weight:700;margin-top:6px;color:var(--text3)}.evo-seal-label.unlocked{color:var(--accent)}
        .evo-seal-progress{font-size:9px;color:var(--text3);margin-top:2px;min-height:13px;font-weight:600}.evo-seal-progress.glow{color:var(--accent);text-shadow:0 0 8px rgba(245,158,11,.5)}
        .seal-unlocked-glow{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:64px;height:64px;border-radius:50%;background:radial-gradient(circle,rgba(245,158,11,.2),transparent 70%);animation:sealPulse 2.5s ease-in-out infinite}
        @keyframes sealPulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.6}50%{transform:translate(-50%,-50%) scale(1.3);opacity:.2}}
        .seal-detail{position:absolute;bottom:100%;left:50%;transform:translateX(-50%) translateY(8px);background:var(--surface3);border:1px solid var(--accent);border-radius:8px;padding:8px 12px;font-size:11px;color:var(--text);white-space:nowrap;z-index:10;opacity:0;pointer-events:none;transition:all .2s;box-shadow:0 4px 20px rgba(0,0,0,.4)}
        .seal-detail::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:var(--accent)}
        .seal-detail.show{opacity:1;transform:translateX(-50%) translateY(-4px);pointer-events:auto}

        /* Frequency */
        .evo-freq{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;position:relative;overflow:hidden}
        .evo-freq-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}.evo-freq-left{font-size:13px;font-weight:600;color:var(--text2)}
        .evo-freq-pct{font-family:'Sora',sans-serif;font-size:24px;font-weight:800}.evo-freq-pct.green{color:var(--green)}.evo-freq-pct.yellow{color:var(--yellow)}.evo-freq-pct.red{color:var(--red)}
        .evo-freq-bar-bg{width:100%;height:8px;background:var(--surface2);border-radius:4px;overflow:hidden}
        .evo-freq-bar-fill{height:100%;border-radius:4px;transition:width 1s cubic-bezier(.22,1,.36,1);position:relative}
        .evo-freq-bar-fill.green{background:linear-gradient(90deg,#059669,var(--green),#34d399)}.evo-freq-bar-fill.yellow{background:linear-gradient(90deg,#d97706,var(--yellow),#fbbf24)}.evo-freq-bar-fill.red{background:linear-gradient(90deg,#dc2626,var(--red),#f87171)}
        .evo-freq-bar-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);animation:barShimmer 2s ease-in-out infinite}
        @keyframes barShimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
        .evo-freq-sub{font-size:11px;color:var(--text3);margin-top:8px;text-align:center}

        /* Quick Stats */
        .evo-quick-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
        .evo-quick-stat{text-align:center;padding:12px 6px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm)}
        .evo-quick-stat-icon{font-size:18px;margin-bottom:4px}.evo-quick-stat-val{font-family:'Sora',sans-serif;font-weight:800;font-size:16px;color:var(--text)}.evo-quick-stat-lbl{font-size:9px;color:var(--text3);text-transform:uppercase;font-weight:600;margin-top:2px}

        /* Criteria */
        .evo-criteria-section{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;overflow:hidden}
        .evo-criteria-header{display:flex;align-items:center;gap:10px;margin-bottom:14px}.evo-criteria-header-icon{font-size:18px}.evo-criteria-header-text{font-family:'Sora',sans-serif;font-size:13px;font-weight:700;flex:1}
        .evo-criteria-header-sub{font-family:'Sora',sans-serif;font-size:12px;font-weight:700;color:var(--accent);background:var(--accent-glow);padding:3px 10px;border-radius:10px}
        .evo-criteria-list{display:flex;flex-direction:column;gap:8px}.evo-criteria-item{display:flex;align-items:center;gap:10px}
        .evo-criteria-check{width:26px;height:26px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;flex-shrink:0}
        .evo-criteria-check.pass{background:var(--green-soft);color:var(--green)}.evo-criteria-check.fail{background:var(--red-soft);color:var(--red)}
        .evo-criteria-text{flex:1}.evo-criteria-label{font-size:12px;font-weight:600}.evo-criteria-detail{font-size:10px;color:var(--text3)}
        .evo-exam-btn{width:100%;padding:14px;font-family:'Sora',sans-serif;font-size:14px;font-weight:700;border:none;border-radius:var(--radius-sm);cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
        .evo-exam-btn.disabled{background:var(--surface2);color:var(--text3);cursor:not-allowed}
        .evo-exam-btn.active{background:linear-gradient(135deg,var(--accent),#d97706);color:#000;box-shadow:0 4px 20px rgba(245,158,11,.4);animation:examPulse 2s ease-in-out infinite}
        @keyframes examPulse{0%,100%{box-shadow:0 4px 20px rgba(245,158,11,.4)}50%{box-shadow:0 4px 32px rgba(245,158,11,.6)}}
        .evo-exam-btn.active:active{transform:scale(.97)}

        /* Timeline */
        .evo-timeline{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:18px}
        .evo-timeline-title{font-family:'Sora',sans-serif;font-size:13px;font-weight:700;text-align:center;margin-bottom:16px}
        .evo-tl-track{display:flex;align-items:center;justify-content:space-between;position:relative;padding:0 4px;margin-bottom:20px}
        .evo-tl-line-bg{position:absolute;top:50%;left:4px;right:4px;height:3px;background:var(--surface2);border-radius:2px;transform:translateY(-50%);z-index:1}
        .evo-tl-line-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--accent),#d97706);transition:width 1.2s cubic-bezier(.22,1,.36,1);position:relative}
        .evo-tl-line-fill::after{content:'';position:absolute;right:-3px;top:-3px;width:9px;height:9px;border-radius:50%;background:var(--accent);box-shadow:0 0 10px var(--accent)}
        .evo-tl-dot{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;position:relative;z-index:2;transition:all .3s}
        .evo-tl-dot.done{background:var(--accent);color:#000;font-weight:800}
        .evo-tl-dot.current{background:rgba(245,158,11,.25);border:2px solid var(--accent);color:var(--accent);font-weight:800;animation:tlPulse 2s ease-in-out infinite}
        @keyframes tlPulse{0%,100%{box-shadow:0 0 0 0 rgba(245,158,11,.3)}50%{box-shadow:0 0 0 6px rgba(245,158,11,0)}}
        .evo-tl-dot.future{background:var(--surface2);color:var(--text3)}
        .evo-tl-label{font-size:8px;color:var(--text3);text-align:center;font-weight:600;margin-top:4px;position:absolute;bottom:-16px;left:50%;transform:translateX(-50%);white-space:nowrap}
        .evo-overall-progress{margin-top:6px}.evo-overall-header{display:flex;justify-content:space-between;margin-bottom:6px}
        .evo-overall-label{font-size:11px;color:var(--text3)}.evo-overall-pct{font-family:'Sora',sans-serif;font-size:12px;font-weight:700;color:var(--accent)}
        .evo-overall-bar-bg{height:5px;background:var(--surface2);border-radius:3px;overflow:hidden}
        .evo-overall-bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--accent),#d97706);transition:width 1.2s cubic-bezier(.22,1,.36,1)}

        /* Confetti */
        .confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;overflow:hidden}
        .confetti-piece{position:absolute;width:8px;height:8px;border-radius:2px;animation:confettiFall 2.5s cubic-bezier(.25,.46,.45,.94) forwards}
        @keyframes confettiFall{0%{transform:translateY(-10px) rotate(0) scale(1);opacity:1}100%{transform:translateY(100vh) rotate(720deg) scale(.3);opacity:0}}

        .hidden{display:none !important}
        @keyframes spin{to{transform:rotate(360deg)}}
        .spinner{width:20px;height:20px;border:2px solid var(--text3);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;display:inline-block;vertical-align:middle;margin-right:8px}
    </style>
</head>
<body>
<div class="app-wrapper">
    <div id="loginScreen" class="login-screen">
        <div class="login-brand"><div class="login-brand-icon">ü•ã</div><h1>JIU JITSU <span>ACADEMY</span></h1><p>Checkin de Treinos</p></div>
        <div id="loginTab">
            <div class="login-card"><h2>Entrar</h2><form onsubmit="handleLogin(event)"><div class="field"><label>Email</label><input type="email" id="loginEmail" placeholder="seu@email.com" required></div><div class="field"><label>Senha</label><input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required></div><div id="loginMessage"></div><button type="submit" class="btn-primary">Entrar</button></form></div>
            <button class="btn-ghost" onclick="showRegister()">Criar Nova Conta</button>
        </div>
        <div id="registerTab" class="hidden">
            <div class="login-card"><h2>Cadastro</h2><form onsubmit="handleRegister(event)"><div class="field"><label>Nome Completo</label><input type="text" id="regName" placeholder="Seu Nome" required></div><div class="field"><label>Email</label><input type="email" id="regEmail" placeholder="seu@email.com" required></div><div class="field"><label>Senha</label><input type="password" id="regPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required></div><div class="field"><label>Faixa</label><select id="regFaixa" required><option value="">Selecione</option><option value="Branca">‚ö™ Branca</option><option value="Azul">üîµ Azul</option><option value="Roxa">üü£ Roxa</option><option value="Marrom">üü§ Marrom</option><option value="Preta">‚ö´ Preta</option></select></div><div class="field"><label>Grau</label><select id="regGrau" required><option value="">Selecione</option><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div><div class="field"><label>CT Principal</label><select id="regCT" required><option value="">Selecione seu CT</option></select></div><div id="registerMessage"></div><button type="submit" class="btn-primary">Cadastrar</button></form></div>
            <button class="btn-ghost" onclick="showLogin()">Voltar ao Login</button>
        </div>
    </div>

    <div id="appScreen" class="hidden">
        <div class="app-header"><div class="app-logo"><div class="app-logo-icon">ü•ã</div><div class="app-logo-text">JIU JITSU <span>ACADEMY</span></div></div><div class="header-action" onclick="handleLogout()">üö™</div></div>
        <div class="app-body" id="appBody">
            <div id="attendance" class="tab-page active">
                <div class="checkin-profile"><div class="checkin-avatar">ü•ã</div><div class="checkin-info"><div class="checkin-name" id="displayName">‚Äî</div><div class="checkin-meta"><div class="checkin-tag">Faixa <span class="val" id="displayFaixa">‚Äî</span></div><div class="checkin-tag">Grau <span class="val" id="displayGrau">0</span></div></div></div><div class="checkin-stats"><div class="checkin-stats-num" id="displayCount">0</div><div class="checkin-stats-lbl">treinos</div></div></div>
                <div class="section-label">Onde voc√™ treinou?</div><div class="ct-grid" id="ctGrid"></div>
                <div class="selected-summary"><span class="selected-summary-label">CT selecionado</span><span class="selected-summary-value" id="selectedCT">‚Äî</span></div>
                <button class="btn-primary" onclick="confirmAttendance()">‚úì Confirmar Presen√ßa</button><div id="attendanceMessage"></div>
            </div>
            <div id="ranking" class="tab-page">
                <div class="ranking-container">
                    <div class="period-segmented" id="periodFilterGrid"><button class="period-seg-btn active" onclick="switchRankingPeriod('mes')">Este M√™s</button><button class="period-seg-btn" onclick="switchRankingPeriod('ano')">Este Ano</button></div>
                    <div class="ct-chips-scroll" id="ctFilterGrid"></div>
                    <div id="userTrainingSection" class="user-training-section hidden"><div class="rank-section-label">Seus treinos</div><div class="user-stats-row"><div class="user-stats-total"><div class="user-stats-total-num" id="userTotalCount">0</div><div class="user-stats-total-label" id="userTotalLabel">treinos</div></div><div class="user-training-grid" id="userTrainingGrid"></div></div></div>
                    <div class="top3-container hidden" id="top3Container"></div>
                    <div class="user-position-section hidden" id="userPositionSection"><div class="user-position-card" id="userPositionCard"></div></div>
                    <div class="ranking-list-section hidden" id="rankingListSection"><div class="rank-section-label">Classifica√ß√£o</div><div class="ranking-list" id="rankingList"></div></div>
                    <div id="ctRankingContainer" class="hidden"><div class="rank-section-label" id="ctRankingTitle">Ranking</div><div class="ranking-list" id="ctRankingList"></div></div>
                    <div id="rankingMessage" style="text-align:center;padding:20px;color:var(--text3)">Carregando ranking...</div>
                </div>
            </div>
            <div id="evolucao" class="tab-page">
                <div class="pull-indicator" id="pullIndicator"><span class="pull-spinner"></span> Atualizando...</div>
                <div class="evo-container" id="evoContainer">
                    <div class="evo-streak evo-stagger" id="evoStreak"><div class="evo-streak-fire">üî•</div><div class="evo-streak-info"><div class="evo-streak-count" id="evoStreakCount">0 treinos no CT</div><div class="evo-streak-label" id="evoStreakLabel">Continue treinando!</div></div><div class="evo-streak-best">Recorde: <span id="evoStreakBest">0</span></div></div>
                    <div class="evo-motivation evo-stagger" id="evoMotivation"><div class="evo-motivation-icon">üî•</div><div class="evo-motivation-text" id="evoMotivationText">"Consist√™ncia constr√≥i campe√µes."</div><div class="evo-motivation-sub" id="evoMotivationSub">Continue firme no tatame</div></div>
                    <div class="evo-hero evo-stagger" id="evoHero"><div class="evo-hero-belt branca" id="evoHeroBelt">ü•ã</div><div class="evo-hero-info"><div class="evo-hero-title" id="evoHeroTitle">Faixa Branca</div><div class="evo-hero-sub" id="evoHeroSub">Pr√≥xima: Azul</div><div id="evoHeroStatus"></div></div><div class="evo-hero-stats"><div class="evo-hero-stat"><div class="evo-hero-stat-val" id="evoStatTreinos">0</div><div class="evo-hero-stat-lbl">No CT</div></div><div class="evo-hero-stat"><div class="evo-hero-stat-val" id="evoStatSemestre">0</div><div class="evo-hero-stat-lbl">Semestre</div></div></div></div>
                    <div class="evo-ct-notice evo-stagger" id="evoCTNotice"><span class="evo-ct-notice-icon">üìç</span><span class="evo-ct-notice-text">Evolu√ß√£o baseada no CT: <strong id="evoCTLabel">‚Äî</strong></span></div>
                    <div class="evo-seals evo-stagger"><div class="evo-seals-title">üèÖ Selos de Grau</div><div class="evo-seals-row" id="evoSealsRow"></div></div>
                    <div class="evo-freq evo-stagger"><div class="evo-freq-row"><div class="evo-freq-left">Frequ√™ncia Semestre</div><div class="evo-freq-pct" id="evoFreqPct">0%</div></div><div class="evo-freq-bar-bg"><div class="evo-freq-bar-fill" id="evoFreqBarFill" style="width:0%"></div></div><div class="evo-freq-sub" id="evoFreqDetail">0 de 48 aulas</div></div>
                    <div class="evo-quick-stats evo-stagger" id="evoQuickStats"><div class="evo-quick-stat"><div class="evo-quick-stat-icon">üéØ</div><div class="evo-quick-stat-val" id="qsProxSelo">‚Äî</div><div class="evo-quick-stat-lbl">Pr√≥x. Selo</div></div><div class="evo-quick-stat"><div class="evo-quick-stat-icon">üìä</div><div class="evo-quick-stat-val" id="qsFreqMedia">‚Äî</div><div class="evo-quick-stat-lbl">Freq/Sem</div></div><div class="evo-quick-stat"><div class="evo-quick-stat-icon">üèÜ</div><div class="evo-quick-stat-val" id="qsGrau">‚Äî</div><div class="evo-quick-stat-lbl">Grau Atual</div></div></div>
                    <div class="evo-criteria-section evo-stagger" id="evoFaixaCriteria"><div class="evo-criteria-header"><div class="evo-criteria-header-icon">üèÖ</div><div class="evo-criteria-header-text" id="evoFaixaCriteriaTitle">Exame de Faixa</div><div class="evo-criteria-header-sub" id="evoFaixaProgress">0/4</div></div><div class="evo-criteria-list" id="evoFaixaCriteriaList"></div></div>
                    <button class="evo-exam-btn disabled evo-stagger" id="evoExamBtn" disabled>üîí Crit√©rios pendentes</button>
                    <div class="evo-timeline evo-stagger"><div class="evo-timeline-title">ü•ã Caminho at√© a Faixa Preta</div><div class="evo-tl-track" id="evoTimeline"><div class="evo-tl-line-bg"><div class="evo-tl-line-fill" id="evoTlFill" style="width:0%"></div></div></div><div class="evo-overall-progress"><div class="evo-overall-header"><div class="evo-overall-label">Progresso Geral</div><div class="evo-overall-pct" id="evoOverallPct">0%</div></div><div class="evo-overall-bar-bg"><div class="evo-overall-bar-fill" id="evoOverallFill" style="width:0%"></div></div></div></div>
                </div>
            </div>
        </div>
        <nav class="bottom-nav"><button class="nav-item active" onclick="switchTab('attendance')"><span class="nav-icon">‚úçÔ∏è</span>Check-in</button><button class="nav-item" onclick="switchTab('ranking')"><span class="nav-icon">üèÜ</span>Ranking</button><button class="nav-item" onclick="switchTab('evolucao')"><span class="nav-icon">üìà</span>Evolu√ß√£o</button></nav>
    </div>
</div>
<script>
const SCRIPT_URL='https://script.google.com/macros/s/AKfycbz3xeb_MCnVzAx5i0y5YEymKN1EJMlQcQZE5PlAPmskw9R796T0yq-6Yfdg1XOz7d_LtA/exec';
let currentUser=null,selectedCT=null,allCTs=[];
function showMessage(id,msg,type){const el=document.getElementById(id);if(!el)return;const c=type==='danger'?'msg-danger':type==='warning'?'msg-warning':type==='info'?'msg-info':'msg-success';el.innerHTML=`<div class="msg-box ${c}">${msg}</div>`;}
window.addEventListener('load',function(){const s=sessionStorage.getItem('bjjUser');if(s){currentUser=JSON.parse(s);showAppScreen();loadAttendanceInfo();loadCTs();}});
async function handleLogin(e){e.preventDefault();const email=document.getElementById('loginEmail').value,pw=document.getElementById('loginPassword').value;showMessage('loginMessage','<span class="spinner"></span> Conectando...','warning');try{const r=await fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify({action:'login',email,password:pw})});const d=await r.json();if(d.authenticated===true){currentUser=d;sessionStorage.setItem('bjjUser',JSON.stringify(currentUser));showAppScreen();loadAttendanceInfo();loadCTs();}else showMessage('loginMessage',d.message||'Erro','danger');}catch(er){showMessage('loginMessage','Erro de conex√£o','danger');}}
async function handleRegister(e){e.preventDefault();const n=document.getElementById('regName').value,em=document.getElementById('regEmail').value,pw=document.getElementById('regPassword').value,f=document.getElementById('regFaixa').value,g=document.getElementById('regGrau').value,ct=document.getElementById('regCT').value;if(!ct){showMessage('registerMessage','Escolha seu CT','warning');return;}showMessage('registerMessage','<span class="spinner"></span> Cadastrando...','warning');try{const r=await fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify({action:'requestAccount',name:n,email:em,password:pw,faixa:f,grau:g,ct})});const d=await r.json();if(d.success){showMessage('registerMessage','Cadastro enviado!','success');setTimeout(()=>showLogin(),2000);}else showMessage('registerMessage',d.message||'Erro','danger');}catch(er){showMessage('registerMessage','Erro de conex√£o','danger');}}
async function loadCTs(){try{const r=await fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify({action:'getCTsList'})});const d=await r.json();if(d.success&&d.cts){allCTs=d.cts;const rc=document.getElementById('regCT');if(rc)d.cts.forEach(ct=>{const n=typeof ct==='string'?ct:ct.name||ct.toString();if(!Array.from(rc.options).find(o=>o.value===n)){const op=document.createElement('option');op.value=n;op.textContent=n;rc.appendChild(op);}});const g=document.getElementById('ctGrid');if(g){g.innerHTML='';d.cts.forEach(ct=>{const n=typeof ct==='string'?ct:ct.name||ct.toString();const b=document.createElement('button');b.type='button';b.className='ct-btn';b.textContent=n;b.addEventListener('click',function(){selectCT(n,this);});g.appendChild(b);});}}}catch(e){console.error('Erro CTs:',e);}}
function selectCT(n,el){selectedCT=n;document.querySelectorAll('.ct-btn').forEach(b=>b.classList.remove('selected'));if(el)el.classList.add('selected');document.getElementById('selectedCT').textContent=n;}
function confirmAttendance(){if(!selectedCT){showMessage('attendanceMessage','Selecione o CT','warning');return;}showMessage('attendanceMessage','<span class="spinner"></span> Registrando...','warning');fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify({action:'attendance',email:currentUser.email,name:currentUser.name,faixa:currentUser.faixa,grau:currentUser.grau,ct:selectedCT,date:new Date().toLocaleDateString('pt-BR')})}).then(r=>r.json()).then(d=>{if(d.success){currentUser.treinos=(currentUser.treinos||0)+1;sessionStorage.setItem('bjjUser',JSON.stringify(currentUser));document.getElementById('displayCount').textContent=currentUser.treinos;showMessage('attendanceMessage','‚úÖ Presen√ßa confirmada!','success');selectedCT=null;document.querySelectorAll('.ct-btn').forEach(b=>b.classList.remove('selected'));document.getElementById('selectedCT').textContent='‚Äî';setTimeout(()=>document.getElementById('attendanceMessage').innerHTML='',3000);}else showMessage('attendanceMessage',d.message||'Erro','danger');}).catch(()=>showMessage('attendanceMessage','Erro de conex√£o','danger'));}
function loadAttendanceInfo(){if(!currentUser)return;document.getElementById('displayName').textContent=currentUser.name;document.getElementById('displayFaixa').textContent=currentUser.faixa;document.getElementById('displayGrau').textContent=(currentUser.grau||0)+'/4';document.getElementById('displayCount').textContent=currentUser.treinos||'0';}

// RANKING
let allRankingData=null,currentRankingPeriod='mes',currentRankingFilter='geral';
async function loadRanking(){try{const r=await fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify({action:'getRankingMonth',email:currentUser.email,period:currentRankingPeriod})});const d=await r.json();if(d.success&&d.ranking&&d.ranking.length>0)displayRanking(d.ranking);else document.getElementById('rankingMessage').textContent='Sem dados';}catch(e){document.getElementById('rankingMessage').textContent='Erro';}}
function switchRankingPeriod(p){currentRankingPeriod=p;currentRankingFilter='geral';document.querySelectorAll('.period-seg-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');document.getElementById('rankingMessage').textContent='Carregando...';hideAllRankingSections();loadRanking();}
function hideAllRankingSections(){['top3Container','userPositionSection','rankingListSection','ctRankingContainer','userTrainingSection'].forEach(id=>document.getElementById(id).classList.add('hidden'));}
function displayRanking(rk){allRankingData=rk;document.getElementById('rankingMessage').textContent='';const ur=rk.find(r=>r.email.toLowerCase()===currentUser.email.toLowerCase());if(ur&&ur.treinosPorCT&&Object.keys(ur.treinosPorCT).length>0){document.getElementById('userTrainingSection').classList.remove('hidden');document.getElementById('userTotalCount').textContent=ur.totalTreinos;document.getElementById('userTotalLabel').textContent=currentRankingPeriod==='mes'?'este m√™s':'este ano';const g=document.getElementById('userTrainingGrid');g.innerHTML='';Object.keys(ur.treinosPorCT).sort().forEach(ct=>{g.innerHTML+=`<div class="user-training-ct">${ct}: <span class="user-training-ct-count">${ur.treinosPorCT[ct]}</span></div>`;});}const cc=document.getElementById('ctFilterGrid');cc.innerHTML='<button class="ct-chip active" onclick="filterRanking(\'geral\',this)">üèÜ Geral</button>';const cs=new Set();rk.forEach(s=>{if(s.treinosPorCT)Object.keys(s.treinosPorCT).forEach(ct=>cs.add(ct));});cs.forEach(ct=>{cc.innerHTML+=`<button class="ct-chip" onclick="filterRanking('${ct}',this)">${ct}</button>`;});displayGeneralRanking(rk);}
function filterRanking(f,el){currentRankingFilter=f;document.querySelectorAll('.ct-chip').forEach(c=>c.classList.remove('active'));if(el)el.classList.add('active');hideAllRankingSections();const ur=allRankingData.find(r=>r.email.toLowerCase()===currentUser.email.toLowerCase());if(ur&&ur.treinosPorCT&&Object.keys(ur.treinosPorCT).length>0)document.getElementById('userTrainingSection').classList.remove('hidden');if(f==='geral')displayGeneralRanking(allRankingData);else displayCTRanking(allRankingData,f);}
function displayGeneralRanking(rk){const s=[...rk].sort((a,b)=>b.totalTreinos-a.totalTreinos).filter(x=>x.totalTreinos>0);if(!s.length){document.getElementById('rankingMessage').textContent='Sem treinos';return;}const t3=document.getElementById('top3Container');t3.classList.remove('hidden');t3.innerHTML='';const m=['ü•á','ü•à','ü•â'];[1,0,2].forEach(i=>{if(s[i])t3.innerHTML+=`<div class="podium-card ${i===0?'first':''}"><div class="podium-medal">${m[i]}</div><div class="podium-name">${s[i].name}</div><div class="podium-count">${s[i].totalTreinos}</div><div class="podium-faixa">${s[i].faixa}</div><div class="podium-ct-info">${s[i].ctPrincipal||''}</div></div>`;});const ue=currentUser.email.toLowerCase(),ui=s.findIndex(x=>x.email.toLowerCase()===ue);if(ui>=0){document.getElementById('userPositionSection').classList.remove('hidden');document.getElementById('userPositionCard').innerHTML=`<div class="user-pos-rank">#${ui+1}</div><div class="user-pos-name">${s[ui].name}</div><div class="user-pos-count">${s[ui].totalTreinos}</div>`;}if(s.length>3){document.getElementById('rankingListSection').classList.remove('hidden');const l=document.getElementById('rankingList');l.innerHTML='';for(let i=3;i<s.length;i++)l.innerHTML+=`<div class="ranking-item"><div class="ranking-pos">${i+1}¬∫</div><div style="flex:1;min-width:0"><div class="ranking-name">${s[i].name}</div><div class="ranking-details">${s[i].faixa} ‚Ä¢ ${s[i].ctPrincipal}</div></div><div class="ranking-count">${s[i].totalTreinos}</div></div>`;}}
function displayCTRanking(rk,cn){const ct=rk.filter(s=>s.treinosPorCT&&s.treinosPorCT[cn]>0).map(s=>({...s,ctTreinos:s.treinosPorCT[cn]})).sort((a,b)=>b.ctTreinos-a.ctTreinos);if(!ct.length){document.getElementById('rankingMessage').textContent='Sem treinos em '+cn;return;}document.getElementById('ctRankingContainer').classList.remove('hidden');document.getElementById('ctRankingTitle').textContent='Ranking ‚Äî '+cn;const l=document.getElementById('ctRankingList');l.innerHTML='';ct.forEach((s,i)=>{const md=i<3?['ü•á','ü•à','ü•â'][i]:'';l.innerHTML+=`<div class="ranking-item"><div class="ranking-pos">${md||(i+1)+'¬∫'}</div><div style="flex:1;min-width:0"><div class="ranking-name">${s.name}</div><div class="ranking-details">${s.faixa} ‚Ä¢ ${s.ctPrincipal}</div></div><div class="ranking-count">${s.ctTreinos}</div></div>`;});}

// ============ EVOLU√á√ÉO ADDICTIVE ============
const BELT_ORDER=['Branca','Azul','Roxa','Marrom','Preta'];
const BELT_CONFIG={'Branca':{emoji:'‚ö™',class:'branca',next:'Azul',minMonths:12,minTreinos:90},'Azul':{emoji:'üîµ',class:'azul',next:'Roxa',minMonths:24,minTreinos:200},'Roxa':{emoji:'üü£',class:'roxa',next:'Marrom',minMonths:24,minTreinos:300},'Marrom':{emoji:'üü§',class:'marrom',next:'Preta',minMonths:18,minTreinos:200},'Preta':{emoji:'‚ö´',class:'preta',next:null,minMonths:0,minTreinos:0}};
const SEMESTER_MAX_CLASSES=48,GRAU_MIN_TREINOS=22,FREQ_MIN_EVOLUCAO=50,FREQ_MIN_APTO=75;
const SEAL_CIRC=2*Math.PI*26;
let _lastSeals=null;

async function loadEvolucao(){if(!currentUser)return;const faixa=currentUser.faixa||'Branca',grau=parseInt(currentUser.grau)||0;let tCT=0,ctP='',tG=0;try{let rd=allRankingData;if(!rd){const r=await fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify({action:'getRankingMonth',email:currentUser.email,period:'mes'})});const d=await r.json();if(d.success&&d.ranking)rd=d.ranking;}if(rd){const ur=rd.find(r=>r.email.toLowerCase()===currentUser.email.toLowerCase());if(ur){ctP=ur.ctPrincipal||'';if(ur.treinosPorCT&&ctP&&ur.treinosPorCT[ctP])tCT=ur.treinosPorCT[ctP];tG=ur.totalTreinos||0;}}}catch(e){console.error(e);}
const tS=Math.min(tCT,SEMESTER_MAX_CLASSES),freq=SEMESTER_MAX_CLASSES>0?Math.round((tS/SEMESTER_MAX_CLASSES)*100):0,fC=Math.min(freq,100),tF=currentUser.tempoNaFaixa||0;
renderStreak(tCT,tG);renderMotivation(fC);renderHero(faixa,grau,tCT,tS,fC,ctP);renderSeals(grau,tCT);renderFrequencyNew(fC,tS,ctP);renderQuickStats(grau,tCT,fC);renderFaixaCriteria(faixa,grau,tCT,fC,tF);renderTimeline(faixa,tCT);setTimeout(()=>triggerStagger(),100);}

function triggerStagger(){document.querySelectorAll('#evoContainer .evo-stagger').forEach((el,i)=>{el.classList.remove('visible');setTimeout(()=>el.classList.add('visible'),i*80);});}

function renderStreak(tCT,tG){const c=tCT||0,b=Math.max(c,tG||0);document.getElementById('evoStreakCount').textContent=c+' treino'+(c!==1?'s':'')+' no CT';document.getElementById('evoStreakBest').textContent=b;document.getElementById('evoStreakLabel').textContent=c>=20?'üèÜ Lenda do tatame!':c>=12?'üî• Em chamas!':c>=6?'üí™ Boa consist√™ncia!':c>=1?'Continue treinando!':'Fa√ßa seu primeiro treino!';}

function renderMotivation(f){const t=f>=75?{i:'üî•',t:'"Consist√™ncia constr√≥i campe√µes."',s:'Sua dedica√ß√£o est√° no caminho certo!'}:f>=50?{i:'üí™',t:'"Um passo de cada vez."',s:'Continue evoluindo no tatame!'}:{i:'üéØ',t:'"A jornada come√ßa com o primeiro passo."',s:'Aumente sua frequ√™ncia!'};document.getElementById('evoMotivationText').textContent=t.t;document.getElementById('evoMotivationSub').textContent=t.s;document.querySelector('.evo-motivation-icon').textContent=t.i;}

function renderHero(faixa,grau,tT,tS,freq,ctP){const c=BELT_CONFIG[faixa]||BELT_CONFIG['Branca'];document.getElementById('evoHeroBelt').className='evo-hero-belt '+c.class;document.getElementById('evoHeroTitle').textContent='Faixa '+faixa+' '+c.emoji;let ge=grau;for(let g=1;g<=4;g++)if(tT>=GRAU_MIN_TREINOS*g)ge=Math.max(ge,g);document.getElementById('evoHeroSub').textContent=ge+'/4 graus'+(c.next?' ‚Ä¢ Pr√≥xima: '+c.next:' ‚Ä¢ üèÜ M√°xima');const st=document.getElementById('evoHeroStatus');st.innerHTML=freq<FREQ_MIN_EVOLUCAO?'<div class="red">üî¥ N√£o apto</div>':freq<FREQ_MIN_APTO?'<div class="yellow">üü° Em evolu√ß√£o</div>':'<div class="green">üü¢ Apto</div>';document.getElementById('evoStatTreinos').textContent=tT;document.getElementById('evoStatSemestre').textContent=tS;const cl=document.getElementById('evoCTLabel');if(cl)cl.textContent=ctP||'‚Äî';}

function renderSeals(grauAtual,tCT){const row=document.getElementById('evoSealsRow');row.innerHTML='';const th=[GRAU_MIN_TREINOS,GRAU_MIN_TREINOS*2,GRAU_MIN_TREINOS*3,GRAU_MIN_TREINOS*4];let ge=0;for(let i=0;i<4;i++)if(tCT>=th[i])ge=i+1;const gR=Math.max(grauAtual,ge),nI=gR;let newU=false;
for(let i=0;i<4;i++){const seal=document.createElement('div');seal.className='evo-seal';const min=th[i],isU=tCT>=min,isN=i===nI&&nI<4;let prog=0,icon='üîí',pT='',lC='',gC='';if(isU){prog=1;lC='unlocked';gC='glow';icon=i<grauAtual?'‚≠ê':'‚úÖ';pT=i<grauAtual?'Conquistado':'Desbloqueado!';if(_lastSeals&&!_lastSeals[i])newU=true;}else if(isN){prog=Math.min(tCT/min,.99);pT=tCT+'/'+min;}
const off=SEAL_CIRC*(1-prog),rc=isU?'amber':'gray';
seal.innerHTML=`<div class="seal-ring-wrap">${isU?'<div class="seal-unlocked-glow"></div>':''}<svg class="seal-ring-svg" viewBox="0 0 64 64"><circle class="seal-ring-bg" cx="32" cy="32" r="26"/><circle class="seal-ring-fill ${rc}" cx="32" cy="32" r="26" stroke-dasharray="${SEAL_CIRC}" stroke-dashoffset="${isU?0:SEAL_CIRC}" data-target="${off}"/></svg><div class="seal-center-icon">${icon}</div></div><div class="evo-seal-label ${lC}">${i+1}¬∫ Grau</div><div class="evo-seal-progress ${gC}">${pT}</div><div class="seal-detail">${isU?'‚úÖ '+(i+1)+'¬∫ Grau conquistado!':'üéØ Faltam '+(min-tCT)+' treinos'}</div>`;
seal.addEventListener('click',function(e){e.stopPropagation();const d=this.querySelector('.seal-detail');document.querySelectorAll('.seal-detail.show').forEach(x=>x.classList.remove('show'));d.classList.toggle('show');setTimeout(()=>d.classList.remove('show'),2500);});
row.appendChild(seal);}
setTimeout(()=>{row.querySelectorAll('.seal-ring-fill').forEach(c=>{c.style.strokeDashoffset=c.getAttribute('data-target');});},200);
const cs=th.map(t=>tCT>=t);if(_lastSeals&&newU)launchConfetti();_lastSeals=cs;if(ge>grauAtual)autoUpdateGrau(ge);}

async function autoUpdateGrau(ng){if(!currentUser||currentUser._updatingGrau)return;if(ng<=(currentUser.grau||0))return;currentUser._updatingGrau=true;try{const r=await fetch(SCRIPT_URL,{method:'POST',body:JSON.stringify({action:'updateGrau',email:currentUser.email,grau:ng})});const d=await r.json();if(d.success){currentUser.grau=ng;sessionStorage.setItem('bjjUser',JSON.stringify(currentUser));document.getElementById('displayGrau').textContent=ng+'/4';}}catch(e){console.error(e);}finally{currentUser._updatingGrau=false;}}

function renderFrequencyNew(f,tS,ctP){const c=f<FREQ_MIN_EVOLUCAO?'red':f<FREQ_MIN_APTO?'yellow':'green';const p=document.getElementById('evoFreqPct');p.textContent=f+'%';p.className='evo-freq-pct '+c;const b=document.getElementById('evoFreqBarFill');b.className='evo-freq-bar-fill '+c;setTimeout(()=>{b.style.width=Math.min(f,100)+'%';},300);document.getElementById('evoFreqDetail').textContent=tS+' de '+SEMESTER_MAX_CLASSES+' aulas'+(ctP?' em '+ctP:'');}

function renderQuickStats(grau,tCT,f){let ge=grau;for(let g=1;g<=4;g++)if(tCT>=GRAU_MIN_TREINOS*g)ge=Math.max(ge,g);const nt=ge<4?GRAU_MIN_TREINOS*(ge+1):null;document.getElementById('qsProxSelo').textContent=nt?(nt-tCT)+'':'‚úÖ';document.getElementById('qsFreqMedia').textContent=f+'%';document.getElementById('qsGrau').textContent=ge+'/4';}

function renderFaixaCriteria(faixa,grau,tT,f,tF){const c=BELT_CONFIG[faixa]||BELT_CONFIG['Branca'];if(!c.next){document.getElementById('evoFaixaCriteria').style.display='none';document.getElementById('evoExamBtn').style.display='none';return;}document.getElementById('evoFaixaCriteriaTitle').textContent=faixa+' ‚Üí '+c.next;let ge=0;for(let g=1;g<=4;g++)if(tT>=GRAU_MIN_TREINOS*g)ge=g;const ts=Math.max(grau,ge);const cr=[{l:'4 selos de grau',d:ts+'/4 selos ('+tT+'/'+(GRAU_MIN_TREINOS*4)+')',p:ts>=4},{l:'M√≠n. '+c.minTreinos+' treinos no CT',d:tT+'/'+c.minTreinos,p:tT>=c.minTreinos},{l:'Frequ√™ncia ‚â• 75%',d:f+'%',p:f>=75},{l:'Tempo m√≠n. '+c.minMonths+' meses',d:tF+'/'+c.minMonths+' meses',p:tF>=c.minMonths}];document.getElementById('evoFaixaProgress').textContent=cr.filter(x=>x.p).length+'/'+cr.length;const li=document.getElementById('evoFaixaCriteriaList');li.innerHTML='';cr.forEach(x=>{li.innerHTML+=`<div class="evo-criteria-item"><div class="evo-criteria-check ${x.p?'pass':'fail'}">${x.p?'‚úì':'‚úó'}</div><div class="evo-criteria-text"><div class="evo-criteria-label">${x.l}</div><div class="evo-criteria-detail">${x.d}</div></div></div>`;});const btn=document.getElementById('evoExamBtn');if(ts>=4){btn.className='evo-exam-btn active evo-stagger visible';btn.disabled=false;btn.innerHTML='üèÖ Solicitar Exame ‚Üí '+c.next;btn.onclick=()=>alert('Solicita√ß√£o enviada!');}else{btn.className='evo-exam-btn disabled evo-stagger visible';btn.disabled=true;btn.innerHTML='üîí Faltam '+(4-ts)+' selo(s) para exame';}}

function renderTimeline(faixa,tT){const ci=BELT_ORDER.indexOf(faixa);const tr=document.getElementById('evoTimeline');const lb=tr.querySelector('.evo-tl-line-bg');tr.innerHTML='';tr.appendChild(lb);const p=ci>=0?Math.round((ci/(BELT_ORDER.length-1))*100):0;setTimeout(()=>{document.getElementById('evoTlFill').style.width=p+'%';},300);BELT_ORDER.forEach((b,i)=>{const d=document.createElement('div');d.className='evo-tl-dot '+(i<ci?'done':i===ci?'current':'future');d.style.position='relative';d.innerHTML=BELT_CONFIG[b].emoji+`<div class="evo-tl-label">${b}</div>`;tr.appendChild(d);});document.getElementById('evoOverallPct').textContent=p+'%';setTimeout(()=>{document.getElementById('evoOverallFill').style.width=p+'%';},300);}

function launchConfetti(){const c=document.createElement('div');c.className='confetti-container';document.body.appendChild(c);const cols=['#f59e0b','#fbbf24','#10b981','#3b82f6','#ef4444','#a855f7','#ec4899','#fff'];for(let i=0;i<60;i++){const p=document.createElement('div');p.className='confetti-piece';p.style.left=Math.random()*100+'%';p.style.backgroundColor=cols[Math.floor(Math.random()*cols.length)];p.style.animationDelay=Math.random()*.8+'s';p.style.animationDuration=(1.5+Math.random()*1.5)+'s';p.style.width=(4+Math.random()*6)+'px';p.style.height=(4+Math.random()*6)+'px';p.style.borderRadius=Math.random()>.5?'50%':'2px';c.appendChild(p);}setTimeout(()=>c.remove(),3500);}

// Pull to refresh
let pullStartY=0,isPulling=false;
document.addEventListener('DOMContentLoaded',()=>{const b=document.getElementById('appBody');if(!b)return;b.addEventListener('touchstart',e=>{if(b.scrollTop===0&&document.getElementById('evolucao').classList.contains('active')){pullStartY=e.touches[0].clientY;isPulling=true;}},{passive:true});b.addEventListener('touchmove',e=>{if(!isPulling)return;if(e.touches[0].clientY-pullStartY>60)document.getElementById('pullIndicator').classList.add('active');},{passive:true});b.addEventListener('touchend',()=>{if(document.getElementById('pullIndicator').classList.contains('active'))loadEvolucao().then(()=>{setTimeout(()=>document.getElementById('pullIndicator').classList.remove('active'),600);});isPulling=false;},{passive:true});});

function verificarElegibilidadeExame(f,g){const c=BELT_CONFIG[f];return c&&c.next?g>=4:false;}

// NAVIGATION
function switchTab(id){document.querySelectorAll('.tab-page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));document.getElementById(id).classList.add('active');event.currentTarget.classList.add('active');if(id==='ranking')loadRanking();if(id==='evolucao')loadEvolucao();}
function showAppScreen(){document.getElementById('loginScreen').classList.add('hidden');document.getElementById('appScreen').classList.remove('hidden');}
function showLogin(){document.getElementById('loginTab').classList.remove('hidden');document.getElementById('registerTab').classList.add('hidden');}
function showRegister(){document.getElementById('loginTab').classList.add('hidden');document.getElementById('registerTab').classList.remove('hidden');loadCTs();}
function handleLogout(){sessionStorage.removeItem('bjjUser');currentUser=null;document.getElementById('appScreen').classList.add('hidden');document.getElementById('loginScreen').classList.remove('hidden');}
document.addEventListener('click',()=>{document.querySelectorAll('.seal-detail.show').forEach(d=>d.classList.remove('show'));});
</script>
</body>
</html>
